{"version":3,"file":"droppr-panel.js","sources":["../src/utils/cookie.ts","../src/utils/jwt.ts","../src/services/auth.ts","../src/components/Common/SessionWarning.ts","../src/components/Panel/AnalyticsButton.ts","../src/services/api.ts","../src/components/Panel/ShareExpiration.ts","../src/services/admin.ts","../src/components/Panel/AccountsModal.ts","../src/components/Panel/RequestModal.ts","../src/components/Panel/HeaderButtons.ts","../src/utils/format.ts","../src/components/Panel/AutoShareModal.ts","../src/services/upload.ts","../src/utils/dom.ts","../src/utils/validation.ts","../src/services/xhr-interceptor.ts","../src/utils/debug.ts","../src/services/video-meta.ts","../src/components/Panel/DebugBadge.ts","../src/components/Panel/VideoListHydrator.ts","../src/services/theme.ts","../src/components/Panel/ThemeToggle.ts","../src/droppr-panel.ts"],"sourcesContent":["export function getCookie(name: string): string | null {\n  const m = (document.cookie || \"\").match(new RegExp(\"(?:^|;\\\\s*)\" + name + \"=([^;]+)\"));\n  return m ? m[1] : null;\n}\n","export interface JwtPayload {\n  exp?: number;\n  [key: string]: any;\n}\n\nexport function decodeJwtPayload(token: string | null): JwtPayload | null {\n  if (!token) return null;\n  try {\n    const parts = String(token).split(\".\");\n    if (parts.length !== 3) return null;\n    const payload = parts[1].replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const pad = payload.length % 4 ? \"====\".slice(payload.length % 4) : \"\";\n    const json = atob(payload + pad);\n    return JSON.parse(json);\n  } catch (e) {\n    return null;\n  }\n}\n","import { getCookie } from \"../utils/cookie\";\nimport { decodeJwtPayload } from \"../utils/jwt\";\n\nexport const DROPPR_ACCESS_TOKEN_KEY = \"droppr_access_token\";\nexport const DROPPR_REFRESH_TOKEN_KEY = \"droppr_refresh_token\";\nexport const DROPPR_OTP_KEY = \"droppr_otp_code\";\n\nexport interface TokenState {\n  access: string | null;\n  refresh: string | null;\n  accessExp: number;\n  refreshExp: number;\n}\n\nexport function getFileBrowserToken(): string | null {\n  try {\n    const jwt = localStorage.getItem(\"jwt\");\n    if (jwt) return jwt;\n  } catch (_e) {\n    // ignore\n  }\n\n  const auth = getCookie(\"auth\");\n  if (auth) {\n    try {\n      return decodeURIComponent(auth);\n    } catch (_e2) {\n      return auth;\n    }\n  }\n\n  return null;\n}\n\nexport function isLoggedIn(): boolean {\n  return !!getFileBrowserToken();\n}\n\nexport function getDropprTokenState(): TokenState {\n  let access: string | null = null;\n  let refresh: string | null = null;\n  try {\n    access = localStorage.getItem(DROPPR_ACCESS_TOKEN_KEY);\n    refresh = localStorage.getItem(DROPPR_REFRESH_TOKEN_KEY);\n  } catch (_e) {\n    access = null;\n    refresh = null;\n  }\n  const accessPayload = decodeJwtPayload(access);\n  const refreshPayload = decodeJwtPayload(refresh);\n  return {\n    access,\n    refresh,\n    accessExp: accessPayload && accessPayload.exp ? accessPayload.exp * 1000 : 0,\n    refreshExp: refreshPayload && refreshPayload.exp ? refreshPayload.exp * 1000 : 0,\n  };\n}\n\nexport function saveDropprTokens(access: string | null, refresh: string | null): void {\n  try {\n    if (access) localStorage.setItem(DROPPR_ACCESS_TOKEN_KEY, access);\n    if (refresh) localStorage.setItem(DROPPR_REFRESH_TOKEN_KEY, refresh);\n  } catch (_e) {\n    // ignore\n  }\n  window.dispatchEvent(new Event(\"droppr:tokens-updated\"));\n}\n\nexport function clearDropprTokens(): void {\n  try {\n    localStorage.removeItem(DROPPR_ACCESS_TOKEN_KEY);\n    localStorage.removeItem(DROPPR_REFRESH_TOKEN_KEY);\n  } catch (_e) {\n    // ignore\n  }\n  window.dispatchEvent(new Event(\"droppr:tokens-updated\"));\n}\n\nexport function getDropprOtpCode(): string {\n  try {\n    return sessionStorage.getItem(DROPPR_OTP_KEY) || \"\";\n  } catch (_e) {\n    return \"\";\n  }\n}\n\nexport function saveDropprOtpCode(code: string): void {\n  try {\n    if (code) {\n      sessionStorage.setItem(DROPPR_OTP_KEY, code);\n    } else {\n      sessionStorage.removeItem(DROPPR_OTP_KEY);\n    }\n  } catch (_e) {\n    // ignore\n  }\n}\n\nexport function promptForOtp(): string {\n  const code = window.prompt(\"Enter your 2FA code:\");\n  if (code) {\n    saveDropprOtpCode(code);\n    return code;\n  }\n  return \"\";\n}\n\nasync function parseDropprAuthResponse(res: Response) {\n  const text = await res.text();\n  let data = null;\n  if (text) {\n    try {\n      data = JSON.parse(text);\n    } catch (_e) {\n      data = null;\n    }\n  }\n  return { res, data };\n}\n\nexport async function loginDropprToken(allowPrompt = true): Promise<string | null> {\n  const fbToken = getFileBrowserToken();\n  if (!fbToken) return null;\n\n  const headers: Record<string, string> = { \"X-Auth\": fbToken };\n  const otp = getDropprOtpCode();\n  if (otp) headers[\"X-Droppr-OTP\"] = otp;\n\n  try {\n    const response = await fetch(\"/api/droppr/auth/login\", { method: \"POST\", headers });\n    const { res, data } = await parseDropprAuthResponse(response);\n\n    if (res.status === 401 && data && data.otp_required && allowPrompt) {\n      const code = promptForOtp();\n      if (!code) return null;\n      return loginDropprToken(false);\n    }\n\n    if (!res.ok) return null;\n\n    if (data && data.access_token) {\n      saveDropprTokens(data.access_token, data.refresh_token);\n      return data.access_token;\n    }\n  } catch (_e) {\n    // console.error(\"Login failed\", _e);\n  }\n  return null;\n}\n\nexport async function refreshDropprToken(\n  refreshToken: string,\n  allowPrompt = true\n): Promise<string | null> {\n  if (!refreshToken) return null;\n  const headers: Record<string, string> = { Authorization: \"Bearer \" + refreshToken };\n  const otp = getDropprOtpCode();\n  if (otp) headers[\"X-Droppr-OTP\"] = otp;\n\n  try {\n    const response = await fetch(\"/api/droppr/auth/refresh\", { method: \"POST\", headers });\n    const { res, data } = await parseDropprAuthResponse(response);\n\n    if (res.status === 401 && data && data.otp_required && allowPrompt) {\n      const code = promptForOtp();\n      if (!code) return null;\n      return refreshDropprToken(refreshToken, false);\n    }\n\n    if (!res.ok) {\n      return null;\n    }\n\n    if (data && data.access_token) {\n      saveDropprTokens(data.access_token, data.refresh_token);\n      return data.access_token;\n    }\n  } catch (_e) {\n    // console.error(\"Refresh failed\", _e);\n  }\n  return null;\n}\n\nexport async function ensureDropprAccessToken(force = false): Promise<string | null> {\n  const state = getDropprTokenState();\n  const now = Date.now();\n\n  // If we have a valid access token (buffer 60s), use it.\n  if (!force && state.access && state.accessExp > now + 60000) {\n    return state.access;\n  }\n\n  // If we have a refresh token, try to refresh\n  if (state.refresh && state.refreshExp > now + 60000) {\n    const newToken = await refreshDropprToken(state.refresh, true);\n    if (newToken) return newToken;\n  }\n\n  // Fallback: try to login (exchange FB token for Droppr token)\n\n  return await loginDropprToken(true);\n}\n\nexport function getSessionExpiryMs(): number {\n  const state = getDropprTokenState();\n\n  if (state.access && state.accessExp) return state.accessExp;\n\n  const fbToken = getFileBrowserToken();\n\n  const payload = decodeJwtPayload(fbToken);\n\n  if (payload && payload.exp) return payload.exp * 1000;\n\n  return 0;\n}\n","import { ensureDropprAccessToken, getSessionExpiryMs } from \"../../services/auth\";\n\nconst SESSION_WARNING_ID = \"droppr-session-warning\";\nconst SESSION_WARNING_STYLE_ID = \"droppr-session-warning-style\";\nconst SESSION_WARNING_THRESHOLD_MS = 5 * 60 * 1000;\n\nexport class SessionWarning {\n  private el: HTMLElement | null = null;\n  private interval: number | null = null;\n\n  constructor() {\n    this.ensureStyles();\n    this.ensureElement();\n    this.start();\n    window.addEventListener(\"droppr:tokens-updated\", () => this.update());\n  }\n\n  private ensureStyles() {\n    if (document.getElementById(SESSION_WARNING_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = SESSION_WARNING_STYLE_ID;\n    style.textContent = `\n      #${SESSION_WARNING_ID} {\n        position: fixed;\n        top: 16px;\n        right: 16px;\n        z-index: 2147483001;\n        background: rgba(15, 23, 42, 0.92);\n        color: #e5e7eb;\n        border: 1px solid rgba(255,255,255,0.15);\n        border-radius: 12px;\n        padding: 10px 12px;\n        font: 12px/1.4 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n        box-shadow: 0 18px 40px -20px rgba(0,0,0,0.65);\n        display: none;\n        gap: 10px;\n        align-items: center;\n      }\n      #${SESSION_WARNING_ID} .btn {\n        border: 0;\n        background: rgba(99,102,241,0.95);\n        color: #fff;\n        font-weight: 700;\n        border-radius: 10px;\n        padding: 6px 10px;\n        cursor: pointer;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  private ensureElement() {\n    let el = document.getElementById(SESSION_WARNING_ID);\n    if (!el) {\n      el = document.createElement(\"div\");\n      el.id = SESSION_WARNING_ID;\n      el.innerHTML =\n        '<span class=\"msg\">Session expiring soon.</span><button class=\"btn\" type=\"button\">Refresh</button>';\n      el.querySelector(\".btn\")?.addEventListener(\"click\", () => {\n        ensureDropprAccessToken(true);\n      });\n      document.body.appendChild(el);\n    }\n    this.el = el;\n  }\n\n  private start() {\n    if (this.interval) return;\n    this.update();\n    this.interval = window.setInterval(() => this.update(), 60000); // Check every minute\n  }\n\n  private update() {\n    if (!this.el) return;\n    const exp = getSessionExpiryMs();\n    if (!exp) {\n      this.el.style.display = \"none\";\n      return;\n    }\n    const remaining = exp - Date.now();\n    if (remaining > SESSION_WARNING_THRESHOLD_MS) {\n      this.el.style.display = \"none\";\n      return;\n    }\n    const minutes = Math.max(1, Math.ceil(remaining / 60000));\n    const msg = this.el.querySelector(\".msg\");\n    if (msg) {\n      msg.textContent = `Session expires in ${minutes} min.`;\n    }\n    this.el.style.display = \"inline-flex\";\n  }\n}\n","import { isLoggedIn } from \"../../services/auth\";\n\nconst ANALYTICS_BTN_ID = \"droppr-analytics-btn\";\nconst ANALYTICS_STYLE_ID = \"droppr-analytics-style\";\n\nexport class AnalyticsButton {\n  constructor() {\n    this.ensureStyles();\n    this.ensureButton();\n  }\n\n  private ensureStyles() {\n    if (document.getElementById(ANALYTICS_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = ANALYTICS_STYLE_ID;\n    style.textContent = `\n      #${ANALYTICS_BTN_ID} {\n        position: fixed;\n        right: 18px;\n        bottom: 18px;\n        z-index: 2147483000;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 12px;\n        border-radius: 999px;\n        background: rgba(99, 102, 241, 0.95);\n        color: #fff !important;\n        text-decoration: none !important;\n        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n        font-weight: 700;\n        letter-spacing: -0.01em;\n        box-shadow: 0 18px 40px -18px rgba(0,0,0,0.65);\n        border: 1px solid rgba(255,255,255,0.18);\n        user-select: none;\n      }\n      #${ANALYTICS_BTN_ID}:hover {\n        background: rgba(79, 70, 229, 0.98);\n        transform: translateY(-1px);\n      }\n      #${ANALYTICS_BTN_ID} .icon {\n        width: 18px;\n        height: 18px;\n        display: inline-block;\n      }\n      #${ANALYTICS_BTN_ID} .label {\n        font-size: 14px;\n        line-height: 1;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  private ensureButton() {\n    const existing = document.getElementById(ANALYTICS_BTN_ID);\n    if (!isLoggedIn()) {\n      if (existing && existing.parentNode) {\n        existing.parentNode.removeChild(existing);\n      }\n      return;\n    }\n\n    if (existing) return;\n\n    const a = document.createElement(\"a\");\n    a.id = ANALYTICS_BTN_ID;\n    a.href = \"/analytics\";\n    a.target = \"_blank\";\n    a.rel = \"noopener\";\n    a.title = \"Dropbox Analytics\";\n    a.innerHTML = `\n      <svg class=\"icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\n        <path fill=\"currentColor\" d=\"M3 3h2v18H3V3zm4 10h2v8H7v-8zm4-6h2v14h-2V7zm4 4h2v10h-2V11zm4-7h2v17h-2V4z\"/>\n      </svg>\n      <span class=\"label\">Analytics</span>\n    `;\n\n    document.body.appendChild(a);\n  }\n}\n","import { ensureDropprAccessToken, getFileBrowserToken } from \"./auth\";\n\nexport async function dropprFetch(url: string, options: RequestInit = {}): Promise<Response> {\n  const opts = { ...options };\n  const headers = new Headers(opts.headers);\n\n  const accessToken = await ensureDropprAccessToken(false);\n\n  if (accessToken) {\n    headers.set(\"Authorization\", \"Bearer \" + accessToken);\n  } else {\n    const fbToken = getFileBrowserToken();\n    if (fbToken) {\n      headers.set(\"X-Auth\", fbToken);\n    }\n  }\n\n  opts.headers = headers;\n  return fetch(url, opts);\n}\n","import { dropprFetch } from \"../../services/api\";\nimport { isLoggedIn } from \"../../services/auth\";\n\nconst SHARE_EXPIRE_STYLE_ID = \"droppr-share-expire-style\";\nconst SHARE_EXPIRE_BTN_CLASS = \"droppr-share-expire-btn\";\nconst SHARE_EXPIRE_STORAGE_KEY = \"droppr_share_expire_hours\";\n\ninterface ShareAlias {\n  alias_id: string;\n  target_path: string;\n  target_expire: number;\n}\n\ninterface ShareAliasResponse {\n  aliases: ShareAlias[];\n}\n\nexport class ShareExpiration {\n  private aliasesState = { loading: false, lastAppliedAt: 0, cache: [] as ShareAlias[] };\n  private observer: MutationObserver | null = null;\n\n  constructor() {\n    this.ensureStyles();\n    this.startWatcher();\n  }\n\n  private ensureStyles() {\n    if (document.getElementById(SHARE_EXPIRE_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = SHARE_EXPIRE_STYLE_ID;\n    style.textContent = `\n      .${SHARE_EXPIRE_BTN_CLASS} { margin-left: 6px; }\n      .${SHARE_EXPIRE_BTN_CLASS}[disabled] { opacity: 0.55; cursor: not-allowed; }\n    `;\n    document.head.appendChild(style);\n  }\n\n  private isSharesPage(): boolean {\n    const p = String((window.location && window.location.pathname) || \"\");\n    return p.indexOf(\"/settings/shares\") !== -1;\n  }\n\n  private extractShareHashFromHref(href: string): string | null {\n    const s = String(href || \"\");\n    let m = s.match(/\\/share\\/([^/?#]+)/);\n    if (m && m[1]) return m[1];\n    m = s.match(/share\\/([^/?#]+)/);\n    if (m && m[1]) return m[1];\n    return null;\n  }\n\n  private getDefaultShareExpireHours(): number {\n    let stored = null;\n    try {\n      stored = localStorage.getItem(SHARE_EXPIRE_STORAGE_KEY);\n    } catch (_e) {\n      stored = null;\n    }\n    const n = stored ? parseInt(stored, 10) : null;\n    if (n == null || n < 0) return 30;\n    return n;\n  }\n\n  private async updateShareExpire(\n    shareHash: string,\n    hours: number,\n    sharePath: string\n  ): Promise<any> {\n    const res = await dropprFetch(\n      \"/api/droppr/shares/\" + encodeURIComponent(shareHash) + \"/expire\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ hours, path: sharePath || \"\" }),\n      }\n    );\n\n    const text = await res.text();\n    if (!res.ok) {\n      throw new Error(\"Update failed (\" + res.status + \"): \" + (text || \"\"));\n    }\n    if (!text) return {};\n    try {\n      return JSON.parse(text);\n    } catch (_e) {\n      return {};\n    }\n  }\n\n  private fmtRelativeExpire(unixSeconds: number | null): string {\n    if (unixSeconds == null) return \"\";\n    const ts = parseInt(String(unixSeconds), 10);\n    if (isNaN(ts)) return \"\";\n    if (ts === 0) return \"permanent\";\n\n    const deltaSec = Math.floor((ts * 1000 - Date.now()) / 1000);\n    if (deltaSec <= 0) return \"expired\";\n\n    const days = Math.floor(deltaSec / 86400);\n    if (days >= 2) return \"in \" + days + \" days\";\n    if (days === 1) return \"in 1 day\";\n\n    const hours = Math.floor(deltaSec / 3600);\n    if (hours >= 2) return \"in \" + hours + \" hours\";\n    if (hours === 1) return \"in 1 hour\";\n\n    const minutes = Math.floor(deltaSec / 60);\n    if (minutes >= 2) return \"in \" + minutes + \" minutes\";\n    if (minutes === 1) return \"in 1 minute\";\n\n    return \"in \" + deltaSec + \" seconds\";\n  }\n\n  private async fetchShareAliases(limit?: number): Promise<ShareAliasResponse> {\n    const q = typeof limit === \"number\" ? \"?limit=\" + String(limit) : \"\";\n    const res = await dropprFetch(\"/api/droppr/shares/aliases\" + q, {\n      method: \"GET\",\n      headers: {},\n    });\n\n    const text = await res.text();\n    if (!res.ok) throw new Error(\"Aliases failed (\" + res.status + \"): \" + (text || \"\"));\n    if (!text) return { aliases: [] };\n    try {\n      return JSON.parse(text);\n    } catch (_e) {\n      return { aliases: [] };\n    }\n  }\n\n  private applyAliasToShareRow(rowEl: HTMLElement, alias: ShareAlias) {\n    if (!rowEl || !alias) return;\n\n    const tds = rowEl.querySelectorAll(\"td\");\n    if (!tds || tds.length < 2) return;\n\n    const expireText = this.fmtRelativeExpire(alias.target_expire);\n    const base = expireText ? \"Aliased (\" + expireText + \")\" : \"Aliased\";\n    tds[1].textContent = base;\n  }\n\n  private async ensureShareAliasesApplied() {\n    if (!isLoggedIn()) return;\n    if (!this.isSharesPage()) return;\n\n    const t = Date.now();\n    if (this.aliasesState.lastAppliedAt && t - this.aliasesState.lastAppliedAt < 2500) return;\n    if (this.aliasesState.loading) return;\n\n    this.aliasesState.loading = true;\n    try {\n      const payload = await this.fetchShareAliases(2000);\n      this.aliasesState.cache = payload && payload.aliases ? payload.aliases : [];\n    } catch (_e) {\n      this.aliasesState.cache = [];\n    } finally {\n      this.aliasesState.loading = false;\n      this.aliasesState.lastAppliedAt = Date.now();\n    }\n\n    const aliases = this.aliasesState.cache || [];\n    if (!aliases || aliases.length === 0) return;\n\n    const rows = document.querySelectorAll(\"tr\");\n    rows.forEach((row) => {\n      const tds = row.querySelectorAll(\"td\");\n      if (!tds || tds.length < 1) return;\n      const link = tds[0].querySelector(\"a\");\n      if (!link) return;\n\n      const href = link.getAttribute(\"href\") || \"\";\n      const hash = this.extractShareHashFromHref(href);\n      if (!hash) return;\n\n      const alias = aliases.find((a) => a.alias_id === hash);\n      if (alias) {\n        this.applyAliasToShareRow(row as HTMLElement, alias);\n      }\n    });\n  }\n\n  private injectButtons() {\n    if (!isLoggedIn()) return;\n    if (!this.isSharesPage()) return;\n\n    // Periodically update aliases\n    this.ensureShareAliasesApplied();\n\n    const lists = document.querySelectorAll(\".card-content table tbody\");\n    if (!lists.length) return;\n\n    lists.forEach((tbody) => {\n      const rows = tbody.querySelectorAll(\"tr\");\n      rows.forEach((row) => {\n        const tds = row.querySelectorAll(\"td\");\n        if (!tds || tds.length < 1) return;\n\n        const host = tds[tds.length - 1]; // Actions column usually last\n        if (!host) return;\n\n        // Find share hash\n        const link = tds[0].querySelector(\"a\");\n        if (!link) return;\n        const href = link.getAttribute(\"href\");\n        const hash = this.extractShareHashFromHref(href || \"\");\n        if (!hash) return;\n\n        // Find share path for context\n        let path = \"\";\n        try {\n          const pathEl = tds[0].querySelector(\".secondary\");\n          if (pathEl) path = pathEl.textContent || \"\";\n        } catch (_e) {\n          /* ignore */\n        }\n\n        if (host.querySelector(\".\" + SHARE_EXPIRE_BTN_CLASS)) return;\n\n        const btn = document.createElement(\"button\");\n        btn.textContent = \"â±\";\n        btn.title = \"Set expiration\";\n        btn.className = \"action \" + SHARE_EXPIRE_BTN_CLASS;\n        btn.style.cursor = \"pointer\";\n\n        btn.onclick = async (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          const defaultHours = this.getDefaultShareExpireHours();\n          const input = prompt(\"Expire share in hours (0=permanent)?\", String(defaultHours));\n          if (input === null) return;\n          const hours = parseInt(input, 10);\n          if (isNaN(hours) || hours < 0) return;\n\n          try {\n            localStorage.setItem(SHARE_EXPIRE_STORAGE_KEY, String(hours));\n          } catch (_err) {\n            /* ignore */\n          }\n\n          btn.disabled = true;\n          try {\n            await this.updateShareExpire(hash, hours, path);\n            alert(\"Expiration set to \" + hours + \" hours.\");\n            // Force refresh of aliases to show new expiration\n            this.aliasesState.lastAppliedAt = 0;\n            this.ensureShareAliasesApplied();\n          } catch (err) {\n            alert(\"Failed to set expiration: \" + err);\n          } finally {\n            btn.disabled = false;\n          }\n        };\n\n        host.appendChild(btn);\n      });\n    });\n  }\n\n  private startWatcher() {\n    // Initial check\n    this.injectButtons();\n\n    // Watch for DOM changes (FileBrowser is an SPA that re-renders tables)\n    this.observer = new MutationObserver(() => {\n      this.injectButtons();\n    });\n\n    this.observer.observe(document.body, { childList: true, subtree: true });\n  }\n}\n","import { dropprFetch } from \"./api\";\nimport { isLoggedIn } from \"./auth\";\n\ninterface AdminConfig {\n  root?: string;\n  username_pattern?: string;\n  password_min_length?: number;\n  password_rules?: any;\n}\n\nclass AdminService {\n  public isAdmin: boolean | null = null;\n  public config: AdminConfig = {\n    root: \"/users\",\n    password_min_length: 8,\n  };\n  private checkPromise: Promise<boolean> | null = null;\n\n  async check(): Promise<boolean> {\n    if (!isLoggedIn()) {\n      this.isAdmin = false;\n      return false;\n    }\n    if (this.isAdmin !== null) return this.isAdmin;\n    if (this.checkPromise) return this.checkPromise;\n\n    this.checkPromise = dropprFetch(\"/api/droppr/users\", {})\n      .then(async (res) => {\n        if (!res.ok) {\n          this.isAdmin = false;\n          return false;\n        }\n        try {\n          const data = await res.json();\n          this.config = { ...this.config, ...data };\n          this.isAdmin = true;\n          return true;\n        } catch {\n          this.isAdmin = false;\n          return false;\n        }\n      })\n      .catch(() => {\n        this.isAdmin = false;\n        return false;\n      })\n      .finally(() => {\n        this.checkPromise = null;\n      });\n\n    return this.checkPromise;\n  }\n}\n\nexport const adminService = new AdminService();\n","import { dropprFetch } from \"../../services/api\";\n\nconst ACCOUNTS_MODAL_ID = \"droppr-accounts-modal\";\nconst ACCOUNTS_STYLE_ID = \"droppr-accounts-style\";\nconst PASSWORD_MIN_LEN = 8;\nconst USERNAME_RE = /^[A-Za-z0-9][A-Za-z0-9_-]{2,31}$/;\n\nexport class AccountsModal {\n  constructor() {}\n\n  public show() {\n    this.ensureStyles();\n    this.render();\n  }\n\n  private ensureStyles() {\n    if (document.getElementById(ACCOUNTS_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = ACCOUNTS_STYLE_ID;\n    style.textContent = `\n      #${ACCOUNTS_MODAL_ID} {\n        position: fixed;\n        inset: 0;\n        z-index: 2147483002;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: rgba(2, 6, 23, 0.6);\n        padding: 24px;\n        backdrop-filter: blur(4px);\n      }\n      #${ACCOUNTS_MODAL_ID} .panel {\n        width: 440px;\n        max-width: calc(100vw - 48px);\n        border-radius: 16px;\n        background: var(--droppr-overlay-bg, rgba(17, 24, 39, 0.98));\n        color: var(--text-primary, #e5e7eb);\n        border: 1px solid var(--droppr-overlay-border, rgba(255,255,255,0.12));\n        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);\n        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n        overflow: hidden;\n      }\n      #${ACCOUNTS_MODAL_ID} .hdr {\n        display: flex;\n        align-items: flex-start;\n        justify-content: space-between;\n        gap: 12px;\n        padding: 20px 24px 16px 24px;\n        border-bottom: 1px solid var(--droppr-overlay-border, rgba(255,255,255,0.08));\n      }\n      #${ACCOUNTS_MODAL_ID} .title {\n        font-size: 18px;\n        font-weight: 700;\n        color: var(--text-primary, #fff);\n      }\n      #${ACCOUNTS_MODAL_ID} .subtitle {\n        font-size: 13px;\n        margin-top: 4px;\n        color: var(--text-secondary, rgba(229,231,235,0.6));\n      }\n      #${ACCOUNTS_MODAL_ID} .close {\n        appearance: none;\n        border: 0;\n        background: transparent;\n        color: var(--text-secondary, rgba(229,231,235,0.6));\n        cursor: pointer;\n        font-size: 24px;\n        line-height: 1;\n        padding: 4px;\n        border-radius: 6px;\n      }\n      #${ACCOUNTS_MODAL_ID} .close:hover {\n        color: #fff;\n        background: rgba(255,255,255,0.1);\n      }\n      #${ACCOUNTS_MODAL_ID} .body {\n        padding: 24px;\n      }\n      #${ACCOUNTS_MODAL_ID} .label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        margin-bottom: 6px;\n        color: var(--text-primary, #e5e7eb);\n      }\n      #${ACCOUNTS_MODAL_ID} input[type=\"text\"],\n      #${ACCOUNTS_MODAL_ID} input[type=\"password\"] {\n        display: block;\n        width: 100%;\n        margin-bottom: 16px;\n        padding: 10px 12px;\n        border-radius: 8px;\n        border: 1px solid var(--border-color, rgba(255,255,255,0.15));\n        background: var(--input-bg, rgba(0,0,0,0.3));\n        color: var(--text-primary, #fff);\n        font-size: 14px;\n      }\n      #${ACCOUNTS_MODAL_ID} input:focus {\n        border-color: rgba(99,102,241,0.8);\n        outline: none;\n        box-shadow: 0 0 0 2px rgba(99,102,241,0.25);\n      }\n      #${ACCOUNTS_MODAL_ID} .password-meter {\n        margin-bottom: 16px;\n      }\n      #${ACCOUNTS_MODAL_ID} .password-meter .bar {\n        height: 4px;\n        background: rgba(255,255,255,0.1);\n        border-radius: 2px;\n        margin-bottom: 6px;\n        overflow: hidden;\n      }\n      #${ACCOUNTS_MODAL_ID} .password-meter .bar span {\n        display: block;\n        height: 100%;\n        width: 0%;\n        transition: width 0.3s ease, background-color 0.3s ease;\n      }\n      #${ACCOUNTS_MODAL_ID} .password-meter.weak .bar span { background: #ef4444; }\n      #${ACCOUNTS_MODAL_ID} .password-meter.medium .bar span { background: #f59e0b; }\n      #${ACCOUNTS_MODAL_ID} .password-meter.strong .bar span { background: #10b981; }\n      #${ACCOUNTS_MODAL_ID} .password-meter .label {\n        font-size: 11px;\n        color: var(--text-secondary, rgba(229,231,235,0.6));\n        text-align: right;\n        margin: 0;\n        font-weight: 400;\n      }\n      #${ACCOUNTS_MODAL_ID} .note {\n        font-size: 13px;\n        color: var(--text-secondary, rgba(229,231,235,0.7));\n        margin-bottom: 20px;\n        padding: 12px;\n        background: rgba(255,255,255,0.05);\n        border-radius: 8px;\n      }\n      #${ACCOUNTS_MODAL_ID} .status {\n        font-size: 13px;\n        margin-bottom: 16px;\n        min-height: 20px;\n      }\n      #${ACCOUNTS_MODAL_ID} .status.error { color: #ef4444; }\n      #${ACCOUNTS_MODAL_ID} .status.success { color: #10b981; }\n      #${ACCOUNTS_MODAL_ID} .actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n      }\n      #${ACCOUNTS_MODAL_ID} .btn {\n        padding: 10px 16px;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        border: none;\n        transition: all 0.2s;\n      }\n      #${ACCOUNTS_MODAL_ID} .btn.secondary {\n        background: transparent;\n        color: var(--text-primary, #e5e7eb);\n        border: 1px solid var(--border-color, rgba(255,255,255,0.15));\n      }\n      #${ACCOUNTS_MODAL_ID} .btn.secondary:hover {\n        background: rgba(255,255,255,0.05);\n      }\n      #${ACCOUNTS_MODAL_ID} .btn.primary {\n        background: rgba(99,102,241,0.95);\n        color: white;\n      }\n      #${ACCOUNTS_MODAL_ID} .btn.primary:hover {\n        background: rgba(79,70,229,1);\n        transform: translateY(-1px);\n      }\n      #${ACCOUNTS_MODAL_ID} .btn[disabled] {\n        opacity: 0.5;\n        cursor: not-allowed;\n        transform: none !important;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  private render() {\n    const existing = document.getElementById(ACCOUNTS_MODAL_ID);\n    if (existing && existing.parentNode) existing.parentNode.removeChild(existing);\n\n    const overlay = document.createElement(\"div\");\n    overlay.id = ACCOUNTS_MODAL_ID;\n\n    const panel = document.createElement(\"div\");\n    panel.className = \"panel\";\n    panel.innerHTML = `\n      <div class=\"hdr\">\n        <div>\n          <div class=\"title\">Create upload account</div>\n          <div class=\"subtitle\">Each account only sees its own folder.</div>\n        </div>\n        <button type=\"button\" class=\"close\" aria-label=\"Close\">&times;</button>\n      </div>\n      <div class=\"body\">\n        <label class=\"label\" for=\"droppr-account-username\">Username</label>\n        <input id=\"droppr-account-username\" type=\"text\" autocomplete=\"off\" placeholder=\"letters, numbers, _ or -\">\n        \n        <label class=\"label\" for=\"droppr-account-password\">Password</label>\n        <input id=\"droppr-account-password\" type=\"password\" autocomplete=\"new-password\" placeholder=\"at least ${PASSWORD_MIN_LEN} characters\">\n        \n        <div class=\"password-meter\" id=\"droppr-account-meter\">\n          <div class=\"bar\"><span></span></div>\n          <div class=\"label\" id=\"droppr-account-meter-label\">Password strength</div>\n        </div>\n        \n        <div class=\"note\">Home folder: <span id=\"droppr-account-scope\"></span></div>\n        \n        <div class=\"status\" id=\"droppr-account-status\" aria-live=\"polite\"></div>\n        \n        <div class=\"actions\">\n          <button type=\"button\" class=\"btn secondary\" data-action=\"cancel\">Cancel</button>\n          <button type=\"button\" class=\"btn primary\" data-action=\"create\">Create</button>\n        </div>\n      </div>\n    `;\n\n    overlay.appendChild(panel);\n    document.body.appendChild(overlay);\n\n    this.bindEvents(panel, overlay);\n  }\n\n  private bindEvents(panel: HTMLElement, overlay: HTMLElement) {\n    const usernameInput = panel.querySelector(\"#droppr-account-username\") as HTMLInputElement;\n    const passwordInput = panel.querySelector(\"#droppr-account-password\") as HTMLInputElement;\n    const scopeLabel = panel.querySelector(\"#droppr-account-scope\");\n    const statusEl = panel.querySelector(\"#droppr-account-status\");\n    const closeBtn = panel.querySelector(\".close\");\n    const cancelBtn = panel.querySelector('[data-action=\"cancel\"]');\n    const createBtn = panel.querySelector('[data-action=\"create\"]') as HTMLButtonElement;\n    const meter = panel.querySelector(\"#droppr-account-meter\");\n    const meterLabel = panel.querySelector(\"#droppr-account-meter-label\");\n    const meterBar = meter ? (meter.querySelector(\".bar span\") as HTMLElement) : null;\n\n    const setStatus = (text: string, tone?: string) => {\n      if (!statusEl) return;\n      statusEl.textContent = text || \"\";\n      statusEl.className = \"status\" + (tone ? \" \" + tone : \"\");\n    };\n\n    const updatePasswordMeter = () => {\n      if (!meter || !meterLabel || !meterBar || !passwordInput) return;\n      const password = String(passwordInput.value || \"\");\n      if (!password) {\n        meter.className = \"password-meter\";\n        meterBar.style.width = \"0%\";\n        meterLabel.textContent = \"Password strength\";\n        return;\n      }\n\n      const checks = [];\n      checks.push({ ok: password.length >= PASSWORD_MIN_LEN, label: \"length\" });\n      checks.push({ ok: /[A-Z]/.test(password), label: \"upper\" });\n      checks.push({ ok: /[a-z]/.test(password), label: \"lower\" });\n      checks.push({ ok: /[0-9]/.test(password), label: \"digit\" });\n      checks.push({ ok: /[^A-Za-z0-9]/.test(password), label: \"symbol\" });\n\n      const passed = checks.filter((c) => c.ok).length;\n      const total = checks.length || 1;\n      const pct = Math.round((passed / total) * 100);\n      meterBar.style.width = pct + \"%\";\n\n      let label = \"Weak\";\n      meter.className = \"password-meter weak\";\n      if (pct >= 80) {\n        label = \"Strong\";\n        meter.className = \"password-meter strong\";\n      } else if (pct >= 50) {\n        label = \"Medium\";\n        meter.className = \"password-meter medium\";\n      }\n      meterLabel.textContent = \"Strength: \" + label;\n    };\n\n    const formatAccountScope = (username: string) => {\n      return username ? `/users/${username}` : \"/users/...\";\n    };\n\n    const updateScope = () => {\n      if (!scopeLabel || !usernameInput) return;\n      scopeLabel.textContent = formatAccountScope(String(usernameInput.value || \"\").trim());\n    };\n\n    const closeModal = () => {\n      if (overlay && overlay.parentNode) overlay.parentNode.removeChild(overlay);\n    };\n\n    const submit = async () => {\n      if (!usernameInput || !passwordInput || !createBtn) return;\n      const username = String(usernameInput.value || \"\").trim();\n      const password = String(passwordInput.value || \"\");\n\n      setStatus(\"\", \"\");\n\n      if (!USERNAME_RE.test(username)) {\n        setStatus(\"Username must be 3-32 characters (letters, numbers, _ or -).\", \"error\");\n        return;\n      }\n\n      if (password.length < PASSWORD_MIN_LEN) {\n        setStatus(`Password must be at least ${PASSWORD_MIN_LEN} characters.`, \"error\");\n        return;\n      }\n\n      createBtn.disabled = true;\n      try {\n        const res = await dropprFetch(\"/api/droppr/users\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ username, password }),\n        });\n\n        let data: { error?: string; scope?: string } = {};\n        try {\n          data = await res.json();\n        } catch (_e) {\n          /* ignore */\n        }\n\n        if (!res.ok) {\n          const msg = data && data.error ? data.error : \"Request failed (\" + res.status + \")\";\n          throw new Error(msg);\n        }\n\n        const scope = data && data.scope ? data.scope : formatAccountScope(username);\n        setStatus(\"Account created. Folder: \" + scope, \"success\");\n        passwordInput.value = \"\";\n        try {\n          usernameInput.select();\n        } catch (_e2) {\n          /* ignore */\n        }\n      } catch (err: unknown) {\n        const msg = err instanceof Error ? err.message : String(err);\n        setStatus(msg, \"error\");\n      } finally {\n        createBtn.disabled = true; // Wait, why true here? It was false in original.\n        // Actually it should be false to re-enable it.\n        createBtn.disabled = false;\n      }\n    };\n\n    updateScope();\n    updatePasswordMeter();\n\n    usernameInput?.addEventListener(\"input\", updateScope);\n    passwordInput?.addEventListener(\"input\", updatePasswordMeter);\n    closeBtn?.addEventListener(\"click\", closeModal);\n    cancelBtn?.addEventListener(\"click\", closeModal);\n    overlay.addEventListener(\"click\", (e) => {\n      if (e.target === overlay) closeModal();\n    });\n    panel.addEventListener(\"keydown\", (e) => {\n      if (e.key === \"Enter\") {\n        e.preventDefault();\n        submit();\n      }\n    });\n    createBtn?.addEventListener(\"click\", submit);\n\n    try {\n      usernameInput?.focus();\n    } catch (_e) {\n      /* ignore */\n    }\n  }\n}\n","import { dropprFetch } from \"../../services/api\";\n\nconst REQUEST_MODAL_ID = \"droppr-request-modal\";\nconst REQUEST_STYLE_ID = \"droppr-request-style\";\nconst REQUEST_EXPIRE_STORAGE_KEY = \"droppr_request_expire_hours\";\n\nexport class RequestModal {\n  constructor() {}\n\n  public show() {\n    this.ensureStyles();\n    this.render();\n  }\n\n  private ensureStyles() {\n    if (document.getElementById(REQUEST_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = REQUEST_STYLE_ID;\n    style.textContent = `\n      #${REQUEST_MODAL_ID} {\n        position: fixed;\n        inset: 0;\n        z-index: 2147483002;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: rgba(2, 6, 23, 0.6);\n        padding: 24px;\n        backdrop-filter: blur(4px);\n      }\n      #${REQUEST_MODAL_ID} .panel {\n        width: 520px;\n        max-width: calc(100vw - 48px);\n        border-radius: 16px;\n        background: var(--droppr-overlay-bg, rgba(17, 24, 39, 0.98));\n        color: var(--text-primary, #e5e7eb);\n        border: 1px solid var(--droppr-overlay-border, rgba(255,255,255,0.12));\n        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);\n        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n        overflow: hidden;\n      }\n      #${REQUEST_MODAL_ID} .hdr {\n        display: flex;\n        align-items: flex-start;\n        justify-content: space-between;\n        gap: 12px;\n        padding: 20px 24px 16px 24px;\n        border-bottom: 1px solid var(--droppr-overlay-border, rgba(255,255,255,0.08));\n      }\n      #${REQUEST_MODAL_ID} .title {\n        font-size: 18px;\n        font-weight: 700;\n        color: var(--text-primary, #fff);\n      }\n      #${REQUEST_MODAL_ID} .subtitle {\n        font-size: 13px;\n        margin-top: 4px;\n        color: var(--text-secondary, rgba(229,231,235,0.6));\n      }\n      #${REQUEST_MODAL_ID} .close {\n        appearance: none;\n        border: 0;\n        background: transparent;\n        color: var(--text-secondary, rgba(229,231,235,0.6));\n        cursor: pointer;\n        font-size: 24px;\n        line-height: 1;\n        padding: 4px;\n        border-radius: 6px;\n      }\n      #${REQUEST_MODAL_ID} .close:hover {\n        color: #fff;\n        background: rgba(255,255,255,0.1);\n      }\n      #${REQUEST_MODAL_ID} .body {\n        padding: 24px;\n      }\n      #${REQUEST_MODAL_ID} .label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        margin-bottom: 6px;\n        color: var(--text-primary, #e5e7eb);\n      }\n      #${REQUEST_MODAL_ID} input[type=\"text\"],\n      #${REQUEST_MODAL_ID} input[type=\"password\"],\n      #${REQUEST_MODAL_ID} input[type=\"number\"] {\n        display: block;\n        width: 100%;\n        margin-bottom: 16px;\n        padding: 10px 12px;\n        border-radius: 8px;\n        border: 1px solid var(--border-color, rgba(255,255,255,0.15));\n        background: var(--input-bg, rgba(0,0,0,0.3));\n        color: var(--text-primary, #fff);\n        font-size: 14px;\n      }\n      #${REQUEST_MODAL_ID} input:focus {\n        border-color: rgba(99,102,241,0.8);\n        outline: none;\n        box-shadow: 0 0 0 2px rgba(99,102,241,0.25);\n      }\n      #${REQUEST_MODAL_ID} .row {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 16px;\n      }\n      #${REQUEST_MODAL_ID} .switch {\n        position: relative;\n        display: inline-block;\n        width: 44px;\n        height: 24px;\n      }\n      #${REQUEST_MODAL_ID} .switch input { opacity: 0; width: 0; height: 0; }\n      #${REQUEST_MODAL_ID} .slider {\n        position: absolute;\n        cursor: pointer;\n        top: 0; left: 0; right: 0; bottom: 0;\n        background-color: rgba(255,255,255,0.1);\n        transition: .4s;\n        border-radius: 24px;\n      }\n      #${REQUEST_MODAL_ID} .slider:before {\n        position: absolute;\n        content: \"\";\n        height: 18px;\n        width: 18px;\n        left: 3px;\n        bottom: 3px;\n        background-color: white;\n        transition: .4s;\n        border-radius: 50%;\n      }\n      #${REQUEST_MODAL_ID} input:checked + .slider { background-color: #6366f1; }\n      #${REQUEST_MODAL_ID} input:checked + .slider:before { transform: translateX(20px); }\n      #${REQUEST_MODAL_ID} .password-wrap {\n        display: none;\n      }\n      #${REQUEST_MODAL_ID} .password-wrap.show {\n        display: block;\n      }\n      #${REQUEST_MODAL_ID} .status {\n        font-size: 13px;\n        margin-bottom: 16px;\n        min-height: 20px;\n      }\n      #${REQUEST_MODAL_ID} .status.error { color: #ef4444; }\n      #${REQUEST_MODAL_ID} .status.success { color: #10b981; }\n      #${REQUEST_MODAL_ID} .result {\n        display: none;\n        margin-top: 16px;\n        padding-top: 16px;\n        border-top: 1px solid var(--border-color, rgba(255,255,255,0.1));\n      }\n      #${REQUEST_MODAL_ID} .result.show { display: block; }\n      #${REQUEST_MODAL_ID} .link-row {\n        display: flex;\n        gap: 8px;\n      }\n      #${REQUEST_MODAL_ID} .link-row input { margin-bottom: 0; }\n      #${REQUEST_MODAL_ID} .actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        margin-top: 24px;\n      }\n      #${REQUEST_MODAL_ID} .btn {\n        padding: 10px 16px;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        border: none;\n        transition: all 0.2s;\n      }\n      #${REQUEST_MODAL_ID} .btn.secondary {\n        background: transparent;\n        color: var(--text-primary, #e5e7eb);\n        border: 1px solid var(--border-color, rgba(255,255,255,0.15));\n      }\n      #${REQUEST_MODAL_ID} .btn.secondary:hover {\n        background: rgba(255,255,255,0.05);\n      }\n      #${REQUEST_MODAL_ID} .btn.primary {\n        background: rgba(99,102,241,0.95);\n        color: white;\n      }\n      #${REQUEST_MODAL_ID} .btn.primary:hover {\n        background: rgba(79,70,229,1);\n        transform: translateY(-1px);\n      }\n      #${REQUEST_MODAL_ID} .btn[disabled] {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  private render() {\n    const existing = document.getElementById(REQUEST_MODAL_ID);\n    if (existing && existing.parentNode) existing.parentNode.removeChild(existing);\n\n    const overlay = document.createElement(\"div\");\n    overlay.id = REQUEST_MODAL_ID;\n\n    const panel = document.createElement(\"div\");\n    panel.className = \"panel\";\n    panel.innerHTML = `\n      <div class=\"hdr\">\n        <div>\n          <div class=\"title\">Create file request</div>\n          <div class=\"subtitle\">Recipients can upload without seeing other files.</div>\n        </div>\n        <button type=\"button\" class=\"close\" aria-label=\"Close\">&times;</button>\n      </div>\n      <div class=\"body\">\n        <label class=\"label\" for=\"droppr-request-path\">Folder path</label>\n        <input id=\"droppr-request-path\" type=\"text\" autocomplete=\"off\" placeholder=\"/uploads/team-a\">\n        \n        <label class=\"label\" for=\"droppr-request-expire\">Expires in hours (0 = never)</label>\n        <input id=\"droppr-request-expire\" type=\"number\" min=\"0\" step=\"1\" inputmode=\"numeric\">\n        \n        <div class=\"row\">\n          <span class=\"label\">Password protection</span>\n          <label class=\"switch\">\n            <input id=\"droppr-request-password-toggle\" type=\"checkbox\">\n            <span class=\"slider\"></span>\n          </label>\n        </div>\n        \n        <div class=\"password-wrap\" id=\"droppr-request-password-wrap\">\n          <input id=\"droppr-request-password\" type=\"password\" autocomplete=\"new-password\" placeholder=\"Optional password\">\n        </div>\n        \n        <div class=\"status\" id=\"droppr-request-status\" aria-live=\"polite\"></div>\n        \n        <div class=\"result\" id=\"droppr-request-result\">\n          <div class=\"label\">Request link</div>\n          <div class=\"link-row\">\n            <input id=\"droppr-request-link\" type=\"text\" readonly>\n            <button type=\"button\" class=\"btn secondary\" data-action=\"copy\">Copy</button>\n            <button type=\"button\" class=\"btn secondary\" data-action=\"open\">Open</button>\n          </div>\n        </div>\n        \n        <div class=\"actions\">\n          <button type=\"button\" class=\"btn secondary\" data-action=\"cancel\">Cancel</button>\n          <button type=\"button\" class=\"btn primary\" data-action=\"create\">Create link</button>\n        </div>\n      </div>\n    `;\n\n    overlay.appendChild(panel);\n    document.body.appendChild(overlay);\n\n    this.bindEvents(panel, overlay);\n  }\n\n  private bindEvents(panel: HTMLElement, overlay: HTMLElement) {\n    const pathInput = panel.querySelector(\"#droppr-request-path\") as HTMLInputElement;\n    const expireInput = panel.querySelector(\"#droppr-request-expire\") as HTMLInputElement;\n    const toggleInput = panel.querySelector(\"#droppr-request-password-toggle\") as HTMLInputElement;\n    const passwordWrap = panel.querySelector(\"#droppr-request-password-wrap\");\n    const passwordInput = panel.querySelector(\"#droppr-request-password\") as HTMLInputElement;\n    const statusEl = panel.querySelector(\"#droppr-request-status\");\n    const resultEl = panel.querySelector(\"#droppr-request-result\");\n    const linkInput = panel.querySelector(\"#droppr-request-link\") as HTMLInputElement;\n    const closeBtn = panel.querySelector(\".close\");\n    const cancelBtn = panel.querySelector('[data-action=\"cancel\"]');\n    const createBtn = panel.querySelector('[data-action=\"create\"]') as HTMLButtonElement;\n    const copyBtn = panel.querySelector('[data-action=\"copy\"]') as HTMLButtonElement;\n    const openBtn = panel.querySelector('[data-action=\"open\"]');\n\n    const setStatus = (text: string, tone?: string) => {\n      if (!statusEl) return;\n      statusEl.textContent = text || \"\";\n      statusEl.className = \"status\" + (tone ? \" \" + tone : \"\");\n    };\n\n    const setResult = (link: string) => {\n      if (!resultEl || !linkInput) return;\n      linkInput.value = link || \"\";\n      resultEl.classList.add(\"show\");\n    };\n\n    const closeModal = () => {\n      if (overlay && overlay.parentNode) overlay.parentNode.removeChild(overlay);\n    };\n\n    const updateToggle = () => {\n      if (!toggleInput || !passwordWrap) return;\n      if (toggleInput.checked) {\n        passwordWrap.classList.add(\"show\");\n      } else {\n        passwordWrap.classList.remove(\"show\");\n      }\n    };\n\n    const submit = async () => {\n      if (!pathInput || !expireInput || !createBtn) return;\n      let path = String(pathInput.value || \"\").trim();\n      if (!path) {\n        setStatus(\"Folder path is required.\", \"error\");\n        return;\n      }\n      if (path.charAt(0) !== \"/\") path = \"/\" + path;\n\n      const hoursRaw = String(expireInput.value || \"0\").trim();\n      const hours = parseInt(hoursRaw, 10);\n      if (isNaN(hours) || hours < 0) {\n        setStatus(\"Expiration must be 0 or a positive number.\", \"error\");\n        return;\n      }\n\n      let password = \"\";\n      if (toggleInput && toggleInput.checked) {\n        password = String(passwordInput.value || \"\");\n        if (!password) {\n          setStatus(\"Password cannot be empty when enabled.\", \"error\");\n          return;\n        }\n      }\n\n      try {\n        localStorage.setItem(REQUEST_EXPIRE_STORAGE_KEY, String(hours));\n      } catch (_e1) {\n        // ignore\n      }\n\n      createBtn.disabled = true;\n      setStatus(\"Creating request link...\", \"\");\n\n      try {\n        const res = await dropprFetch(\"/api/droppr/requests\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ path, expires_hours: hours, password }),\n        });\n\n        let data: { error?: string; url?: string; hash?: string } = {};\n        try {\n          data = await res.json();\n        } catch (_e) {\n          /* ignore */\n        }\n\n        if (!res.ok) {\n          const msg = data && data.error ? data.error : \"Request failed (\" + res.status + \")\";\n          throw new Error(msg);\n        }\n\n        const url = data && data.url ? data.url : \"/request/\" + (data.hash || \"\");\n        const link = window.location.origin + url;\n        setStatus(\"Request link ready.\", \"success\");\n        setResult(link);\n      } catch (err: unknown) {\n        const msg = err instanceof Error ? err.message : String(err);\n        setStatus(msg, \"error\");\n      } finally {\n        createBtn.disabled = false;\n      }\n    };\n\n    toggleInput?.addEventListener(\"change\", updateToggle);\n    closeBtn?.addEventListener(\"click\", closeModal);\n    cancelBtn?.addEventListener(\"click\", closeModal);\n\n    copyBtn?.addEventListener(\"click\", async () => {\n      try {\n        await navigator.clipboard.writeText(linkInput.value);\n        copyBtn.textContent = \"Copied\";\n        setTimeout(() => (copyBtn.textContent = \"Copy\"), 1500);\n      } catch (_e) {\n        linkInput.select();\n        document.execCommand(\"copy\");\n      }\n    });\n\n    openBtn?.addEventListener(\"click\", () => {\n      window.open(linkInput.value, \"_blank\");\n    });\n\n    createBtn?.addEventListener(\"click\", submit);\n\n    overlay.addEventListener(\"click\", (e) => {\n      if (e.target === overlay) closeModal();\n    });\n  }\n}\n","import { isLoggedIn } from \"../../services/auth\";\nimport { adminService } from \"../../services/admin\";\nimport { AccountsModal } from \"./AccountsModal\";\nimport { RequestModal } from \"./RequestModal\";\n\nconst STREAM_BTN_ID = \"droppr-stream-btn\";\nconst STREAM_BTN_STYLE_ID = \"droppr-stream-style\";\nconst ACCOUNTS_BTN_ID = \"droppr-accounts-btn\";\nconst ACCOUNTS_STYLE_ID = \"droppr-accounts-style\";\nconst REQUEST_BTN_ID = \"droppr-request-btn\";\nconst REQUEST_STYLE_ID = \"droppr-request-style\";\n\nexport class HeaderButtons {\n  private accountsModal = new AccountsModal();\n  private requestModal = new RequestModal();\n  private observer: MutationObserver | null = null;\n\n  constructor() {\n    this.ensureStreamStyles();\n    this.ensureAccountsStyles();\n    this.ensureRequestStyles();\n    this.startWatcher();\n  }\n\n  private startWatcher() {\n    this.checkButtons();\n    // Watch for URL changes (SPA navigation)\n    let lastPath = window.location.pathname;\n    this.observer = new MutationObserver(() => {\n      if (window.location.pathname !== lastPath) {\n        lastPath = window.location.pathname;\n        this.checkButtons();\n      } else {\n        // Also check periodically if buttons are missing but should be there (DOM redraws)\n        this.checkButtons();\n      }\n    });\n    this.observer.observe(document.body, { childList: true, subtree: true });\n  }\n\n  private checkButtons() {\n    this.ensureStreamButton();\n    this.ensureAccountsButton();\n    this.ensureRequestButton();\n  }\n\n  // ============ STREAM BUTTON ============\n  private ensureStreamStyles() {\n    if (document.getElementById(STREAM_BTN_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = STREAM_BTN_STYLE_ID;\n    style.textContent = `\n      #${STREAM_BTN_ID} {\n        position: fixed;\n        bottom: 76px;\n        right: 16px;\n        z-index: 9999;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        padding: 10px 14px;\n        background: #6366f1;\n        color: #fff;\n        border: none;\n        border-radius: 24px;\n        font-size: 13px;\n        font-weight: 600;\n        text-decoration: none;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        transition: all 0.2s ease;\n      }\n      #${STREAM_BTN_ID}:hover {\n        background: #818cf8;\n        transform: translateY(-2px);\n        box-shadow: 0 6px 16px rgba(99, 102, 241, 0.5);\n      }\n      #${STREAM_BTN_ID} .icon {\n        width: 18px;\n        height: 18px;\n      }\n      #${STREAM_BTN_ID} .label {\n        line-height: 1;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  private getShareHashFromUrl(): string | null {\n    const path = window.location.pathname || \"\";\n    // Match /gallery/<hash> or /media/<hash>\n    const m = path.match(/^\\/(?:gallery|media)\\/([A-Za-z0-9_-]+)/);\n    if (m) return m[1];\n    // Match share param in query string\n    const params = new URLSearchParams(window.location.search);\n    const share = params.get(\"share\");\n    if (share && /^[A-Za-z0-9_-]+$/.test(share)) return share;\n    return null;\n  }\n\n  private ensureStreamButton() {\n    const existing = document.getElementById(STREAM_BTN_ID) as HTMLAnchorElement | null;\n    const shareHash = this.getShareHashFromUrl();\n\n    if (!shareHash) {\n      if (existing && existing.parentNode) {\n        existing.parentNode.removeChild(existing);\n      }\n      return;\n    }\n\n    if (existing) {\n      existing.href = \"/stream/\" + shareHash;\n      return;\n    }\n\n    const a = document.createElement(\"a\");\n    a.id = STREAM_BTN_ID;\n    a.href = \"/stream/\" + shareHash;\n    a.target = \"_blank\";\n    a.rel = \"noopener\";\n    a.title = \"Open Stream Gallery (optimized video player for large files)\";\n    a.innerHTML = `\n      <svg class=\"icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\n        <path fill=\"currentColor\" d=\"M8 5v14l11-7z\"/>\n      </svg>\n      <span class=\"label\">Stream</span>\n    `;\n\n    document.body.appendChild(a);\n  }\n\n  // ============ ACCOUNTS BUTTON ============\n  private ensureAccountsStyles() {\n    if (document.getElementById(ACCOUNTS_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = ACCOUNTS_STYLE_ID;\n    style.textContent = `\n      #${ACCOUNTS_BTN_ID} {\n        position: fixed;\n        right: 18px;\n        bottom: 66px;\n        z-index: 2147483000;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 12px;\n        border-radius: 999px;\n        background: rgba(16, 185, 129, 0.95);\n        color: #fff !important;\n        text-decoration: none !important;\n        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n        font-weight: 700;\n        letter-spacing: -0.01em;\n        box-shadow: 0 18px 40px -18px rgba(0,0,0,0.65);\n        border: 1px solid rgba(255,255,255,0.18);\n        user-select: none;\n        cursor: pointer;\n      }\n      #${ACCOUNTS_BTN_ID}:hover {\n        background: rgba(5, 150, 105, 0.98);\n        transform: translateY(-1px);\n      }\n      #${ACCOUNTS_BTN_ID} .icon {\n        width: 18px;\n        height: 18px;\n        display: inline-block;\n      }\n      #${ACCOUNTS_BTN_ID} .label {\n        font-size: 14px;\n        line-height: 1;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  private isFilesPage() {\n    // Only show on file browser main list (usually /files)\n    return window.location.pathname.startsWith(\"/files\");\n  }\n\n  private async ensureAccountsButton() {\n    const existing = document.getElementById(ACCOUNTS_BTN_ID);\n    if (!isLoggedIn() || !this.isFilesPage()) {\n      if (existing && existing.parentNode) existing.parentNode.removeChild(existing);\n      return;\n    }\n\n    // Check admin status\n    const isAdmin = await adminService.check();\n    if (!isAdmin) {\n      if (existing && existing.parentNode) existing.parentNode.removeChild(existing);\n      return;\n    }\n\n    if (existing) return;\n\n    const btn = document.createElement(\"button\");\n    btn.id = ACCOUNTS_BTN_ID;\n    btn.type = \"button\";\n    btn.title = \"Create upload account\";\n    btn.setAttribute(\"aria-label\", \"Create upload account\");\n    btn.innerHTML = `\n      <svg class=\"icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\n        <path fill=\"currentColor\" d=\"M15 12c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4zm-6 0c1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3 1.3 3 3 3zm6 2c-2.7 0-8 1.3-8 4v2h16v-2c0-2.7-5.3-4-8-4zm-6 0c-.3 0-.8 0-1.3.1 1.8 1.2 2.3 2.7 2.3 3.9v2H2v-2c0-2 3.6-4 7-4zm11-2v-2h-2V8h-2v2h-2v2h2v2h2v-2h2z\"/>\n      </svg>\n      <span class=\"label\">Accounts</span>\n    `;\n\n    btn.addEventListener(\"click\", () => this.accountsModal.show());\n    document.body.appendChild(btn);\n  }\n\n  // ============ REQUEST BUTTON ============\n  private ensureRequestStyles() {\n    if (document.getElementById(REQUEST_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = REQUEST_STYLE_ID;\n    style.textContent = `\n      #${REQUEST_BTN_ID} {\n        position: fixed;\n        right: 18px;\n        bottom: 114px;\n        z-index: 2147483000;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 12px;\n        border-radius: 999px;\n        background: rgba(0, 97, 255, 0.95);\n        color: #fff !important;\n        text-decoration: none !important;\n        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n        font-weight: 700;\n        letter-spacing: -0.01em;\n        box-shadow: 0 18px 40px -18px rgba(0,97,255,0.55);\n        border: 1px solid rgba(255,255,255,0.18);\n        user-select: none;\n        cursor: pointer;\n      }\n      #${REQUEST_BTN_ID}:hover {\n        background: rgba(11, 95, 255, 0.98);\n        transform: translateY(-1px);\n      }\n      #${REQUEST_BTN_ID} .icon {\n        width: 18px;\n        height: 18px;\n        display: inline-block;\n      }\n      #${REQUEST_BTN_ID} .label {\n        font-size: 14px;\n        line-height: 1;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  private async ensureRequestButton() {\n    const existing = document.getElementById(REQUEST_BTN_ID);\n    if (!isLoggedIn() || !this.isFilesPage()) {\n      if (existing && existing.parentNode) existing.parentNode.removeChild(existing);\n      return;\n    }\n\n    const isAdmin = await adminService.check();\n    if (!isAdmin) {\n      if (existing && existing.parentNode) existing.parentNode.removeChild(existing);\n      return;\n    }\n\n    if (existing) return;\n\n    const btn = document.createElement(\"button\");\n    btn.id = REQUEST_BTN_ID;\n    btn.type = \"button\";\n    btn.title = \"Create file request\";\n    btn.setAttribute(\"aria-label\", \"Create file request\");\n    btn.innerHTML = `\n      <svg class=\"icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\n        <path fill=\"currentColor\" d=\"M12 3l4 4h-3v7h-2V7H8l4-4zm-7 9h2v7h10v-7h2v9H5v-9z\"/>\n      </svg>\n      <span class=\"label\">Request</span>\n    `;\n\n    btn.addEventListener(\"click\", () => this.requestModal.show());\n    document.body.appendChild(btn);\n  }\n}\n","export function copyText(text: string): Promise<void> {\n  if (navigator.clipboard && navigator.clipboard.writeText) {\n    return navigator.clipboard.writeText(text).catch(() => {\n      return copyTextFallback(text);\n    });\n  }\n  return copyTextFallback(text);\n}\n\nfunction copyTextFallback(text: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    try {\n      const textarea = document.createElement(\"textarea\");\n      textarea.value = text;\n      textarea.setAttribute(\"readonly\", \"\");\n      textarea.style.cssText =\n        \"position:fixed;top:0;left:0;width:2em;height:2em;padding:0;border:none;outline:none;box-shadow:none;background:transparent;font-size:16px;\";\n      document.body.appendChild(textarea);\n\n      const isIOS =\n        /iPad|iPhone|iPod/.test(navigator.userAgent) ||\n        (navigator.platform === \"MacIntel\" && navigator.maxTouchPoints > 1);\n\n      if (isIOS) {\n        const range = document.createRange();\n        range.selectNodeContents(textarea);\n        const selection = window.getSelection();\n        selection?.removeAllRanges();\n        selection?.addRange(range);\n        textarea.setSelectionRange(0, text.length);\n      } else {\n        textarea.focus();\n        textarea.select();\n      }\n\n      const ok = document.execCommand(\"copy\");\n      document.body.removeChild(textarea);\n      if (!ok) return reject(new Error(\"Copy failed\"));\n      resolve();\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n","import { copyText } from \"../../utils/format\";\n\nconst AUTO_SHARE_STYLE_ID = \"droppr-auto-share-style\";\nconst AUTO_SHARE_MODAL_ID = \"droppr-auto-share-modal\";\n\ninterface AutoShareOptions {\n  title?: string;\n  subtitle?: string;\n  urlLabel?: string;\n  url?: string;\n  streamUrl?: string;\n  openUrl?: string;\n  note?: string;\n  autoCopy?: boolean;\n}\n\nexport class AutoShareModal {\n  constructor() {\n    this.ensureStyles();\n  }\n\n  private ensureStyles() {\n    if (document.getElementById(AUTO_SHARE_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = AUTO_SHARE_STYLE_ID;\n    style.textContent = `\n      #${AUTO_SHARE_MODAL_ID} {\n        position: fixed;\n        right: 18px;\n        bottom: 74px;\n        z-index: 2147483001;\n        width: 460px;\n        max-width: calc(100vw - 36px);\n        border-radius: 14px;\n        background: var(--droppr-overlay-bg, rgba(17, 24, 39, 0.98));\n        color: var(--text-primary, #e5e7eb);\n        border: 1px solid var(--droppr-overlay-border, rgba(255,255,255,0.12));\n        box-shadow: 0 26px 60px -30px rgba(0,0,0,0.85);\n        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n        overflow: hidden;\n      }\n      #${AUTO_SHARE_MODAL_ID} .hdr {\n        display: flex;\n        align-items: flex-start;\n        justify-content: space-between;\n        gap: 12px;\n        padding: 14px 14px 8px 14px;\n      }\n      #${AUTO_SHARE_MODAL_ID} .title {\n        font-size: 14px;\n        font-weight: 800;\n        line-height: 1.2;\n        color: var(--text-primary, #fff);\n      }\n      #${AUTO_SHARE_MODAL_ID} .subtitle {\n        font-size: 12px;\n        line-height: 1.2;\n        margin-top: 4px;\n        color: var(--droppr-overlay-muted, rgba(229,231,235,0.8));\n        word-break: break-word;\n      }\n      #${AUTO_SHARE_MODAL_ID} .close {\n        appearance: none;\n        border: 0;\n        background: transparent;\n        color: var(--droppr-overlay-muted, rgba(229,231,235,0.85));\n        cursor: pointer;\n        font-size: 18px;\n        line-height: 1;\n        padding: 6px 8px;\n        border-radius: 10px;\n      }\n      #${AUTO_SHARE_MODAL_ID} .close:hover {\n        background: var(--hover-bg, rgba(255,255,255,0.08));\n      }\n      #${AUTO_SHARE_MODAL_ID} .body {\n        padding: 0 14px 14px 14px;\n      }\n      #${AUTO_SHARE_MODAL_ID} .row {\n        display: flex;\n        gap: 10px;\n        align-items: center;\n      }\n      #${AUTO_SHARE_MODAL_ID} input {\n        flex: 1 1 auto;\n        width: 100%;\n        border-radius: 10px;\n        border: 1px solid var(--border-color, rgba(255,255,255,0.12));\n        background: var(--input-bg, rgba(0,0,0,0.22));\n        padding: 10px 10px;\n        color: var(--text-primary, #fff);\n        font-size: 13px;\n        outline: none;\n      }\n      #${AUTO_SHARE_MODAL_ID} .btn {\n        flex: 0 0 auto;\n        cursor: pointer;\n        border: 1px solid var(--border-color, rgba(255,255,255,0.12));\n        background: var(--accent-color, rgba(99, 102, 241, 0.95));\n        color: #fff;\n        font-weight: 800;\n        font-size: 13px;\n        padding: 10px 12px;\n        border-radius: 10px;\n      }\n      #${AUTO_SHARE_MODAL_ID} .btn.secondary {\n        background: var(--hover-bg, rgba(255,255,255,0.08));\n        color: var(--text-primary, #fff);\n      }\n      #${AUTO_SHARE_MODAL_ID} .note {\n        margin-top: 10px;\n        font-size: 12px;\n        color: var(--text-secondary, rgba(229,231,235,0.72));\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  public show(opts: AutoShareOptions) {\n    this.dismiss();\n\n    const primaryUrl = opts.url || opts.streamUrl || opts.openUrl || \"\";\n    const openUrl = opts.openUrl || primaryUrl;\n\n    const modal = document.createElement(\"div\");\n    modal.id = AUTO_SHARE_MODAL_ID;\n    modal.innerHTML = `\n      <div class=\"hdr\">\n        <div>\n          <div class=\"title\">${opts.title || \"Share link ready\"}</div>\n          ${opts.subtitle ? `<div class=\"subtitle\">${opts.subtitle}</div>` : \"\"}\n        </div>\n        <button type=\"button\" class=\"close\" aria-label=\"Close\">&times;</button>\n      </div>\n      <div class=\"body\">\n        ${opts.urlLabel ? `<div style=\"font-size:0.8rem; color:var(--text-muted, #888); margin-bottom:0.35rem;\">${opts.urlLabel}</div>` : \"\"}\n        <div class=\"row\">\n          <input type=\"text\" readonly value=\"${primaryUrl}\">\n          <button type=\"button\" class=\"btn\" data-action=\"copy\">Copy</button>\n          <button type=\"button\" class=\"btn secondary\" data-action=\"open\">Open</button>\n        </div>\n        ${opts.note ? `<div class=\"note\">${opts.note}</div>` : \"\"}\n      </div>\n    `;\n\n    document.body.appendChild(modal);\n\n    const closeBtn = modal.querySelector(\".close\");\n    const copyBtn = modal.querySelector('[data-action=\"copy\"]') as HTMLButtonElement;\n    const openBtn = modal.querySelector('[data-action=\"open\"]');\n    const input = modal.querySelector(\"input\") as HTMLInputElement;\n\n    closeBtn?.addEventListener(\"click\", () => this.dismiss());\n    input?.addEventListener(\"focus\", () => input.select());\n\n    copyBtn?.addEventListener(\"click\", async () => {\n      try {\n        await copyText(input.value);\n        copyBtn.textContent = \"Copied\";\n        setTimeout(() => {\n          if (document.body.contains(copyBtn)) copyBtn.textContent = \"Copy\";\n        }, 1200);\n      } catch (e) {\n        input.focus();\n        input.select();\n      }\n    });\n\n    openBtn?.addEventListener(\"click\", () => {\n      window.open(openUrl, \"_blank\", \"noopener\");\n    });\n\n    if (opts.autoCopy) {\n      copyBtn.click();\n    }\n  }\n\n  public dismiss() {\n    const el = document.getElementById(AUTO_SHARE_MODAL_ID);\n    if (el && el.parentNode) el.parentNode.removeChild(el);\n  }\n}\n","import { getFileBrowserToken } from \"./auth\";\nimport { normalizePathEncoded } from \"../utils/dom\";\nimport { AutoShareModal } from \"../components/Panel/AutoShareModal\";\n\ninterface UploadItem {\n  path: string;\n  ok: boolean;\n  done: boolean;\n}\n\ninterface UploadBatch {\n  pending: number;\n  items: UploadItem[];\n  timer: number | null;\n}\n\nexport class UploadService {\n  private uploadBatch: UploadBatch | null = null;\n  private lastAutoSharedPath: string | null = null;\n  private lastAutoSharedAt: number = 0;\n  private autoShareModal = new AutoShareModal();\n\n  constructor() {}\n\n  public recordUploadStart(pathEncoded: string): UploadItem {\n    this.startUploadBatch();\n    const item: UploadItem = { path: pathEncoded, ok: false, done: false };\n    if (this.uploadBatch) {\n      this.uploadBatch.pending += 1;\n      this.uploadBatch.items.push(item);\n    }\n    return item;\n  }\n\n  public recordUploadDone(item: UploadItem, ok: boolean) {\n    if (!this.uploadBatch) return;\n    item.done = true;\n    item.ok = ok;\n    this.uploadBatch.pending = Math.max(0, this.uploadBatch.pending - 1);\n\n    if (this.uploadBatch.pending === 0) {\n      const batch = this.uploadBatch;\n      this.uploadBatch.timer = window.setTimeout(() => {\n        this.finalizeUploadBatch(batch);\n      }, 700);\n    }\n  }\n\n  private startUploadBatch() {\n    if (!this.uploadBatch) {\n      this.uploadBatch = { pending: 0, items: [], timer: null };\n      return;\n    }\n\n    if (this.uploadBatch.timer) {\n      clearTimeout(this.uploadBatch.timer);\n      this.uploadBatch.timer = null;\n    }\n  }\n\n  private async finalizeUploadBatch(batch: UploadBatch) {\n    if (!batch || this.uploadBatch !== batch) return;\n    this.uploadBatch = null;\n\n    const attempted: Record<string, boolean> = {};\n    const succeeded: Record<string, boolean> = {};\n\n    batch.items.forEach((item) => {\n      if (!item.path) return;\n      attempted[item.path] = true;\n      if (item.ok) succeeded[item.path] = true;\n    });\n\n    const attemptedKeys = Object.keys(attempted);\n    const succeededKeys = Object.keys(succeeded);\n    if (attemptedKeys.length !== 1 || succeededKeys.length !== 1) return;\n\n    const pathEncoded = succeededKeys[0];\n    const t = Date.now();\n    if (this.lastAutoSharedPath === pathEncoded && t - this.lastAutoSharedAt < 5000) return;\n    this.lastAutoSharedPath = pathEncoded;\n    this.lastAutoSharedAt = t;\n\n    try {\n      const resp = await this.createShare(pathEncoded);\n      const streamUrl = window.location.origin + \"/stream/\" + resp.hash;\n      const fileLabel = decodeURIComponent(String(pathEncoded).split(\"/\").pop() || \"\");\n      this.autoShareModal.show({\n        title: \"Share link ready\",\n        subtitle: fileLabel ? `Uploaded: ${fileLabel}` : \"\",\n        urlLabel: \"Stream Gallery (best for big videos):\",\n        url: streamUrl,\n        openUrl: streamUrl,\n        note: \"Recipients can view without logging in.\",\n        autoCopy: true,\n      });\n    } catch (err: unknown) {\n      const msg = err instanceof Error ? err.message : String(err);\n      this.autoShareModal.show({\n        title: \"Upload complete\",\n        subtitle: \"Could not create share link\",\n        url: \"\",\n        note: msg,\n        autoCopy: false,\n      });\n    }\n  }\n\n  private async createShare(pathEncoded: string): Promise<{ hash: string }> {\n    const token = getFileBrowserToken();\n    if (!token) throw new Error(\"Not logged in\");\n\n    const encodePathSegments = (decodedPath: string) => {\n      let s = String(decodedPath || \"\");\n      if (s && s.charAt(0) !== \"/\") s = \"/\" + s;\n      s = s.replace(/^\\/+/, \"/\");\n      const parts = s.split(\"/\");\n      return parts.map((p) => (p === \"\" ? \"\" : encodeURIComponent(p))).join(\"/\");\n    };\n\n    const doShareFetch = async (encodedPath: string) => {\n      const res = await fetch(\"/api/share\" + encodedPath, {\n        method: \"POST\",\n        headers: {\n          \"X-Auth\": token,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ expires: \"\", password: \"\" }),\n      });\n\n      const text = await res.text();\n      if (!res.ok) {\n        throw new Error(\"Share API failed (\" + res.status + \"): \" + (text || \"\"));\n      }\n      const data = JSON.parse(text);\n      if (!data || !data.hash) throw new Error(\"Share response missing hash\");\n      return data;\n    };\n\n    try {\n      return await doShareFetch(pathEncoded);\n    } catch (err) {\n      if (String(pathEncoded || \"\").indexOf(\"%2F\") === -1) throw err;\n\n      let decoded;\n      try {\n        decoded = decodeURIComponent(String(pathEncoded));\n      } catch (_e) {\n        throw err;\n      }\n\n      const normalized = encodePathSegments(decoded);\n      if (!normalized || normalized === pathEncoded) throw err;\n      return await doShareFetch(normalized);\n    }\n  }\n}\n\nexport const uploadService = new UploadService();\n","export function normalizeUrl(input: string): URL | null {\n  try {\n    return new URL(input, window.location.href);\n  } catch (e) {\n    return null;\n  }\n}\n\nexport function extractApiPath(urlLike: string, prefix: string): string | null {\n  const u = normalizeUrl(urlLike);\n  if (!u) return null;\n  if (u.pathname === prefix) return \"\";\n  if (u.pathname.indexOf(prefix + \"/\") !== 0) return null;\n  return u.pathname.substring(prefix.length);\n}\n\nexport function normalizePathEncoded(pathEncoded: string): string {\n  let p = String(pathEncoded || \"\");\n  if (p === \"\") return \"/\";\n  if (p.charAt(0) !== \"/\") p = \"/\" + p;\n  if (p.length > 1 && p.charAt(p.length - 1) === \"/\") p = p.slice(0, -1);\n  return p;\n}\n\nexport function sanitizeFileName(name: string): string {\n  let s = String(name || \"\");\n  s = s.split(\"/\").pop() || s;\n  s = s.split(\"\\\\\").pop() || s;\n  return s;\n}\n\nexport function pathEndsWithFileName(pathEncoded: string, fileName: string): boolean {\n  if (!pathEncoded || !fileName) return false;\n  const last = String(pathEncoded).split(\"/\").pop() || \"\";\n  try {\n    if (decodeURIComponent(last) === fileName) return true;\n  } catch (e) {\n    // ignore\n  }\n  return last === encodeURIComponent(fileName);\n}\n\nexport function joinDirAndFileEncoded(dirEncoded: string, fileName: string): string {\n  const dir = normalizePathEncoded(dirEncoded);\n  const base = sanitizeFileName(fileName);\n  const encodedName = encodeURIComponent(base);\n  if (dir === \"/\") return \"/\" + encodedName;\n  return dir + \"/\" + encodedName;\n}\n","import { extractApiPath } from \"../utils/dom\";\n\nexport function extractResourcePath(urlLike: string): string | null {\n  return extractApiPath(urlLike, \"/api/resources\");\n}\n\nexport function extractTusPath(urlLike: string): string | null {\n  return extractApiPath(urlLike, \"/api/tus\");\n}\n\nexport function hasBinaryBody(body: any): boolean {\n  if (!body) return false;\n  if (typeof FormData !== \"undefined\" && body instanceof FormData) return true;\n  if (typeof Blob !== \"undefined\" && body instanceof Blob) return true;\n  if (typeof ArrayBuffer !== \"undefined\" && body instanceof ArrayBuffer) return true;\n  if (typeof Uint8Array !== \"undefined\" && body instanceof Uint8Array) return true;\n  return false;\n}\n\nexport function getBodyFileNames(body: any): string[] {\n  const names: string[] = [];\n  const seen: Record<string, boolean> = {};\n\n  const add = (name: string) => {\n    if (!name) return;\n    if (seen[name]) return;\n    seen[name] = true;\n    names.push(name);\n  };\n\n  if (!body) return names;\n\n  if (typeof FormData !== \"undefined\" && body instanceof FormData) {\n    try {\n      const it = (body as any).entries();\n      let e = it.next();\n      while (!e.done) {\n        const v = e.value && e.value[1];\n        if (v && typeof v === \"object\" && typeof v.name === \"string\") add(v.name);\n        e = it.next();\n      }\n    } catch (e2) {\n      // ignore\n    }\n\n    return names;\n  }\n\n  if (body && typeof body === \"object\" && typeof body.name === \"string\") add(body.name);\n  return names;\n}\n","import { uploadService } from \"./upload\";\nimport {\n  extractResourcePath,\n  extractTusPath,\n  hasBinaryBody,\n  getBodyFileNames,\n} from \"../utils/validation\";\nimport { normalizePathEncoded, pathEndsWithFileName, joinDirAndFileEncoded } from \"../utils/dom\";\n\ninterface TusEntry {\n  path: string;\n  item: any;\n  uploadLength: number | null;\n  lastSeenAt: number;\n  timer: number | null;\n}\n\nexport class XhrInterceptor {\n  private tusUploads: Record<string, TusEntry> = {};\n\n  constructor() {\n    this.interceptXhr();\n    this.interceptFetch();\n  }\n\n  private interceptFetch() {\n    if (!window.fetch) return;\n\n    const origFetch = window.fetch;\n    window.fetch = (input: RequestInfo | URL, init?: RequestInit): Promise<Response> => {\n      let urlLike = \"\";\n      let method = \"GET\";\n      let body: unknown = null;\n      let headers: HeadersInit | null = null;\n\n      if (typeof input === \"string\") {\n        urlLike = input;\n      } else if (input instanceof URL) {\n        urlLike = input.href;\n      } else if (input && typeof input === \"object\") {\n        urlLike = (input as Request).url;\n        method = (input as Request).method || method;\n        headers = (input as Request).headers || headers;\n      }\n\n      if (init) {\n        if (init.method) method = init.method;\n        if (init.body) body = init.body;\n        if (init.headers) headers = init.headers;\n      }\n\n      const mUpper = String(method || \"GET\").toUpperCase();\n      let tusEntry: TusEntry | null = null;\n      const tusPath = this.getTusUploadPath(urlLike);\n\n      if (tusPath && (mUpper === \"POST\" || mUpper === \"PATCH\")) {\n        tusEntry = this.ensureTusEntry(tusPath);\n        if (tusEntry && mUpper === \"POST\" && tusEntry.uploadLength == null) {\n          const len = this.getHeaderValue(headers, \"Upload-Length\");\n          tusEntry.uploadLength = len ? parseInt(len, 10) : null;\n        }\n      }\n\n      const resourceRecords: any[] = [];\n      const resourcePaths = this.getResourceUploadPaths(urlLike, method, body);\n      for (let i = 0; i < resourcePaths.length; i++) {\n        resourceRecords.push(uploadService.recordUploadStart(resourcePaths[i]));\n      }\n\n      const p = origFetch(input, init);\n      if (!tusEntry && resourceRecords.length === 0) return p;\n\n      return p.then(\n        (resp) => {\n          if (tusEntry) {\n            if (!resp || !resp.ok) {\n              this.finishTusEntry(tusEntry, false);\n              return resp;\n            }\n            if (mUpper === \"POST\") {\n              if (tusEntry.uploadLength === 0) this.finishTusEntry(tusEntry, true);\n              return resp;\n            }\n            if (mUpper === \"PATCH\") {\n              this.handleTusPatchProgress(\n                tusEntry,\n                resp.headers ? resp.headers.get(\"Upload-Offset\") : null,\n                resp.headers ? resp.headers.get(\"Upload-Length\") : null\n              );\n            }\n            return resp;\n          }\n\n          for (let i = 0; i < resourceRecords.length; i++) {\n            uploadService.recordUploadDone(resourceRecords[i], resp && resp.ok);\n          }\n          return resp;\n        },\n        (err) => {\n          if (tusEntry) {\n            this.finishTusEntry(tusEntry, false);\n          } else {\n            for (let i = 0; i < resourceRecords.length; i++) {\n              uploadService.recordUploadDone(resourceRecords[i], false);\n            }\n          }\n          throw err;\n        }\n      );\n    };\n  }\n\n  private getHeaderValue(headers: any, name: string): string | null {\n    if (!headers) return null;\n    const lowerName = name.toLowerCase();\n    if (headers instanceof Headers) {\n      return headers.get(lowerName);\n    }\n    if (Array.isArray(headers)) {\n      for (const [key, value] of headers) {\n        if (key.toLowerCase() === lowerName) return value;\n      }\n    }\n    if (typeof headers === \"object\") {\n      for (const key in headers) {\n        if (key.toLowerCase() === lowerName) return (headers as any)[key];\n      }\n    }\n    return null;\n  }\n\n  private interceptXhr() {\n    const origOpen = window.XMLHttpRequest.prototype.open;\n    const origSend = window.XMLHttpRequest.prototype.send;\n    const origSetRequestHeader = window.XMLHttpRequest.prototype.setRequestHeader;\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const self = this;\n\n    (window.XMLHttpRequest.prototype as any).open = function (\n      this: any,\n      method: string,\n      url: string | URL,\n      ...args: any[]\n    ) {\n      this.__dropprMethod = method;\n      this.__dropprUrl = url;\n      this.__dropprHeaders = {};\n      return (origOpen as any).apply(this, [method, url, ...args]);\n    };\n\n    (window.XMLHttpRequest.prototype as any).setRequestHeader = function (\n      this: any,\n      name: string,\n      value: string\n    ) {\n      try {\n        if (this.__dropprHeaders && name) {\n          this.__dropprHeaders[String(name).toLowerCase()] = value;\n        }\n      } catch (_e) {\n        /* ignore */\n      }\n      return (origSetRequestHeader as any).apply(this, [name, value]);\n    };\n\n    (window.XMLHttpRequest.prototype as any).send = function (this: any, body: any) {\n      const method = this.__dropprMethod || \"GET\";\n      const urlLike = String(this.__dropprUrl || \"\");\n      const mUpper = String(method).toUpperCase();\n\n      let tusEntry: TusEntry | null = null;\n      const tusPath = self.getTusUploadPath(urlLike);\n      if (tusPath && (mUpper === \"POST\" || mUpper === \"PATCH\")) {\n        tusEntry = self.ensureTusEntry(tusPath);\n        if (tusEntry && mUpper === \"POST\" && tusEntry.uploadLength == null) {\n          const len = this.__dropprHeaders && this.__dropprHeaders[\"upload-length\"];\n          tusEntry.uploadLength = len ? parseInt(len, 10) : null;\n        }\n      }\n\n      const resourceRecords: any[] = [];\n      const resourcePaths = self.getResourceUploadPaths(urlLike, method, body);\n      for (let i = 0; i < resourcePaths.length; i++) {\n        resourceRecords.push(uploadService.recordUploadStart(resourcePaths[i]));\n      }\n\n      if (tusEntry || resourceRecords.length) {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const xhr = this;\n        const onDone = function () {\n          xhr.removeEventListener(\"loadend\", onDone);\n          const ok = xhr.status >= 200 && xhr.status < 300;\n\n          if (tusEntry) {\n            if (!ok) {\n              self.finishTusEntry(tusEntry, false);\n              return;\n            }\n            if (mUpper === \"POST\") {\n              if (tusEntry.uploadLength === 0) self.finishTusEntry(tusEntry, true);\n              return;\n            }\n            if (mUpper === \"PATCH\") {\n              const off = xhr.getResponseHeader(\"Upload-Offset\");\n              const len = xhr.getResponseHeader(\"Upload-Length\");\n              self.handleTusPatchProgress(tusEntry, off, len);\n            }\n            return;\n          }\n\n          for (let i = 0; i < resourceRecords.length; i++) {\n            uploadService.recordUploadDone(resourceRecords[i], ok);\n          }\n        };\n        xhr.addEventListener(\"loadend\", onDone);\n      }\n\n      return (origSend as any).apply(this, [body]);\n    };\n  }\n\n  private getTusUploadPath(urlLike: string): string | null {\n    const rawPath = extractTusPath(urlLike);\n    if (rawPath == null) return null;\n    const p = normalizePathEncoded(rawPath);\n    if (!p || p === \"/\") return null;\n    return p;\n  }\n\n  private ensureTusEntry(pathEncoded: string): TusEntry | null {\n    const p = normalizePathEncoded(pathEncoded);\n    if (!p || p === \"/\") return null;\n\n    const existing = this.tusUploads[p];\n    if (existing && existing.item && !existing.item.done) return existing;\n\n    const item = uploadService.recordUploadStart(p);\n    const entry: TusEntry = { path: p, item, uploadLength: null, lastSeenAt: 0, timer: null };\n    this.tusUploads[p] = entry;\n    return entry;\n  }\n\n  private finishTusEntry(entry: TusEntry, ok: boolean) {\n    if (!entry || !entry.item || entry.item.done) return;\n    if (entry.timer) {\n      clearTimeout(entry.timer);\n      entry.timer = null;\n    }\n    delete this.tusUploads[entry.path];\n    uploadService.recordUploadDone(entry.item, ok);\n  }\n\n  private handleTusPatchProgress(\n    entry: TusEntry,\n    offsetValue: string | null,\n    lengthValue: string | null\n  ) {\n    if (!entry || !entry.item || entry.item.done) return;\n\n    const offset = offsetValue ? parseInt(offsetValue, 10) : null;\n    const length = lengthValue ? parseInt(lengthValue, 10) : null;\n\n    if (length != null) entry.uploadLength = length;\n    const effectiveLength = length ?? entry.uploadLength;\n\n    if (\n      offset != null &&\n      effectiveLength != null &&\n      effectiveLength >= 0 &&\n      offset >= effectiveLength\n    ) {\n      this.finishTusEntry(entry, true);\n      return;\n    }\n\n    this.scheduleTusIdleComplete(entry);\n  }\n\n  private scheduleTusIdleComplete(entry: TusEntry) {\n    if (!entry || !entry.item || entry.item.done) return;\n    const idleMs = 1800;\n    entry.lastSeenAt = Date.now();\n\n    if (entry.timer) clearTimeout(entry.timer);\n    entry.timer = window.setTimeout(() => {\n      if (!entry || !entry.item || entry.item.done) return;\n      const age = Date.now() - entry.lastSeenAt;\n      if (age < idleMs) {\n        this.scheduleTusIdleComplete(entry);\n        return;\n      }\n      this.finishTusEntry(entry, true);\n    }, idleMs);\n  }\n\n  private getResourceUploadPaths(urlLike: string, method: string, body: any): string[] {\n    const m = String(method).toUpperCase();\n    if (m !== \"POST\" && m !== \"PUT\") return [];\n\n    const rawPath = extractResourcePath(urlLike);\n    if (rawPath == null) return [];\n    if (!hasBinaryBody(body)) return [];\n\n    const fileNames = getBodyFileNames(body);\n    const normalizedBase = normalizePathEncoded(rawPath);\n\n    if (!fileNames.length) {\n      if (normalizedBase === \"/\") return [];\n      return [normalizedBase];\n    }\n\n    if (\n      fileNames.length === 1 &&\n      rawPath &&\n      rawPath !== \"/\" &&\n      pathEndsWithFileName(rawPath, fileNames[0])\n    ) {\n      return [normalizePathEncoded(rawPath)];\n    }\n\n    return fileNames.map((name) => joinDirAndFileEncoded(normalizedBase, name));\n  }\n}\n","export function isDropprDebugEnabled(): boolean {\n  try {\n    return /(?:^|[?&])dropprDebug=1(?:&|$)/.test(\n      String(window.location && window.location.search) || \"\"\n    );\n  } catch (e) {\n    return false;\n  }\n}\n","import { dropprFetch } from \"./api\";\nimport { isDropprDebugEnabled } from \"../utils/debug\";\n\nexport interface VideoMeta {\n  status?: string;\n  action?: string;\n  uploaded_at?: number;\n  processed_at?: number;\n  original?: any;\n  processed?: any;\n  original_size?: number;\n  processed_size?: number;\n}\n\nclass VideoMetaService {\n  private cache: Record<string, VideoMeta | null> = {};\n  private inFlight: Record<string, boolean> = {};\n  public debugStats = { ok: 0, notFound: 0, unauth: 0, other: 0 };\n\n  async fetch(path: string): Promise<VideoMeta | null> {\n    if (this.cache[path] !== undefined) return this.cache[path];\n    if (this.inFlight[path]) return null;\n\n    this.inFlight[path] = true;\n    try {\n      const res = await dropprFetch(`/api/droppr/video-meta?path=${encodeURIComponent(path)}`, {\n        cache: \"no-store\",\n      });\n\n      if (isDropprDebugEnabled()) {\n        if (res.status === 200) this.debugStats.ok++;\n        else if (res.status === 404) this.debugStats.notFound++;\n        else if (res.status === 401 || res.status === 403) this.debugStats.unauth++;\n        else this.debugStats.other++;\n      }\n\n      if (!res.ok) {\n        this.cache[path] = null;\n        return null;\n      }\n\n      const data = await res.json();\n      this.cache[path] = data;\n      return data;\n    } catch (e) {\n      this.cache[path] = null;\n      return null;\n    } finally {\n      delete this.inFlight[path];\n    }\n  }\n\n  getCached(path: string): VideoMeta | null | undefined {\n    return this.cache[path];\n  }\n\n  isInFlight(path: string): boolean {\n    return !!this.inFlight[path];\n  }\n}\n\nexport const videoMetaService = new VideoMetaService();\n","import { isDropprDebugEnabled } from \"../../utils/debug\";\n\nconst DEBUG_BADGE_ID = \"droppr-debug-badge\";\nconst DROPPR_PANEL_VERSION = \"30\"; // Synchronize with actual version\n\nexport class DebugBadge {\n  private el: HTMLElement | null = null;\n\n  constructor() {\n    this.el = this.ensureElement();\n  }\n\n  private ensureElement(): HTMLElement | null {\n    if (!isDropprDebugEnabled()) return null;\n\n    const existing = document.getElementById(DEBUG_BADGE_ID);\n    if (existing) return existing;\n\n    const el = document.createElement(\"div\");\n    el.id = DEBUG_BADGE_ID;\n    el.style.cssText =\n      \"position:fixed;left:10px;bottom:10px;z-index:2147483647;\" +\n      \"max-width:min(92vw, 520px);\" +\n      \"padding:8px 10px;border-radius:12px;\" +\n      \"background:rgba(2,6,23,0.88);border:1px solid rgba(255,255,255,0.14);\" +\n      \"color:rgba(241,245,249,0.96);\" +\n      \"font:12px/1.35 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;\" +\n      \"box-shadow:0 18px 40px -18px rgba(0,0,0,0.75);\" +\n      \"user-select:text;cursor:text;\";\n    el.textContent = `Dropbox enhancements v${DROPPR_PANEL_VERSION} loadingâ€¦`;\n    document.body.appendChild(el);\n    return el;\n  }\n\n  public setText(text: string) {\n    if (this.el) {\n      this.el.textContent = text;\n    }\n  }\n}\n\nexport const debugBadge = new DebugBadge();\n","import { videoMetaService, VideoMeta } from \"../../services/video-meta\";\nimport { isDropprDebugEnabled } from \"../../utils/debug\";\nimport { debugBadge } from \"./DebugBadge\";\nimport { getFileBrowserToken } from \"../../services/auth\";\n\nconst VIDEO_META_STYLE_ID = \"droppr-video-meta-style\";\nconst VIDEO_META_INLINE_ID = \"droppr-video-meta-inline\";\nconst VIDEO_DETAILS_ROW_CLASS = \"droppr-video-details-row\";\nconst VIDEO_THUMB_STYLE_ID = \"droppr-video-thumb-style\";\nconst VIDEO_THUMB_CLASS = \"droppr-video-thumb\";\nconst DROPPR_THUMB_WIDTH = 96;\n\nexport class VideoListHydrator {\n  private hydrateTimer: number | null = null;\n  private lastPathname: string | null = null;\n  private observer: MutationObserver | null = null;\n\n  constructor() {\n    this.ensureStyles();\n    this.startWatcher();\n  }\n\n  private ensureStyles() {\n    if (document.getElementById(VIDEO_META_STYLE_ID)) return;\n    const style = document.createElement(\"style\");\n    style.id = VIDEO_META_STYLE_ID;\n    style.textContent = `\n      .${VIDEO_META_INLINE_ID} {\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n        padding: 4px 8px;\n        font-size: 11px;\n        line-height: 1.3;\n        color: var(--text-secondary, rgba(229,231,235,0.6));\n        background: rgba(255,255,255,0.03);\n        border-radius: 4px;\n        margin-top: 4px;\n        pointer-events: none;\n      }\n      .${VIDEO_META_INLINE_ID} .line {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .${VIDEO_META_INLINE_ID} .line.muted { opacity: 0.6; }\n      \n      /* Grid view adjustments */\n      .item.item-grid .${VIDEO_META_INLINE_ID} {\n        position: absolute;\n        bottom: 0; left: 0; right: 0;\n        background: rgba(0,0,0,0.65);\n        backdrop-filter: blur(4px);\n        margin: 0;\n        border-radius: 0;\n        padding: 6px 8px;\n      }\n    `;\n    document.head.appendChild(style);\n\n    if (!document.getElementById(VIDEO_THUMB_STYLE_ID)) {\n      const tStyle = document.createElement(\"style\");\n      tStyle.id = VIDEO_THUMB_STYLE_ID;\n      tStyle.textContent = `\n        .${VIDEO_THUMB_CLASS} {\n          width: 40px; height: 40px;\n          object-fit: cover;\n          border-radius: 4px;\n          background: #000;\n          margin-right: 12px;\n          flex: 0 0 40px;\n        }\n        .item-grid .${VIDEO_THUMB_CLASS} {\n          width: 100%; height: 100%;\n          margin: 0;\n          position: absolute; inset: 0;\n          z-index: -1;\n        }\n      `;\n      document.head.appendChild(tStyle);\n    }\n  }\n\n  private isFilesPage(): boolean {\n    return window.location.pathname.startsWith(\"/files\");\n  }\n\n  private startWatcher() {\n    this.scheduleHydrate();\n    this.observer = new MutationObserver(() => {\n      if (this.isFilesPage()) {\n        const path = window.location.pathname;\n        if (path !== this.lastPathname) {\n          this.lastPathname = path;\n          this.scheduleHydrate();\n        } else {\n          this.scheduleHydrate();\n        }\n      }\n    });\n    this.observer.observe(document.body, { childList: true, subtree: true });\n  }\n\n  private scheduleHydrate() {\n    if (!this.isFilesPage()) return;\n    if (this.hydrateTimer) clearTimeout(this.hydrateTimer);\n    this.hydrateTimer = window.setTimeout(() => {\n      this.hydrateTimer = null;\n      this.hydrate();\n    }, 250);\n  }\n\n  private hydrate() {\n    if (!this.isFilesPage()) return;\n\n    const layout = this.getLayout();\n    const rows = document.querySelectorAll(\".row.list-item, tr, .item, .file\");\n\n    let started = 0;\n    const maxNewFetches = 8;\n\n    rows.forEach((row) => {\n      if (row.classList.contains(VIDEO_DETAILS_ROW_CLASS)) return;\n\n      const nameEl = this.findNameEl(row as HTMLElement);\n      if (!nameEl) return;\n\n      const name = nameEl.textContent?.trim() || \"\";\n      if (!this.isLikelyVideo(name)) return;\n\n      const fullPath = this.extractPath(row as HTMLElement, name);\n      if (!fullPath) return;\n\n      this.applyThumbnail(row as HTMLElement, fullPath);\n      const box = this.ensureDetailsBox(row as HTMLElement, nameEl);\n      if (!box) return;\n\n      const cached = videoMetaService.getCached(fullPath);\n      if (cached !== undefined) {\n        this.renderDetails(box, name, cached, layout === \"list\");\n        return;\n      }\n\n      if (videoMetaService.isInFlight(fullPath)) return;\n      if (started >= maxNewFetches) return;\n\n      started++;\n      videoMetaService.fetch(fullPath).then((data) => {\n        if (box.dataset.path === fullPath) {\n          this.renderDetails(box, name, data, layout === \"list\");\n        }\n        this.scheduleHydrate();\n      });\n    });\n\n    if (isDropprDebugEnabled()) {\n      const stats = videoMetaService.debugStats;\n      debugBadge.setText(`Hydrated: ok:${stats.ok} 404:${stats.notFound} row:${rows.length}`);\n    }\n  }\n\n  private getLayout(): \"list\" | \"grid\" {\n    const listing = document.getElementById(\"listing\");\n    if (listing?.classList.contains(\"list\")) return \"list\";\n    if (listing?.classList.contains(\"grid\")) return \"grid\";\n    return \"list\";\n  }\n\n  private findNameEl(row: HTMLElement): HTMLElement | null {\n    return row.querySelector(\".name, .title, [data-name]\") as HTMLElement;\n  }\n\n  private isLikelyVideo(name: string): boolean {\n    const ext = name.split(\".\").pop()?.toLowerCase() || \"\";\n    return [\"mp4\", \"mkv\", \"mov\", \"avi\", \"webm\"].includes(ext);\n  }\n\n  private extractPath(row: HTMLElement, name: string): string | null {\n    const link = row.querySelector(\"a[href]\") as HTMLAnchorElement;\n    if (link) {\n      const href = link.getAttribute(\"href\") || \"\";\n      if (href.startsWith(\"/files/\")) {\n        return decodeURIComponent(href.substring(\"/files\".length));\n      }\n    }\n\n    // Heuristic fallback\n    let base = window.location.pathname.replace(\"/files\", \"\");\n    if (!base.startsWith(\"/\")) base = \"/\" + base;\n    if (!base.endsWith(\"/\")) base += \"/\";\n    return base + name;\n  }\n\n  private ensureDetailsBox(row: HTMLElement, nameEl: HTMLElement): HTMLElement | null {\n    let box = row.querySelector(`.${VIDEO_META_INLINE_ID}`) as HTMLElement;\n    if (!box) {\n      box = document.createElement(\"div\");\n      box.className = VIDEO_META_INLINE_ID;\n      nameEl.parentNode?.insertBefore(box, nameEl.nextSibling);\n    }\n    return box;\n  }\n\n  private renderDetails(\n    box: HTMLElement,\n    name: string,\n    data: VideoMeta | null,\n    includeName: boolean\n  ) {\n    box.dataset.path = box.dataset.path || \"\";\n    box.innerHTML = \"\";\n\n    const lines: string[] = [];\n    if (includeName) lines.push(name);\n\n    if (data) {\n      if (data.uploaded_at) {\n        const date = new Date(data.uploaded_at * 1000).toISOString().slice(0, 16).replace(\"T\", \" \");\n        lines.push(`Uploaded: ${date}`);\n      }\n      if (data.processed_size) {\n        lines.push(`Size: ${(data.processed_size / 1024 / 1024).toFixed(1)} MB`);\n      }\n      if (data.status) {\n        lines.push(`Status: ${data.status}`);\n      }\n    } else {\n      lines.push(\"No metadata available\");\n    }\n\n    lines.forEach((l) => {\n      const span = document.createElement(\"span\");\n      span.className = \"line\";\n      span.textContent = l;\n      box.appendChild(span);\n    });\n  }\n\n  private applyThumbnail(row: HTMLElement, path: string) {\n    const iconEl = row.querySelector(\".material-icons, .icon, i\") as HTMLElement;\n    const nameEl = this.findNameEl(row);\n    if (!iconEl || !nameEl) return;\n\n    const container = this.findThumbContainer(row, iconEl, nameEl);\n    if (!container) return;\n\n    const existing = container.querySelector(`.${VIDEO_THUMB_CLASS}`) as HTMLImageElement | null;\n    if (existing && existing.dataset.failed === \"1\") return;\n\n    const url = this.buildPreviewUrl(path, DROPPR_THUMB_WIDTH);\n    const url2x = this.buildPreviewUrl(path, DROPPR_THUMB_WIDTH * 2);\n\n    if (existing && existing.dataset.src === url) return;\n\n    // Hide original icon\n    iconEl.style.display = \"none\";\n\n    let img = existing;\n    if (!img) {\n      img = document.createElement(\"img\");\n      img.className = VIDEO_THUMB_CLASS;\n      img.alt = \"\";\n      img.loading = \"lazy\";\n      img.decoding = \"async\";\n      img.addEventListener(\"error\", () => {\n        img!.dataset.failed = \"1\";\n        img!.style.display = \"none\";\n        iconEl.style.display = \"\";\n      });\n      container.insertBefore(img, container.firstChild);\n    }\n\n    img.dataset.src = url;\n    img.src = url;\n    img.srcset = `${url} 1x, ${url2x} 2x`;\n    img.sizes = \"40px\";\n  }\n\n  private findThumbContainer(\n    row: HTMLElement,\n    iconEl: HTMLElement,\n    nameEl: HTMLElement\n  ): HTMLElement | null {\n    if (row.classList.contains(\"item\")) return row; // Grid item\n    return iconEl.parentElement;\n  }\n\n  private buildPreviewUrl(path: string, width?: number): string {\n    let p = path;\n    if (!p.startsWith(\"/\")) p = \"/\" + p;\n    let url = `/api/share/__files__/preview${encodeURI(p)}?v=1`;\n    if (width) url += `&w=${width}`;\n    return url;\n  }\n}\n","const THEME_PREFS_KEY = \"droppr_gallery_prefs\";\n\nexport type Theme = \"light\" | \"dark\";\n\nexport interface ThemePrefs {\n  theme: Theme;\n}\n\nclass ThemeService {\n  private currentTheme: Theme = \"light\";\n\n  constructor() {\n    this.currentTheme = this.getThemeFromPrefs();\n    this.applyTheme(this.currentTheme);\n  }\n\n  public getTheme(): Theme {\n    return this.currentTheme;\n  }\n\n  public toggle(): void {\n    const next = this.currentTheme === \"dark\" ? \"light\" : \"dark\";\n    this.setTheme(next);\n  }\n\n  public setTheme(theme: Theme): void {\n    this.currentTheme = theme;\n    this.applyTheme(theme);\n    this.saveThemePrefs({ theme });\n    window.dispatchEvent(new CustomEvent(\"droppr:theme-changed\", { detail: { theme } }));\n  }\n\n  private getThemeFromPrefs(): Theme {\n    try {\n      const raw = localStorage.getItem(THEME_PREFS_KEY);\n      if (raw) {\n        const prefs = JSON.parse(raw) as ThemePrefs;\n        if (prefs.theme === \"dark\" || prefs.theme === \"light\") {\n          return prefs.theme;\n        }\n      }\n    } catch (e) {\n      // ignore\n    }\n    // Fallback to system preference if no manual setting\n    if (window.matchMedia && window.matchMedia(\"(prefers-color-scheme: dark)\").matches) {\n      return \"dark\";\n    }\n    return \"light\";\n  }\n\n  private saveThemePrefs(prefs: ThemePrefs): void {\n    try {\n      localStorage.setItem(THEME_PREFS_KEY, JSON.stringify(prefs));\n    } catch (e) {\n      // ignore\n    }\n  }\n\n  private applyTheme(theme: Theme): void {\n    const isDark = theme === \"dark\";\n    if (isDark) {\n      document.documentElement.classList.add(\"dark\");\n      if (document.body) document.body.classList.add(\"dark\");\n    } else {\n      document.documentElement.classList.remove(\"dark\");\n      if (document.body) document.body.classList.remove(\"dark\");\n    }\n    this.fixPlaceholderColors(isDark);\n  }\n\n  private fixPlaceholderColors(isDark: boolean): void {\n    const styleId = \"droppr-placeholder-fix\";\n    let style = document.getElementById(styleId);\n    if (style && style.parentNode) {\n      style.parentNode.removeChild(style);\n    }\n\n    const placeholderColor = isDark ? \"#94a3b8\" : \"#475569\";\n    style = document.createElement(\"style\");\n    style.id = styleId;\n    style.textContent = `\n      input::placeholder, input::-webkit-input-placeholder {\n        color: ${placeholderColor} !important;\n        opacity: 1 !important;\n        -webkit-text-fill-color: ${placeholderColor} !important;\n      }\n      input::-moz-placeholder {\n        color: ${placeholderColor} !important;\n        opacity: 1 !important;\n      }\n      input:-ms-input-placeholder {\n        color: ${placeholderColor} !important;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n}\n\nexport const themeService = new ThemeService();\n","import { themeService, Theme } from \"../../services/theme\";\n\nconst THEME_TOGGLE_BTN_ID = \"droppr-theme-toggle\";\n\nexport class ThemeToggle {\n  constructor() {\n    this.ensureButton();\n    window.addEventListener(\"droppr:theme-changed\", (e: any) => {\n      this.updateButtonState(e.detail.theme);\n    });\n  }\n\n  private ensureButton() {\n    if (document.getElementById(THEME_TOGGLE_BTN_ID)) return;\n\n    const theme = themeService.getTheme();\n    const btn = document.createElement(\"button\");\n    btn.id = THEME_TOGGLE_BTN_ID;\n    btn.type = \"button\";\n    btn.style.cssText = `\n      position: fixed;\n      right: 18px;\n      bottom: 70px;\n      z-index: 2147483000;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      width: 44px;\n      height: 44px;\n      border-radius: 50%;\n      font-size: 20px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.25);\n      border: 1px solid var(--border-color, rgba(255,255,255,0.1));\n      cursor: pointer;\n      -webkit-tap-highlight-color: transparent;\n      touch-action: manipulation;\n      user-select: none;\n      transition: all 0.2s ease;\n    `;\n\n    btn.addEventListener(\"click\", (e) => {\n      e.preventDefault();\n      themeService.toggle();\n    });\n\n    document.body.appendChild(btn);\n    this.updateButtonState(theme);\n  }\n\n  private updateButtonState(theme: Theme) {\n    const btn = document.getElementById(THEME_TOGGLE_BTN_ID);\n    if (!btn) return;\n\n    const isDark = theme === \"dark\";\n    btn.textContent = isDark ? \"ðŸŒ™\" : \"â˜€ï¸\";\n    btn.title = isDark ? \"Switch to light theme\" : \"Switch to dark theme\";\n\n    // Manual overrides if CSS vars are not yet updated\n    btn.style.background = isDark ? \"#1e293b\" : \"#ffffff\";\n    btn.style.color = isDark ? \"#f1f5f9\" : \"#1e293b\";\n    btn.style.borderColor = isDark ? \"rgba(255,255,255,0.1)\" : \"rgba(0,0,0,0.1)\";\n  }\n}\n","import { SessionWarning } from \"./components/Common/SessionWarning\";\nimport { debugBadge } from \"./components/Panel/DebugBadge\";\nimport { AnalyticsButton } from \"./components/Panel/AnalyticsButton\";\nimport { ShareExpiration } from \"./components/Panel/ShareExpiration\";\nimport { HeaderButtons } from \"./components/Panel/HeaderButtons\";\nimport { XhrInterceptor } from \"./services/xhr-interceptor\";\nimport { VideoListHydrator } from \"./components/Panel/VideoListHydrator\";\nimport { icloudGateService } from \"./services/icloud-gate\";\nimport { ThemeToggle } from \"./components/Panel/ThemeToggle\";\n\ndeclare global {\n  interface Window {\n    __dropprPanelBooted?: boolean;\n    DROPPR_PANEL_VERSION?: string;\n  }\n}\n\nconst DROPPR_PANEL_VERSION = \"33\";\n\nif (!window.__dropprPanelBooted) {\n  window.__dropprPanelBooted = true;\n  window.DROPPR_PANEL_VERSION = DROPPR_PANEL_VERSION;\n\n  console.log(`Droppr Panel v${DROPPR_PANEL_VERSION} booting...`);\n\n  // Initialize services\n  new XhrInterceptor();\n  // icloudGateService is auto-initialized by import\n\n  // Initialize features\n  new SessionWarning();\n  new AnalyticsButton();\n  new ShareExpiration();\n  new HeaderButtons();\n  new VideoListHydrator();\n  new ThemeToggle();\n\n  // Debug badge is auto-initialized if debug mode is on\n}\n"],"names":["getCookie","name","m","decodeJwtPayload","token","parts","payload","pad","json","DROPPR_ACCESS_TOKEN_KEY","DROPPR_REFRESH_TOKEN_KEY","DROPPR_OTP_KEY","getFileBrowserToken","jwt","auth","isLoggedIn","getDropprTokenState","access","refresh","accessPayload","refreshPayload","saveDropprTokens","getDropprOtpCode","saveDropprOtpCode","code","promptForOtp","parseDropprAuthResponse","res","text","data","loginDropprToken","allowPrompt","fbToken","headers","otp","response","refreshDropprToken","refreshToken","ensureDropprAccessToken","force","state","now","newToken","getSessionExpiryMs","SESSION_WARNING_ID","SESSION_WARNING_STYLE_ID","SESSION_WARNING_THRESHOLD_MS","SessionWarning","__publicField","style","_a","el","exp","remaining","minutes","msg","ANALYTICS_BTN_ID","ANALYTICS_STYLE_ID","AnalyticsButton","existing","a","dropprFetch","url","options","opts","accessToken","SHARE_EXPIRE_STYLE_ID","SHARE_EXPIRE_BTN_CLASS","SHARE_EXPIRE_STORAGE_KEY","ShareExpiration","href","s","stored","n","shareHash","hours","sharePath","unixSeconds","ts","deltaSec","days","limit","q","rowEl","alias","tds","expireText","base","t","aliases","row","link","hash","lists","tbody","host","path","pathEl","btn","e","defaultHours","input","err","AdminService","adminService","ACCOUNTS_MODAL_ID","ACCOUNTS_STYLE_ID","PASSWORD_MIN_LEN","USERNAME_RE","AccountsModal","overlay","panel","usernameInput","passwordInput","scopeLabel","statusEl","closeBtn","cancelBtn","createBtn","meter","meterLabel","meterBar","setStatus","tone","updatePasswordMeter","password","checks","passed","c","total","pct","label","formatAccountScope","username","updateScope","closeModal","submit","scope","REQUEST_MODAL_ID","REQUEST_STYLE_ID","REQUEST_EXPIRE_STORAGE_KEY","RequestModal","pathInput","expireInput","toggleInput","passwordWrap","resultEl","linkInput","copyBtn","openBtn","setResult","updateToggle","hoursRaw","STREAM_BTN_ID","STREAM_BTN_STYLE_ID","ACCOUNTS_BTN_ID","REQUEST_BTN_ID","HeaderButtons","lastPath","share","copyText","copyTextFallback","resolve","reject","textarea","range","selection","ok","AUTO_SHARE_STYLE_ID","AUTO_SHARE_MODAL_ID","AutoShareModal","primaryUrl","openUrl","modal","UploadService","pathEncoded","item","batch","attempted","succeeded","attemptedKeys","succeededKeys","resp","streamUrl","fileLabel","encodePathSegments","decodedPath","p","doShareFetch","encodedPath","decoded","normalized","uploadService","normalizeUrl","extractApiPath","urlLike","prefix","u","normalizePathEncoded","sanitizeFileName","pathEndsWithFileName","fileName","last","joinDirAndFileEncoded","dirEncoded","dir","encodedName","extractResourcePath","extractTusPath","hasBinaryBody","body","getBodyFileNames","names","seen","add","it","v","XhrInterceptor","origFetch","init","method","mUpper","tusEntry","tusPath","len","resourceRecords","resourcePaths","i","lowerName","key","value","origOpen","origSend","origSetRequestHeader","self","args","xhr","onDone","off","rawPath","entry","offsetValue","lengthValue","offset","length","effectiveLength","idleMs","fileNames","normalizedBase","isDropprDebugEnabled","VideoMetaService","videoMetaService","DEBUG_BADGE_ID","DROPPR_PANEL_VERSION","DebugBadge","debugBadge","VIDEO_META_STYLE_ID","VIDEO_META_INLINE_ID","VIDEO_DETAILS_ROW_CLASS","VIDEO_THUMB_STYLE_ID","VIDEO_THUMB_CLASS","DROPPR_THUMB_WIDTH","VideoListHydrator","tStyle","layout","rows","started","maxNewFetches","nameEl","fullPath","box","cached","stats","listing","ext","includeName","lines","date","l","span","iconEl","container","url2x","img","width","THEME_PREFS_KEY","ThemeService","next","theme","raw","prefs","isDark","styleId","placeholderColor","themeService","THEME_TOGGLE_BTN_ID","ThemeToggle"],"mappings":"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"}