{"version":3,"file":"video-player.min.js","sources":["../src/video-player.ts"],"sourcesContent":["import \"./video-player.css\";\n\ninterface VideoSources {\n  original: { url: string; size: number | null };\n  fast: { url: string | null; ready: boolean; size: number | null };\n  hd: { url: string | null; ready: boolean; size: number | null };\n  hls: { url: string | null; ready: boolean; variants: unknown[] };\n}\n\ninterface SourcesApiResponse {\n  original?: { url?: string; size?: number };\n  fast?: { url?: string; ready?: boolean; size?: number };\n  hd?: { url?: string; ready?: boolean; size?: number };\n  hls?: { url?: string; ready?: boolean; variants?: unknown[] };\n}\n\ntype SourceType = \"original\" | \"fast\" | \"hd\" | \"hls\";\ntype QualityMode = \"auto\" | \"hd\" | \"fast\";\n\n(function (): void {\n  \"use strict\";\n\n  function encodePath(p: string): string {\n    return String(p || \"\")\n      .split(\"/\")\n      .map((s) => encodeURIComponent(s))\n      .join(\"/\");\n  }\n\n  function safeRelPath(value: string | null): string | null {\n    if (value == null) return null;\n    const v = String(value);\n    if (v.startsWith(\"/\") || v.startsWith(\"\\\\\")) return null;\n    if (v.includes(\"\\\\\")) return null;\n    const parts = v.split(\"/\").filter(Boolean);\n    if (!parts.length) return null;\n    if (parts.some((p) => p === \"..\")) return null;\n    return parts.join(\"/\");\n  }\n\n  function showError(title: string, message: string): void {\n    const errorTitle = document.getElementById(\"errorTitle\");\n    const errorMessage = document.getElementById(\"errorMessage\");\n    const error = document.getElementById(\"error\");\n    if (errorTitle) errorTitle.textContent = title || \"Error\";\n    if (errorMessage) errorMessage.textContent = message || \"\";\n    error?.classList.add(\"show\");\n  }\n\n  const params = new URLSearchParams(window.location.search);\n  const share = (params.get(\"share\") || \"\").trim();\n  const file = (params.get(\"file\") || \"\").trim();\n\n  if (!/^[A-Za-z0-9_-]{1,64}$/.test(share)) {\n    showError(\"Invalid link\", \"Missing or invalid share hash.\");\n    return;\n  }\n\n  const safeFile = safeRelPath(file);\n  if (!safeFile) {\n    showError(\"Invalid link\", \"Missing or invalid file path.\");\n    return;\n  }\n\n  const fileName = safeFile.split(\"/\").pop() || safeFile;\n  document.title = fileName + \" - Dropbox\";\n  const fileNameEl = document.getElementById(\"fileName\");\n  if (fileNameEl) fileNameEl.textContent = fileName;\n  const fileSubEl = document.getElementById(\"fileSub\");\n  if (fileSubEl) fileSubEl.textContent = share;\n\n  const sourcesApiUrl = `/api/share/${share}/video-sources/${encodePath(safeFile)}`;\n  const originalInlineUrlDefault = `/api/public/dl/${share}/${encodePath(safeFile)}?inline=true`;\n  const downloadUrl = `/api/share/${share}/file/${encodePath(safeFile)}?download=1`;\n  const backUrl = `/gallery/${share}`;\n\n  const video = document.getElementById(\"video\") as HTMLVideoElement;\n  const bufferText = document.getElementById(\"bufferText\");\n  const timeText = document.getElementById(\"timeText\");\n  const bufferFill = document.getElementById(\"bufferFill\");\n  const backLink = document.getElementById(\"backLink\") as HTMLAnchorElement | null;\n  const downloadLink = document.getElementById(\"downloadLink\") as HTMLAnchorElement | null;\n  const openLink = document.getElementById(\"openLink\") as HTMLAnchorElement | null;\n  const qualityBtn = document.getElementById(\"qualityBtn\");\n  const reloadBtn = document.getElementById(\"reloadBtn\");\n  const hasStatusUI = !!(bufferText && timeText && bufferFill);\n\n  if (backLink) backLink.href = backUrl;\n  if (downloadLink) {\n    downloadLink.href = downloadUrl;\n    downloadLink.download = fileName;\n  }\n  if (openLink) openLink.href = originalInlineUrlDefault;\n\n  const QUALITY_MODES: QualityMode[] = [\"auto\", \"hd\", \"fast\"];\n  const QUALITY_LABEL: Record<QualityMode, string> = { auto: \"Auto\", hd: \"HD\", fast: \"Fast\" };\n\n  let qualityMode: QualityMode = (params.get(\"quality\") || \"auto\")\n    .trim()\n    .toLowerCase() as QualityMode;\n  if (!QUALITY_MODES.includes(qualityMode)) qualityMode = \"auto\";\n\n  const sources: VideoSources = {\n    original: { url: originalInlineUrlDefault, size: null },\n    fast: { url: null, ready: false, size: null },\n    hd: { url: null, ready: false, size: null },\n    hls: { url: null, ready: false, variants: [] },\n  };\n\n  let activeSource: SourceType | null = null;\n  let switchInProgress = false;\n  let stallTimer: ReturnType<typeof setTimeout> | null = null;\n  let statusTimer: ReturnType<typeof setInterval> | null = null;\n  let sourceLoadStartedAt = 0;\n  let sourcesPollTimer: ReturnType<typeof setInterval> | null = null;\n  let sourcesPollStartedAt = 0;\n  let sourcesPollInFlight = false;\n  let lastHdFailureAt = 0;\n  let hdFailureCount = 0;\n  let hdSuppressedUntil = 0;\n  let hdAutoDisabled = false;\n  let hdStableTimer: ReturnType<typeof setTimeout> | null = null;\n  let hdUpgradeTimer: ReturnType<typeof setTimeout> | null = null;\n  let hdPrepareInFlight = false;\n  let fastPrepareInFlight = false;\n  let hlsPrepareInFlight = false;\n  let hlsInstance: HlsInstance | null = null;\n\n  let interactionTimer: ReturnType<typeof setTimeout> | null = null;\n  let lastInteractionAt = 0;\n  let isInteracting = false;\n\n  const AUTO_STALL_FALLBACK_MS = 3500;\n  const AUTO_STALL_FALLBACK_INITIAL_MS = 8000;\n  const HD_FAILURE_BASE_COOLDOWN_MS = 15000;\n  const HD_FAILURE_MAX_COOLDOWN_MS = 5 * 60 * 1000;\n  const HD_FAILURE_DISABLE_AFTER = 3;\n  const HD_STABLE_RESET_MS = 5000;\n  const AUTO_HD_UPGRADE_DELAY_MS = 1200;\n  const SOURCES_POLL_MS = 2000;\n  const SOURCES_POLL_MAX_MS = 10 * 60 * 1000;\n  const INTERACTION_IDLE_MS = 800;\n\n  const UA = navigator.userAgent || \"\";\n  const IS_IOS =\n    /iPad|iPhone|iPod/i.test(UA) ||\n    (navigator.platform === \"MacIntel\" && (navigator.maxTouchPoints || 0) > 1);\n  const AUTO_SWITCH_ENABLED = !IS_IOS;\n\n  function supportsNativeHls(): boolean {\n    return !!video.canPlayType && !!video.canPlayType(\"application/vnd.apple.mpegurl\");\n  }\n\n  function supportsHlsJs(): boolean {\n    return !!window.Hls && window.Hls.isSupported();\n  }\n\n  function canUseHls(): boolean {\n    return supportsNativeHls() || supportsHlsJs();\n  }\n\n  function destroyHls(): void {\n    if (!hlsInstance) return;\n    try {\n      hlsInstance.destroy();\n    } catch {\n      /* ignore */\n    }\n    hlsInstance = null;\n  }\n\n  function formatTime(seconds: number): string {\n    if (!Number.isFinite(seconds) || seconds < 0) return \"--:--\";\n    const s = Math.floor(seconds);\n    const h = Math.floor(s / 3600);\n    const m = Math.floor((s % 3600) / 60);\n    const sec = s % 60;\n    if (h > 0) return `${h}:${String(m).padStart(2, \"0\")}:${String(sec).padStart(2, \"0\")}`;\n    return `${m}:${String(sec).padStart(2, \"0\")}`;\n  }\n\n  function clearHdStableTimer(): void {\n    if (!hdStableTimer) return;\n    clearTimeout(hdStableTimer);\n    hdStableTimer = null;\n  }\n\n  function computeHdCooldownMs(): number {\n    const exp = Math.max(0, hdFailureCount - 1);\n    const ms = HD_FAILURE_BASE_COOLDOWN_MS * Math.pow(2, exp);\n    return Math.min(HD_FAILURE_MAX_COOLDOWN_MS, ms);\n  }\n\n  function noteHdFailure(): void {\n    lastHdFailureAt = Date.now();\n    hdFailureCount = Math.min(10, hdFailureCount + 1);\n    hdSuppressedUntil = lastHdFailureAt + computeHdCooldownMs();\n    hdAutoDisabled = hdFailureCount >= HD_FAILURE_DISABLE_AFTER;\n    clearHdStableTimer();\n    if (hdUpgradeTimer) {\n      clearTimeout(hdUpgradeTimer);\n      hdUpgradeTimer = null;\n    }\n  }\n\n  function noteHdStable(): void {\n    hdFailureCount = 0;\n    hdSuppressedUntil = 0;\n    hdAutoDisabled = false;\n  }\n\n  function startHdStableTimer(): void {\n    clearHdStableTimer();\n    hdStableTimer = setTimeout(() => {\n      if (activeSource !== \"hd\") return;\n      if (video.paused) return;\n      if (video.seeking) return;\n      if (video.error) return;\n      noteHdStable();\n      updateStatusUI();\n    }, HD_STABLE_RESET_MS);\n  }\n\n  function scheduleHdUpgrade(delayMs: number): void {\n    if (qualityMode !== \"auto\") return;\n    if (!AUTO_SWITCH_ENABLED) return;\n    if (hdAutoDisabled) return;\n    if (hdUpgradeTimer) clearTimeout(hdUpgradeTimer);\n    hdUpgradeTimer = setTimeout(\n      () => {\n        hdUpgradeTimer = null;\n        maybeUpgradeToHd();\n      },\n      Math.max(0, delayMs || 0)\n    );\n  }\n\n  function sourceLabel(sourceType: SourceType | null): string {\n    if (sourceType === \"hls\") return \"Adaptive\";\n    if (sourceType === \"hd\") return \"HD\";\n    if (sourceType === \"fast\") return \"Fast\";\n    return \"Original\";\n  }\n\n  function setOpenLinkForSource(sourceType: SourceType | null): void {\n    const src = sourceType && sources[sourceType] && sources[sourceType].url;\n    if (openLink) openLink.href = src || sources.original.url || originalInlineUrlDefault;\n  }\n\n  function updateQualityUI(): void {\n    const modeLabel = QUALITY_LABEL[qualityMode] || \"Auto\";\n    const srcLabel = activeSource ? sourceLabel(activeSource) : \"\";\n    if (qualityBtn) {\n      qualityBtn.textContent =\n        qualityMode === \"auto\" && srcLabel ? `${modeLabel} (${srcLabel})` : modeLabel;\n    }\n    if (fileSubEl) {\n      fileSubEl.textContent = share;\n    }\n\n    setOpenLinkForSource(activeSource || \"original\");\n  }\n\n  function getStateLabel(): string {\n    if (video.error) return \"Error\";\n    if (video.seeking) return \"Seeking\";\n\n    const elapsed = Date.now() - (sourceLoadStartedAt || 0);\n    if (video.readyState === 0 && elapsed > 2000) {\n      if (activeSource === \"fast\") return \"Loading fast preview…\";\n      if (activeSource === \"hd\") return \"Loading HD…\";\n      return \"Loading original…\";\n    }\n\n    if (!video.paused && video.readyState < 3) return \"Buffering\";\n    if (!video.paused) return \"Playing\";\n    if (video.currentTime > 0) return \"Paused\";\n    if (video.readyState >= 2) return \"Ready\";\n    return \"Loading\";\n  }\n\n  interface BufferedInfo {\n    dur: number | null;\n    ct: number;\n    pct: number | null;\n    ahead: number;\n  }\n\n  function getBufferedInfo(): BufferedInfo {\n    const dur = Number.isFinite(video.duration) ? video.duration : null;\n    const ct = Number.isFinite(video.currentTime) ? video.currentTime : 0;\n\n    const ranges: [number, number][] = [];\n    try {\n      const b = video.buffered;\n      for (let i = 0; i < b.length; i++) {\n        const start = b.start(i);\n        const end = b.end(i);\n        if (Number.isFinite(start) && Number.isFinite(end) && end > start)\n          ranges.push([start, end]);\n      }\n    } catch {\n      /* ignore */\n    }\n\n    let total = 0;\n    for (const [s, e] of ranges) total += e - s;\n\n    let ahead = 0;\n    for (const [s, e] of ranges) {\n      if (ct >= s && ct <= e) {\n        ahead = Math.max(0, e - ct);\n        break;\n      }\n    }\n\n    const pct = dur && dur > 0 ? Math.max(0, Math.min(1, total / dur)) : null;\n    return { dur, ct, pct, ahead };\n  }\n\n  function updateStatusUI(): void {\n    if (!hasStatusUI) return;\n    const stateLabel = getStateLabel();\n    const info = getBufferedInfo();\n\n    if (timeText)\n      timeText.textContent = info.dur\n        ? `${formatTime(info.ct)} / ${formatTime(info.dur)}`\n        : formatTime(info.ct);\n\n    const modeLabel = QUALITY_LABEL[qualityMode] || \"Auto\";\n    const srcLabel = activeSource ? sourceLabel(activeSource) : \"\";\n    let text = srcLabel\n      ? `${modeLabel} • ${srcLabel} • ${stateLabel}`\n      : `${modeLabel} • ${stateLabel}`;\n\n    if (info.pct != null && bufferFill) {\n      const pctText = Math.round(info.pct * 100);\n      text += ` • Buffered ${pctText}%`;\n      if (info.ahead > 0) text += ` • Ahead ${Math.round(info.ahead)}s`;\n      bufferFill.style.width = `${Math.max(0, Math.min(100, info.pct * 100)).toFixed(1)}%`;\n    } else if (bufferFill) {\n      bufferFill.style.width = \"0%\";\n    }\n\n    if (\n      (qualityMode === \"auto\" || qualityMode === \"hd\") &&\n      !sources.hd.ready &&\n      hdPrepareInFlight\n    ) {\n      text += \" • Preparing HD…\";\n    }\n    if (\n      (qualityMode === \"auto\" || qualityMode === \"fast\") &&\n      !sources.fast.ready &&\n      fastPrepareInFlight\n    ) {\n      text += \" • Preparing Fast…\";\n    }\n    if (qualityMode === \"auto\" && canUseHls() && !sources.hls.ready && hlsPrepareInFlight) {\n      text += \" • Preparing Adaptive…\";\n    }\n\n    if (qualityMode === \"auto\" && !AUTO_SWITCH_ENABLED) {\n      text += \" • iOS: Auto=HD\";\n    }\n\n    if (qualityMode === \"auto\" && sources.hd.ready && activeSource !== \"hd\") {\n      if (hdAutoDisabled) {\n        text += \" • HD off (tap HD)\";\n      } else if (hdSuppressedUntil && Date.now() < hdSuppressedUntil) {\n        const secs = Math.max(1, Math.ceil((hdSuppressedUntil - Date.now()) / 1000));\n        text += ` • HD retry in ${secs}s`;\n      }\n    }\n\n    if (bufferText) bufferText.textContent = text;\n  }\n\n  function startStatusTimer(): void {\n    if (!hasStatusUI) return;\n    if (statusTimer) return;\n    statusTimer = setInterval(updateStatusUI, 500);\n  }\n\n  function stopStatusTimer(): void {\n    if (!statusTimer) return;\n    clearInterval(statusTimer);\n    statusTimer = null;\n  }\n\n  function appendCacheBust(url: string, cacheBust: boolean): string {\n    if (!cacheBust) return url;\n    const sep = url.includes(\"?\") ? \"&\" : \"?\";\n    return url + sep + \"v=\" + Date.now();\n  }\n\n  function getUrlForSource(sourceType: SourceType, cacheBust: boolean): string | null {\n    const base = sources[sourceType] && sources[sourceType].url;\n    if (!base) return null;\n    return appendCacheBust(base, cacheBust);\n  }\n\n  interface PickOptions {\n    avoid?: string;\n  }\n\n  function pickPlayableSource(desired: SourceType, opts?: PickOptions): SourceType {\n    const avoid = opts?.avoid ? String(opts.avoid) : \"\";\n\n    if (desired === \"hls\") {\n      if (avoid !== \"hls\" && sources.hls.ready && canUseHls()) return \"hls\";\n      if (avoid !== \"hd\" && sources.hd.ready) return \"hd\";\n      if (avoid !== \"fast\" && sources.fast.ready) return \"fast\";\n      return \"original\";\n    }\n\n    if (desired === \"hd\") {\n      if (avoid !== \"hd\" && sources.hd.ready) return \"hd\";\n      if (avoid !== \"fast\" && sources.fast.ready) return \"fast\";\n      return \"original\";\n    }\n\n    if (desired === \"fast\") {\n      if (avoid !== \"fast\" && sources.fast.ready) return \"fast\";\n      if (avoid !== \"hd\" && sources.hd.ready) return \"hd\";\n      return \"original\";\n    }\n\n    if (avoid !== \"hd\" && sources.hd.ready) return \"hd\";\n    if (avoid !== \"fast\" && sources.fast.ready) return \"fast\";\n    return \"original\";\n  }\n\n  function desiredForCurrentMode(): SourceType {\n    if (qualityMode === \"fast\") return \"fast\";\n    if (qualityMode === \"hd\") return \"hd\";\n    if (canUseHls() && sources.hls.ready) return \"hls\";\n    if (!AUTO_SWITCH_ENABLED) return \"hd\";\n    if (hdAutoDisabled) return \"fast\";\n    if (video.paused) return \"fast\";\n    if (isInteracting || video.seeking) return \"fast\";\n    return \"hd\";\n  }\n\n  interface InteractionOptions {\n    allowFastSwitch?: boolean;\n  }\n\n  function noteInteraction(opts?: InteractionOptions): void {\n    const allowFastSwitch = opts?.allowFastSwitch !== false;\n\n    lastInteractionAt = Date.now();\n    if (!isInteracting) {\n      isInteracting = true;\n      if (hdUpgradeTimer) {\n        clearTimeout(hdUpgradeTimer);\n        hdUpgradeTimer = null;\n      }\n      if (qualityMode === \"auto\") {\n        if (!sources.fast.ready && !fastPrepareInFlight) ensurePrepared([\"fast\"]);\n        if (\n          AUTO_SWITCH_ENABLED &&\n          allowFastSwitch &&\n          sources.fast.ready &&\n          activeSource !== \"fast\" &&\n          !switchInProgress\n        ) {\n          setSource(\"fast\", { time: video.currentTime, shouldPlay: !video.paused });\n        }\n      }\n      updateStatusUI();\n    }\n\n    if (interactionTimer) clearTimeout(interactionTimer);\n    interactionTimer = setTimeout(() => {\n      if (Date.now() - lastInteractionAt < INTERACTION_IDLE_MS) return;\n      interactionTimer = null;\n      if (!isInteracting) return;\n      isInteracting = false;\n      updateStatusUI();\n\n      if (qualityMode === \"auto\" && !video.paused) {\n        if (AUTO_SWITCH_ENABLED && !hdAutoDisabled && !sources.hd.ready && !hdPrepareInFlight) {\n          ensurePrepared([\"hd\"]);\n        }\n        scheduleHdUpgrade(AUTO_HD_UPGRADE_DELAY_MS);\n      }\n    }, INTERACTION_IDLE_MS + 25);\n  }\n\n  function clearTimers(): void {\n    if (stallTimer) clearTimeout(stallTimer);\n    stallTimer = null;\n  }\n\n  interface SetSourceOptions {\n    time?: number;\n    shouldPlay?: boolean;\n    cacheBust?: boolean;\n  }\n\n  function setHlsSource(opts?: SetSourceOptions): void {\n    const targetTime = Number.isFinite(opts?.time) ? Math.max(0, opts!.time!) : null;\n    const shouldPlay = !!opts?.shouldPlay;\n    const cacheBust = !!opts?.cacheBust;\n\n    const src = getUrlForSource(\"hls\", cacheBust);\n    if (!src) {\n      showError(\"Could not load video\", \"Missing adaptive stream.\");\n      return;\n    }\n\n    switchInProgress = true;\n    clearTimers();\n    activeSource = \"hls\";\n    sourceLoadStartedAt = Date.now();\n    updateQualityUI();\n\n    video.pause();\n    destroyHls();\n    video.removeAttribute(\"src\");\n    video.load();\n    updateStatusUI();\n\n    function finishLoad(): void {\n      switchInProgress = false;\n      updateQualityUI();\n    }\n\n    function applyTime(): void {\n      try {\n        if (targetTime != null) {\n          const dur = Number.isFinite(video.duration) ? video.duration : null;\n          video.currentTime = dur ? Math.min(targetTime, Math.max(0, dur - 0.25)) : targetTime;\n        }\n      } catch {\n        /* ignore */\n      }\n    }\n\n    if (supportsHlsJs() && window.Hls) {\n      hlsInstance = new window.Hls({\n        maxBufferLength: 60,\n        backBufferLength: 60,\n      });\n      hlsInstance.attachMedia(video);\n      hlsInstance.on(window.Hls.Events.MEDIA_ATTACHED, () => {\n        hlsInstance!.loadSource(src);\n      });\n      hlsInstance.on(window.Hls.Events.MANIFEST_PARSED, () => {\n        applyTime();\n        if (shouldPlay) {\n          video.play().catch(() => {\n            /* ignore */\n          });\n        }\n        finishLoad();\n      });\n      hlsInstance.on(window.Hls.Events.ERROR, (_: string, data?: HlsErrorData) => {\n        if (data && data.fatal) {\n          destroyHls();\n          finishLoad();\n          if (qualityMode === \"auto\") {\n            setSource(pickPlayableSource(\"fast\", { avoid: \"hls\" }), {\n              time: targetTime ?? undefined,\n              shouldPlay,\n            });\n          }\n        }\n      });\n    } else {\n      video.addEventListener(\n        \"loadedmetadata\",\n        () => {\n          applyTime();\n          if (shouldPlay) {\n            video.play().catch(() => {\n              /* ignore */\n            });\n          }\n          finishLoad();\n        },\n        { once: true }\n      );\n      video.src = src;\n      video.load();\n    }\n\n    startStatusTimer();\n    updateStatusUI();\n  }\n\n  function setSource(sourceType: SourceType, opts?: SetSourceOptions): void {\n    if (sourceType === \"hls\") {\n      setHlsSource(opts);\n      return;\n    }\n\n    const targetTime = Number.isFinite(opts?.time) ? Math.max(0, opts!.time!) : null;\n    const shouldPlay = !!opts?.shouldPlay;\n    const cacheBust = !!opts?.cacheBust;\n\n    const src = getUrlForSource(sourceType, cacheBust);\n    if (!src) {\n      showError(\"Could not load video\", \"Missing source URL.\");\n      return;\n    }\n\n    switchInProgress = true;\n    clearTimers();\n    activeSource = sourceType;\n    sourceLoadStartedAt = Date.now();\n    updateQualityUI();\n\n    const currentTimeBefore = video.currentTime || 0;\n\n    function done(): void {\n      switchInProgress = false;\n      updateQualityUI();\n    }\n\n    video.pause();\n    destroyHls();\n    video.removeAttribute(\"src\");\n    video.load();\n    updateStatusUI();\n\n    video.addEventListener(\n      \"loadedmetadata\",\n      () => {\n        try {\n          if (targetTime != null) {\n            const dur = Number.isFinite(video.duration) ? video.duration : null;\n            video.currentTime = dur ? Math.min(targetTime, Math.max(0, dur - 0.25)) : targetTime;\n          }\n        } catch {\n          /* ignore */\n        }\n\n        if (shouldPlay) {\n          video.play().catch(() => {\n            /* ignore */\n          });\n        }\n        done();\n      },\n      { once: true }\n    );\n\n    video.addEventListener(\n      \"error\",\n      () => {\n        done();\n        if (qualityMode === \"auto\" && sourceType === \"hd\") {\n          noteHdFailure();\n          const t = Number.isFinite(targetTime) ? targetTime! : currentTimeBefore;\n          setSource(pickPlayableSource(\"fast\", { avoid: \"hd\" }), { time: t, shouldPlay });\n        }\n      },\n      { once: true }\n    );\n\n    video.src = src;\n    video.load();\n    startStatusTimer();\n    updateStatusUI();\n  }\n\n  interface FetchSourcesOptions {\n    prepareTargets?: string[];\n  }\n\n  async function fetchSources(options?: FetchSourcesOptions): Promise<SourcesApiResponse | null> {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), 8000);\n    try {\n      const url = sourcesApiUrl + (sourcesApiUrl.includes(\"?\") ? \"&\" : \"?\") + \"t=\" + Date.now();\n      let resp: Response;\n      if (options?.prepareTargets?.length) {\n        resp = await fetch(url, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ prepare: options.prepareTargets }),\n          signal: controller.signal,\n          cache: \"no-store\",\n        });\n      } else {\n        resp = await fetch(url, { signal: controller.signal, cache: \"no-store\" });\n      }\n      if (!resp.ok) return null;\n      const data = await resp.json();\n      return data as SourcesApiResponse;\n    } catch {\n      return null;\n    } finally {\n      clearTimeout(timeout);\n    }\n  }\n\n  function applySourcesData(data: SourcesApiResponse | null): void {\n    if (!data || typeof data !== \"object\") return;\n\n    if (data.original && typeof data.original === \"object\") {\n      if (typeof data.original.url === \"string\" && data.original.url)\n        sources.original.url = data.original.url;\n      const s = Number(data.original.size);\n      if (Number.isFinite(s) && s > 0) sources.original.size = Math.floor(s);\n    }\n\n    if (data.fast && typeof data.fast === \"object\") {\n      if (typeof data.fast.url === \"string\" && data.fast.url) sources.fast.url = data.fast.url;\n      if (typeof data.fast.ready === \"boolean\") sources.fast.ready = data.fast.ready;\n      const s = Number(data.fast.size);\n      sources.fast.size = Number.isFinite(s) && s > 0 ? Math.floor(s) : null;\n    }\n\n    if (data.hd && typeof data.hd === \"object\") {\n      if (typeof data.hd.url === \"string\" && data.hd.url) sources.hd.url = data.hd.url;\n      if (typeof data.hd.ready === \"boolean\") sources.hd.ready = data.hd.ready;\n      const s = Number(data.hd.size);\n      sources.hd.size = Number.isFinite(s) && s > 0 ? Math.floor(s) : null;\n    }\n\n    if (data.hls && typeof data.hls === \"object\") {\n      if (typeof data.hls.url === \"string\" && data.hls.url) sources.hls.url = data.hls.url;\n      if (typeof data.hls.ready === \"boolean\") sources.hls.ready = data.hls.ready;\n      if (Array.isArray(data.hls.variants)) sources.hls.variants = data.hls.variants;\n    }\n\n    updateQualityUI();\n    updateStatusUI();\n  }\n\n  function startSourcesPoller(): void {\n    if (sourcesPollTimer) return;\n    sourcesPollStartedAt = Date.now();\n    sourcesPollTimer = setInterval(async () => {\n      if (sourcesPollStartedAt && Date.now() - sourcesPollStartedAt > SOURCES_POLL_MAX_MS) {\n        clearInterval(sourcesPollTimer!);\n        sourcesPollTimer = null;\n        fastPrepareInFlight = false;\n        hdPrepareInFlight = false;\n        updateStatusUI();\n        return;\n      }\n      if (sourcesPollInFlight) return;\n      sourcesPollInFlight = true;\n      try {\n        const beforeFast = sources.fast.ready;\n        const beforeHd = sources.hd.ready;\n        const beforeHls = sources.hls.ready;\n        const data = await fetchSources();\n        if (data) applySourcesData(data);\n        const afterFast = sources.fast.ready;\n        const afterHd = sources.hd.ready;\n        const afterHls = sources.hls.ready;\n\n        if (!beforeFast && afterFast) {\n          fastPrepareInFlight = false;\n          updateStatusUI();\n\n          const shouldPlay = !video.paused;\n          if (!switchInProgress) {\n            if (qualityMode === \"fast\" && activeSource !== \"fast\") {\n              setSource(\"fast\", { time: video.currentTime, shouldPlay });\n            } else if (qualityMode === \"auto\" && AUTO_SWITCH_ENABLED) {\n              if ((isInteracting || video.seeking || video.paused) && activeSource !== \"fast\") {\n                setSource(\"fast\", { time: video.currentTime, shouldPlay });\n              }\n            }\n          }\n        }\n\n        if (!beforeHd && afterHd) {\n          hdPrepareInFlight = false;\n          updateStatusUI();\n          if (switchInProgress) {\n            // wait for current switch to finish\n          } else if (qualityMode === \"hd\") {\n            const attemptSwitch = (): void => {\n              if (switchInProgress) return;\n              if (qualityMode !== \"hd\" || activeSource === \"hd\") return;\n              if (isInteracting || video.seeking) {\n                setTimeout(attemptSwitch, 500);\n                return;\n              }\n              setSource(\"hd\", { time: video.currentTime, shouldPlay: !video.paused });\n            };\n            attemptSwitch();\n          } else if (qualityMode === \"auto\" && AUTO_SWITCH_ENABLED && !video.paused) {\n            scheduleHdUpgrade(AUTO_HD_UPGRADE_DELAY_MS);\n          }\n        }\n\n        if (!beforeHls && afterHls) {\n          hlsPrepareInFlight = false;\n          updateStatusUI();\n          if (\n            qualityMode === \"auto\" &&\n            canUseHls() &&\n            activeSource !== \"hls\" &&\n            !switchInProgress\n          ) {\n            setSource(\"hls\", { time: video.currentTime, shouldPlay: !video.paused });\n          }\n        }\n\n        if (sources.fast.ready) fastPrepareInFlight = false;\n        if (sources.hd.ready) hdPrepareInFlight = false;\n        if (sources.hls.ready) hlsPrepareInFlight = false;\n\n        if (!fastPrepareInFlight && !hdPrepareInFlight && !hlsPrepareInFlight) {\n          clearInterval(sourcesPollTimer!);\n          sourcesPollTimer = null;\n        }\n      } finally {\n        sourcesPollInFlight = false;\n      }\n    }, SOURCES_POLL_MS);\n  }\n\n  async function ensurePrepared(targets: string[]): Promise<void> {\n    if (!targets || !targets.length) return;\n    if (targets.includes(\"fast\")) fastPrepareInFlight = true;\n    if (targets.includes(\"hd\")) hdPrepareInFlight = true;\n    if (targets.includes(\"hls\")) hlsPrepareInFlight = true;\n    updateStatusUI();\n    const data = await fetchSources({ prepareTargets: targets });\n    if (data) applySourcesData(data);\n    startSourcesPoller();\n  }\n\n  function scheduleStallFallback(): void {\n    if (qualityMode !== \"auto\") return;\n    if (!AUTO_SWITCH_ENABLED) return;\n    if (activeSource !== \"hd\") return;\n    if (switchInProgress) return;\n    if (video.paused) return;\n\n    if (stallTimer) clearTimeout(stallTimer);\n    const elapsed = Date.now() - (sourceLoadStartedAt || 0);\n    const delay = elapsed < 6000 ? AUTO_STALL_FALLBACK_INITIAL_MS : AUTO_STALL_FALLBACK_MS;\n    stallTimer = setTimeout(() => {\n      if (qualityMode !== \"auto\") return;\n      if (activeSource !== \"hd\") return;\n      if (switchInProgress) return;\n      if (video.paused) return;\n\n      noteHdFailure();\n      setSource(pickPlayableSource(\"fast\", { avoid: \"hd\" }), {\n        time: video.currentTime,\n        shouldPlay: true,\n      });\n    }, delay);\n  }\n\n  function maybeUpgradeToHd(): void {\n    if (qualityMode !== \"auto\") return;\n    if (!AUTO_SWITCH_ENABLED) return;\n    if (hdAutoDisabled) return;\n    if (isInteracting) return;\n    if (video.seeking) return;\n    if (activeSource === \"hd\") return;\n    if (!sources.hd.ready) return;\n    if (hdSuppressedUntil && Date.now() < hdSuppressedUntil) return;\n    if (switchInProgress) return;\n\n    const shouldPlay = !video.paused;\n    if (!shouldPlay) return;\n    setSource(\"hd\", { time: video.currentTime, shouldPlay: true });\n  }\n\n  function loadInitial(): void {\n    startStatusTimer();\n    updateStatusUI();\n\n    fetchSources().then((data) => {\n      if (data) applySourcesData(data);\n\n      if (qualityMode === \"auto\" && canUseHls() && !sources.hls.ready) {\n        ensurePrepared([\"hls\"]);\n      }\n\n      if (qualityMode === \"auto\" && !sources.fast.ready) {\n        ensurePrepared([\"fast\"]);\n      } else if (qualityMode === \"hd\" && !sources.hd.ready) {\n        ensurePrepared([\"hd\"]);\n      } else if (qualityMode === \"fast\" && !sources.fast.ready) {\n        ensurePrepared([\"fast\"]);\n      }\n\n      const desired = desiredForCurrentMode();\n      setSource(pickPlayableSource(desired), { time: 0, shouldPlay: false });\n    });\n  }\n\n  function cycleQualityMode(): void {\n    const idx = QUALITY_MODES.indexOf(qualityMode);\n    const next = QUALITY_MODES[(idx + 1) % QUALITY_MODES.length];\n    qualityMode = next;\n\n    const t = video.currentTime;\n    const shouldPlay = !video.paused;\n    const desired = desiredForCurrentMode();\n\n    if ((qualityMode === \"auto\" || qualityMode === \"hd\") && !sources.hd.ready)\n      ensurePrepared([\"hd\"]);\n    if (qualityMode === \"auto\" && !sources.fast.ready) ensurePrepared([\"fast\"]);\n    if (qualityMode === \"auto\" && canUseHls() && !sources.hls.ready) ensurePrepared([\"hls\"]);\n    if (qualityMode === \"fast\" && !sources.fast.ready) ensurePrepared([\"fast\"]);\n\n    setSource(pickPlayableSource(desired), { time: t, shouldPlay });\n  }\n\n  if (qualityBtn) {\n    qualityBtn.onclick = () => cycleQualityMode();\n  }\n\n  if (reloadBtn) {\n    reloadBtn.onclick = () => {\n      const t = video.currentTime;\n      const shouldPlay = !video.paused;\n      setSource(activeSource || pickPlayableSource(desiredForCurrentMode()), {\n        time: t,\n        shouldPlay,\n        cacheBust: true,\n      });\n    };\n  }\n\n  video.addEventListener(\"play\", () => {\n    if (qualityMode === \"auto\" && canUseHls() && !sources.hls.ready && !hlsPrepareInFlight) {\n      ensurePrepared([\"hls\"]);\n    }\n    if (qualityMode === \"auto\" && !sources.fast.ready && !fastPrepareInFlight)\n      ensurePrepared([\"fast\"]);\n    if (\n      (qualityMode === \"hd\" || (qualityMode === \"auto\" && !hdAutoDisabled)) &&\n      !sources.hd.ready &&\n      !hdPrepareInFlight\n    ) {\n      ensurePrepared([\"hd\"]);\n    }\n    if (qualityMode === \"fast\" && !sources.fast.ready && !fastPrepareInFlight)\n      ensurePrepared([\"fast\"]);\n  });\n\n  video.addEventListener(\"playing\", () => {\n    if (stallTimer) clearTimeout(stallTimer);\n    stallTimer = null;\n    if (activeSource === \"hd\") startHdStableTimer();\n    if (qualityMode === \"auto\") scheduleHdUpgrade(AUTO_HD_UPGRADE_DELAY_MS);\n    updateStatusUI();\n  });\n  video.addEventListener(\"seeking\", () => {\n    clearHdStableTimer();\n    if (!switchInProgress) noteInteraction();\n    updateStatusUI();\n  });\n  video.addEventListener(\"seeked\", () => {\n    noteInteraction({ allowFastSwitch: false });\n    updateStatusUI();\n  });\n  video.addEventListener(\"waiting\", () => {\n    clearHdStableTimer();\n    scheduleStallFallback();\n    updateStatusUI();\n  });\n  video.addEventListener(\"stalled\", () => {\n    clearHdStableTimer();\n    scheduleStallFallback();\n    updateStatusUI();\n  });\n  video.addEventListener(\"progress\", updateStatusUI);\n  video.addEventListener(\"timeupdate\", updateStatusUI);\n  video.addEventListener(\"pause\", () => {\n    clearHdStableTimer();\n    updateStatusUI();\n  });\n\n  video.addEventListener(\"error\", () => {\n    clearHdStableTimer();\n    if (qualityMode === \"auto\" && activeSource === \"hd\") return;\n    showError(\n      \"Could not load video\",\n      \"Try refreshing the page. If it keeps failing, go back to the gallery.\"\n    );\n  });\n\n  window.addEventListener(\"beforeunload\", () => stopStatusTimer());\n\n  loadInitial();\n})();\n"],"names":["encodePath","p","s","safeRelPath","value","v","parts","showError","title","message","errorTitle","errorMessage","error","params","share","file","safeFile","fileName","fileNameEl","fileSubEl","sourcesApiUrl","originalInlineUrlDefault","downloadUrl","backUrl","video","bufferText","timeText","bufferFill","backLink","downloadLink","openLink","qualityBtn","reloadBtn","hasStatusUI","QUALITY_MODES","QUALITY_LABEL","qualityMode","sources","activeSource","switchInProgress","stallTimer","statusTimer","sourceLoadStartedAt","sourcesPollTimer","sourcesPollStartedAt","sourcesPollInFlight","lastHdFailureAt","hdFailureCount","hdSuppressedUntil","hdAutoDisabled","hdStableTimer","hdUpgradeTimer","hdPrepareInFlight","fastPrepareInFlight","hlsPrepareInFlight","hlsInstance","interactionTimer","lastInteractionAt","isInteracting","AUTO_STALL_FALLBACK_MS","AUTO_STALL_FALLBACK_INITIAL_MS","HD_FAILURE_BASE_COOLDOWN_MS","HD_FAILURE_MAX_COOLDOWN_MS","HD_FAILURE_DISABLE_AFTER","HD_STABLE_RESET_MS","AUTO_HD_UPGRADE_DELAY_MS","SOURCES_POLL_MS","SOURCES_POLL_MAX_MS","INTERACTION_IDLE_MS","UA","AUTO_SWITCH_ENABLED","supportsNativeHls","supportsHlsJs","canUseHls","destroyHls","formatTime","seconds","h","m","sec","clearHdStableTimer","computeHdCooldownMs","exp","ms","noteHdFailure","noteHdStable","startHdStableTimer","updateStatusUI","scheduleHdUpgrade","delayMs","maybeUpgradeToHd","sourceLabel","sourceType","setOpenLinkForSource","src","updateQualityUI","modeLabel","srcLabel","getStateLabel","elapsed","getBufferedInfo","dur","ct","ranges","b","i","start","end","total","e","ahead","pct","stateLabel","info","text","pctText","secs","startStatusTimer","stopStatusTimer","appendCacheBust","url","cacheBust","sep","getUrlForSource","base","pickPlayableSource","desired","opts","avoid","desiredForCurrentMode","noteInteraction","allowFastSwitch","ensurePrepared","setSource","clearTimers","setHlsSource","targetTime","shouldPlay","finishLoad","applyTime","_","data","currentTimeBefore","done","t","fetchSources","options","_a","controller","timeout","resp","applySourcesData","startSourcesPoller","beforeFast","beforeHd","beforeHls","afterFast","afterHd","afterHls","attemptSwitch","targets","scheduleStallFallback","delay","loadInitial","cycleQualityMode","idx"],"mappings":"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"}