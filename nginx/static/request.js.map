{"version":3,"file":"request.js","sources":["../src/request.ts"],"sourcesContent":["interface FileEntry {\n  id: number;\n  file: File | null;\n  name: string;\n  size: number;\n  relPath: string;\n  status: \"queued\" | \"uploading\" | \"done\" | \"error\";\n  progress: number;\n  el: HTMLElement | null;\n  uploadId?: string;\n  startTime?: number;\n  lastLoaded?: number;\n  lastTime?: number;\n  speed?: number;\n  eta?: number;\n}\n\ninterface RequestMetaResponse {\n  requires_password?: boolean;\n  captcha_required?: boolean;\n  captcha_enabled?: boolean;\n  captcha_site_key?: string;\n  allowed_extensions?: string[];\n  max_file_size?: number;\n  folder?: string;\n  expires_in?: number;\n  error?: string;\n}\n\ninterface UploadResponse {\n  captcha_required?: boolean;\n  captcha_enabled?: boolean;\n  captcha_site_key?: string;\n  upload_id?: string;\n  offset?: number;\n  complete?: boolean;\n  error?: string;\n}\n\n(function (): void {\n  const hashMatch = String(window.location.pathname || \"\").match(/\\/request\\/([^/]+)/);\n  const requestHash = hashMatch ? hashMatch[1] : \"\";\n\n  const subtitleEl = document.getElementById(\"subtitle\") as HTMLElement;\n  const statusEl = document.getElementById(\"status\") as HTMLElement;\n  const expiresEl = document.getElementById(\"expires-note\") as HTMLElement;\n  const passwordBlock = document.getElementById(\"password-block\") as HTMLElement;\n  const passwordInput = document.getElementById(\"password-input\") as HTMLInputElement;\n  const dropzone = document.getElementById(\"dropzone\") as HTMLElement;\n  const fileInput = document.getElementById(\"file-input\") as HTMLInputElement;\n  const uploadBtn = document.getElementById(\"upload-btn\") as HTMLButtonElement;\n  const fileList = document.getElementById(\"file-list\") as HTMLElement;\n  const captchaBlock = document.getElementById(\"captcha-block\") as HTMLElement;\n  const captchaWidget = document.getElementById(\"captcha-widget\") as HTMLElement;\n  const dropzoneHint = dropzone?.querySelector(\".hint\") as HTMLElement | null;\n\n  let requiresPassword = false;\n  let captchaEnabled = false;\n  let captchaRequired = false;\n  let captchaSiteKey = \"\";\n  let captchaToken = \"\";\n  let captchaRendered = false;\n  let allowedExtensions: string[] = [];\n  let maxFileSize = 0;\n  let uploading = false;\n  const queue: FileEntry[] = [];\n  let counter = 0;\n  const CHUNK_SIZE = 8 * 1024 * 1024;\n  const CHUNK_THRESHOLD = 32 * 1024 * 1024;\n\n  function setStatus(text: string, tone?: string): void {\n    statusEl.textContent = text || \"\";\n    statusEl.className = \"status\" + (tone ? \" \" + tone : \"\");\n  }\n\n  function formatBytes(bytes: number | null | undefined): string {\n    if (!bytes && bytes !== 0) return \"\";\n    const sizes = [\"B\", \"KB\", \"MB\", \"GB\", \"TB\"];\n    let i = 0;\n    let value = bytes;\n    while (value >= 1024 && i < sizes.length - 1) {\n      value /= 1024;\n      i += 1;\n    }\n    return value.toFixed(value >= 10 || i === 0 ? 0 : 1) + \" \" + sizes[i];\n  }\n\n  function formatExpires(seconds: number | null | undefined): string {\n    if (!seconds) return \"\";\n    const hours = Math.ceil(seconds / 3600);\n    if (hours < 24) return \"Expires in \" + hours + \" hour\" + (hours === 1 ? \"\" : \"s\");\n    const days = Math.ceil(hours / 24);\n    return \"Expires in \" + days + \" day\" + (days === 1 ? \"\" : \"s\");\n  }\n\n  function normalizeExtensions(list: string[] | null | undefined): string[] {\n    if (!list || !list.length) return [];\n    return list\n      .map((ext: string) =>\n        String(ext || \"\")\n          .trim()\n          .replace(/^\\./, \"\")\n          .toLowerCase()\n      )\n      .filter((ext: string) => ext);\n  }\n\n  function getFileExtension(name: string): string {\n    const value = String(name || \"\");\n    const idx = value.lastIndexOf(\".\");\n    if (idx <= 0 || idx === value.length - 1) return \"\";\n    return value.slice(idx + 1).toLowerCase();\n  }\n\n  function isExtensionAllowed(name: string): boolean {\n    if (!allowedExtensions.length) return true;\n    const ext = getFileExtension(name);\n    if (!ext) return false;\n    return allowedExtensions.indexOf(ext) >= 0;\n  }\n\n  function sanitizeRelPath(value: string | null | undefined): string {\n    if (!value) return \"\";\n    const cleaned = String(value || \"\").replace(/\\\\/g, \"/\");\n    if (cleaned.charAt(0) === \"/\") return \"\";\n    const parts = cleaned.split(\"/\").filter((part: string) => part);\n    if (!parts.length) return \"\";\n    for (let i = 0; i < parts.length; i += 1) {\n      const part = parts[i];\n      if (part === \".\" || part === \"..\") return \"\";\n      // eslint-disable-next-line no-control-regex\n      if (/[\\x00-\\x1f\\x7f]/.test(part)) return \"\";\n    }\n    return parts.join(\"/\");\n  }\n\n  function updateDropzoneHint(): void {\n    if (!dropzoneHint) return;\n    const base = \"Multiple files supported. Keep the tab open until upload completes.\";\n    const extras: string[] = [];\n    if (allowedExtensions.length) {\n      extras.push(\"Allowed types: \" + allowedExtensions.join(\", \") + \".\");\n    }\n    if (maxFileSize) {\n      extras.push(\"Max size: \" + formatBytes(maxFileSize) + \".\");\n    }\n    dropzoneHint.textContent = extras.length ? base + \" \" + extras.join(\" \") : base;\n  }\n\n  function updateFileInputAccept(): void {\n    if (!fileInput) return;\n    if (!allowedExtensions.length) {\n      fileInput.removeAttribute(\"accept\");\n      return;\n    }\n    const accept = allowedExtensions.map((ext: string) => \".\" + ext).join(\",\");\n    fileInput.setAttribute(\"accept\", accept);\n  }\n\n  function createRow(entry: FileEntry): HTMLElement {\n    const li = document.createElement(\"li\");\n    li.className = \"file-item\";\n    li.innerHTML =\n      '<div class=\"file-row\">' +\n      '<div class=\"file-name\"></div>' +\n      '<div class=\"file-size\"></div>' +\n      \"</div>\" +\n      '<div class=\"file-row\">' +\n      '<div class=\"file-status\"></div>' +\n      '<div class=\"file-progress\"></div>' +\n      \"</div>\" +\n      '<div class=\"progress-bar\"><span></span></div>';\n\n    (li.querySelector(\".file-name\") as HTMLElement).textContent = entry.name;\n    (li.querySelector(\".file-size\") as HTMLElement).textContent = formatBytes(entry.size);\n    entry.el = li;\n    updateRow(entry);\n    return li;\n  }\n\n  function updateRow(entry: FileEntry): void {\n    if (!entry.el) return;\n    const status = entry.status || \"queued\";\n    let statusLabel =\n      status === \"uploading\"\n        ? \"Uploading\"\n        : status === \"done\"\n          ? \"Complete\"\n          : status === \"error\"\n            ? \"Failed\"\n            : \"Queued\";\n\n    if (status === \"uploading\" && entry.speed) {\n      statusLabel += \" (\" + formatBytes(entry.speed) + \"/s\";\n      if (entry.eta && entry.eta < 3600 * 24) {\n        const min = Math.floor(entry.eta / 60);\n        const sec = entry.eta % 60;\n        statusLabel += \", \" + (min > 0 ? min + \"m \" : \"\") + sec + \"s left\";\n      }\n      statusLabel += \")\";\n    }\n\n    (entry.el.querySelector(\".file-status\") as HTMLElement).textContent = statusLabel;\n    (entry.el.querySelector(\".file-progress\") as HTMLElement).textContent =\n      status === \"done\" ? \"100%\" : (entry.progress || 0) + \"%\";\n    (entry.el.querySelector(\".progress-bar span\") as HTMLElement).style.width =\n      (entry.progress || 0) + \"%\";\n  }\n\n  function updateButtonState(): void {\n    if (!queue.length || uploading) {\n      uploadBtn.disabled = true;\n      return;\n    }\n    if (requiresPassword && !passwordInput.value) {\n      uploadBtn.disabled = true;\n      return;\n    }\n    if (captchaRequired && !captchaToken) {\n      uploadBtn.disabled = true;\n      return;\n    }\n    uploadBtn.disabled = false;\n  }\n\n  function setCaptchaState(required: boolean, enabled: boolean, siteKey: string): void {\n    captchaEnabled = !!enabled;\n    if (siteKey) {\n      captchaSiteKey = siteKey;\n    }\n    captchaRequired = !!required && captchaEnabled && !!captchaSiteKey;\n    if (captchaRequired) {\n      captchaBlock.classList.add(\"show\");\n      ensureCaptcha();\n    } else {\n      captchaBlock.classList.remove(\"show\");\n      captchaToken = \"\";\n    }\n    updateButtonState();\n  }\n\n  function ensureCaptcha(): void {\n    if (!captchaEnabled || !captchaSiteKey || captchaRendered) return;\n    if (window.turnstile && typeof window.turnstile.render === \"function\") {\n      renderCaptcha();\n      return;\n    }\n    if (document.getElementById(\"turnstile-script\")) return;\n    const script = document.createElement(\"script\");\n    script.id = \"turnstile-script\";\n    script.src = \"https://challenges.cloudflare.com/turnstile/v0/api.js\";\n    script.async = true;\n    script.defer = true;\n    script.onload = renderCaptcha;\n    document.head.appendChild(script);\n  }\n\n  function renderCaptcha(): void {\n    if (!window.turnstile || !captchaWidget || !captchaSiteKey) return;\n    captchaWidget.innerHTML = \"\";\n    captchaRendered = true;\n    window.turnstile.render(captchaWidget, {\n      sitekey: captchaSiteKey,\n      callback: (token: string) => {\n        captchaToken = token || \"\";\n        updateButtonState();\n      },\n      \"expired-callback\": () => {\n        captchaToken = \"\";\n        updateButtonState();\n      },\n      \"error-callback\": () => {\n        captchaToken = \"\";\n        updateButtonState();\n      },\n    });\n  }\n\n  function parseJson<T>(text: string): T | null {\n    if (!text) return null;\n    try {\n      return JSON.parse(text) as T;\n    } catch {\n      return null;\n    }\n  }\n\n  function addRejectedFile(file: File | null, reason: string): void {\n    counter += 1;\n    const entry: FileEntry = {\n      id: counter,\n      file: null,\n      name: file?.name || \"Unknown file\",\n      size: file?.size || 0,\n      relPath: \"\",\n      status: \"error\",\n      progress: 0,\n      el: null,\n    };\n    fileList.appendChild(createRow(entry));\n    setStatus(reason || \"File rejected.\", \"error\");\n  }\n\n  function addFiles(list: FileList | File[]): void {\n    const files = Array.prototype.slice.call(list || []) as File[];\n    if (!files.length) return;\n    files.forEach((file: File) => {\n      const rel = sanitizeRelPath(\n        (file as File & { webkitRelativePath?: string }).webkitRelativePath || file.name\n      );\n      if (!rel) {\n        addRejectedFile(file, \"Invalid file path.\");\n        return;\n      }\n      if (maxFileSize && file.size > maxFileSize) {\n        addRejectedFile(file, \"File exceeds the maximum allowed size.\");\n        return;\n      }\n      if (!isExtensionAllowed(rel)) {\n        addRejectedFile(file, \"Unsupported file type.\");\n        return;\n      }\n      counter += 1;\n      const entry: FileEntry = {\n        id: counter,\n        file: file,\n        name: file.name,\n        size: file.size,\n        relPath: rel,\n        status: \"queued\",\n        progress: 0,\n        el: null,\n      };\n      queue.push(entry);\n      fileList.appendChild(createRow(entry));\n    });\n    setStatus(\n      \"Ready to upload \" + files.length + \" file\" + (files.length === 1 ? \"\" : \"s\") + \".\",\n      \"\"\n    );\n    updateButtonState();\n  }\n\n  function uploadEntry(entry: FileEntry, attempt = 0): Promise<void> {\n    return new Promise((resolve) => {\n      entry.status = \"uploading\";\n      if (attempt === 0) {\n        entry.progress = 0;\n        entry.startTime = Date.now();\n        entry.lastTime = entry.startTime;\n        entry.lastLoaded = 0;\n      }\n      updateRow(entry);\n\n      const xhr = new XMLHttpRequest();\n      xhr.open(\"POST\", \"/api/droppr/requests/\" + encodeURIComponent(requestHash) + \"/upload\");\n      xhr.timeout = 0;\n      if (requiresPassword && passwordInput.value) {\n        xhr.setRequestHeader(\"X-Request-Password\", encodeURIComponent(passwordInput.value));\n      }\n      if (captchaRequired && captchaToken) {\n        xhr.setRequestHeader(\"X-Captcha-Token\", captchaToken);\n      }\n\n      xhr.upload.onprogress = (event: ProgressEvent) => {\n        if (!event.lengthComputable) return;\n        const now = Date.now();\n        const duration = (now - (entry.startTime || now)) / 1000;\n        if (duration > 0) {\n          entry.speed = event.loaded / duration;\n          if (entry.speed > 0) {\n            entry.eta = Math.round((event.total - event.loaded) / entry.speed);\n          }\n        }\n        entry.progress = Math.max(1, Math.floor((event.loaded / event.total) * 100));\n        updateRow(entry);\n      };\n\n      const handleRetry = () => {\n        const maxAttempts = 3;\n        if (attempt < maxAttempts) {\n          const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;\n          setStatus(\"Upload failed. Retrying in \" + Math.round(delay / 1000) + \"s...\", \"warning\");\n          setTimeout(() => {\n            uploadEntry(entry, attempt + 1).then(resolve);\n          }, delay);\n        } else {\n          entry.status = \"error\";\n          updateRow(entry);\n          setStatus(\"Upload failed after \" + (maxAttempts + 1) + \" attempts.\", \"error\");\n          resolve();\n        }\n      };\n\n      xhr.onerror = () => {\n        handleRetry();\n      };\n\n      xhr.onload = () => {\n        const data = parseJson<UploadResponse>(xhr.responseText || \"\");\n        if (data && typeof data === \"object\") {\n          setCaptchaState(\n            !!data.captcha_required,\n            !!data.captcha_enabled,\n            data.captcha_site_key || \"\"\n          );\n        }\n\n        if (xhr.status >= 200 && xhr.status < 300) {\n          entry.status = \"done\";\n          entry.progress = 100;\n          updateRow(entry);\n          if (captchaRequired) {\n            setCaptchaState(false, captchaEnabled, captchaSiteKey);\n          }\n          resolve();\n          return;\n        }\n\n        if (xhr.status === 502 || xhr.status === 503 || xhr.status === 504 || xhr.status === 0) {\n          handleRetry();\n          return;\n        }\n\n        if (xhr.status === 401) {\n          setStatus(data?.error || \"Password required or incorrect.\", \"error\");\n        } else if (xhr.status === 403) {\n          setStatus(data?.error || \"Verification required.\", \"error\");\n        } else if (xhr.status === 410) {\n          setStatus(\"This request link has expired.\", \"error\");\n        } else if (xhr.status === 429) {\n          setStatus(data?.error || \"Too many attempts. Try again later.\", \"error\");\n        } else if (xhr.status === 400 || xhr.status === 413 || xhr.status === 415) {\n          setStatus(data?.error || \"Upload rejected.\", \"error\");\n        } else {\n          setStatus(data?.error || \"Upload failed (\" + xhr.status + \").\", \"error\");\n        }\n\n        entry.status = \"error\";\n        updateRow(entry);\n        resolve();\n      };\n\n      const form = new FormData();\n      form.append(\"file\", entry.file!, entry.file!.name);\n      if (entry.relPath && entry.relPath !== entry.file!.name) {\n        form.append(\"relative_path\", entry.relPath);\n      }\n      xhr.send(form);\n    });\n  }\n\n  function uploadEntryChunked(entry: FileEntry): Promise<void> {\n    return new Promise((resolve) => {\n      entry.status = \"uploading\";\n      entry.progress = 0;\n      entry.startTime = Date.now();\n      updateRow(entry);\n\n      const total = entry.file!.size;\n      let offset = 0;\n      let uploadId = entry.uploadId || \"\";\n      let mismatchRetries = 0;\n      let networkRetries = 0;\n\n      function sendChunk(): void {\n        if (offset >= total) {\n          entry.status = \"done\";\n          entry.progress = 100;\n          updateRow(entry);\n          resolve();\n          return;\n        }\n\n        const end = Math.min(offset + CHUNK_SIZE, total);\n        const blob = entry.file!.slice(offset, end);\n        const xhr = new XMLHttpRequest();\n        xhr.open(\n          \"POST\",\n          \"/api/droppr/requests/\" + encodeURIComponent(requestHash) + \"/upload-chunk\"\n        );\n        xhr.timeout = 0;\n        xhr.setRequestHeader(\"Content-Range\", \"bytes \" + offset + \"-\" + (end - 1) + \"/\" + total);\n        xhr.setRequestHeader(\"X-Upload-Offset\", String(offset));\n        xhr.setRequestHeader(\"X-Upload-Length\", String(total));\n        xhr.setRequestHeader(\"X-Upload-Path\", entry.relPath || entry.file!.name);\n        xhr.setRequestHeader(\"Content-Type\", entry.file!.type || \"application/octet-stream\");\n        if (uploadId) {\n          xhr.setRequestHeader(\"X-Upload-Id\", uploadId);\n        }\n        if (requiresPassword && passwordInput.value) {\n          xhr.setRequestHeader(\"X-Request-Password\", encodeURIComponent(passwordInput.value));\n        }\n        if (captchaRequired && captchaToken) {\n          xhr.setRequestHeader(\"X-Captcha-Token\", captchaToken);\n        }\n\n        xhr.upload.onprogress = (event: ProgressEvent) => {\n          if (!event.lengthComputable) return;\n          const currentLoaded = offset + event.loaded;\n          const now = Date.now();\n          const duration = (now - (entry.startTime || now)) / 1000;\n          if (duration > 0) {\n            entry.speed = currentLoaded / duration;\n            if (entry.speed > 0) {\n              entry.eta = Math.round((total - currentLoaded) / entry.speed);\n            }\n          }\n          const pct = Math.floor((currentLoaded / total) * 100);\n          entry.progress = Math.max(1, Math.min(99, pct));\n          updateRow(entry);\n        };\n\n        const handleChunkRetry = () => {\n          const maxRetries = 5;\n          if (networkRetries < maxRetries) {\n            const delay = Math.pow(2, networkRetries) * 1000 + Math.random() * 1000;\n            setStatus(\n              \"Chunk upload failed. Retrying in \" + Math.round(delay / 1000) + \"s...\",\n              \"warning\"\n            );\n            networkRetries += 1;\n            setTimeout(sendChunk, delay);\n          } else {\n            entry.status = \"error\";\n            updateRow(entry);\n            setStatus(\"Upload failed after \" + (maxRetries + 1) + \" network retries.\", \"error\");\n            resolve();\n          }\n        };\n\n        xhr.onerror = () => {\n          handleChunkRetry();\n        };\n\n        xhr.onload = () => {\n          const data = parseJson<UploadResponse>(xhr.responseText || \"\");\n          if (data && typeof data === \"object\") {\n            setCaptchaState(\n              !!data.captcha_required,\n              !!data.captcha_enabled,\n              data.captcha_site_key || \"\"\n            );\n          }\n\n          if (xhr.status >= 200 && xhr.status < 300) {\n            networkRetries = 0; // Reset network retries on success\n            uploadId = data?.upload_id || uploadId;\n            entry.uploadId = uploadId;\n\n            if (data?.complete) {\n              entry.status = \"done\";\n              entry.progress = 100;\n              updateRow(entry);\n              if (captchaRequired) {\n                setCaptchaState(false, captchaEnabled, captchaSiteKey);\n              }\n              resolve();\n              return;\n            }\n\n            const nextOffset = typeof data?.offset === \"number\" ? data.offset : end;\n            offset = Math.max(offset, nextOffset);\n            entry.progress = Math.max(entry.progress, Math.floor((offset / total) * 100));\n            updateRow(entry);\n            sendChunk();\n            return;\n          }\n\n          if (xhr.status === 502 || xhr.status === 503 || xhr.status === 504 || xhr.status === 0) {\n            handleChunkRetry();\n            return;\n          }\n\n          if (xhr.status === 409 && typeof data?.offset === \"number\" && mismatchRetries < 2) {\n            mismatchRetries += 1;\n            offset = data.offset;\n            sendChunk();\n            return;\n          }\n\n          if (xhr.status === 401) {\n            setStatus(data?.error || \"Password required or incorrect.\", \"error\");\n          } else if (xhr.status === 403) {\n            setStatus(data?.error || \"Verification required.\", \"error\");\n          } else if (xhr.status === 410) {\n            setStatus(\"This request link has expired.\", \"error\");\n          } else if (xhr.status === 429) {\n            setStatus(data?.error || \"Too many attempts. Try again later.\", \"error\");\n          } else if (xhr.status === 400 || xhr.status === 413 || xhr.status === 415) {\n            setStatus(data?.error || \"Upload rejected.\", \"error\");\n          } else {\n            setStatus(data?.error || \"Upload failed (\" + xhr.status + \").\", \"error\");\n          }\n\n          entry.status = \"error\";\n          updateRow(entry);\n          resolve();\n        };\n\n        xhr.send(blob);\n      }\n\n      sendChunk();\n    });\n  }\n\n  function uploadAll(): void {\n    if (uploading || !queue.length) return;\n    if (requiresPassword && !passwordInput.value) {\n      setStatus(\"Password required to upload.\", \"error\");\n      return;\n    }\n    if (captchaRequired && !captchaToken) {\n      setStatus(\"Verification required to upload.\", \"error\");\n      return;\n    }\n    uploading = true;\n    uploadBtn.disabled = true;\n    setStatus(\"Uploading files...\", \"\");\n\n    let chain = Promise.resolve();\n    queue.forEach((entry: FileEntry) => {\n      if (entry.status === \"done\") return;\n      chain = chain.then(() => {\n        if (entry.file!.size >= CHUNK_THRESHOLD) {\n          return uploadEntryChunked(entry);\n        }\n        return uploadEntry(entry);\n      });\n    });\n\n    chain.then(() => {\n      uploading = false;\n      const failures = queue.filter((entry: FileEntry) => entry.status === \"error\");\n      if (failures.length) {\n        setStatus(\"Some files failed. Fix and click Upload again to retry.\", \"error\");\n      } else {\n        setStatus(\"All uploads complete. You can close this tab.\", \"success\");\n      }\n      updateButtonState();\n    });\n  }\n\n  function initDropzone(): void {\n    dropzone.addEventListener(\"click\", () => {\n      if (!requestHash) return;\n      fileInput.click();\n    });\n\n    fileInput.addEventListener(\"change\", (event: Event) => {\n      const target = event.target as HTMLInputElement;\n      addFiles(target.files || []);\n      fileInput.value = \"\";\n    });\n\n    dropzone.addEventListener(\"dragover\", (event: DragEvent) => {\n      event.preventDefault();\n      dropzone.classList.add(\"drag\");\n    });\n\n    dropzone.addEventListener(\"dragleave\", () => {\n      dropzone.classList.remove(\"drag\");\n    });\n\n    dropzone.addEventListener(\"drop\", (event: DragEvent) => {\n      event.preventDefault();\n      dropzone.classList.remove(\"drag\");\n      if (event.dataTransfer?.files) {\n        addFiles(event.dataTransfer.files);\n      }\n    });\n  }\n\n  function loadRequest(): void {\n    if (!requestHash) {\n      setStatus(\"Invalid request link.\", \"error\");\n      subtitleEl.textContent = \"This link is missing its request ID.\";\n      dropzone.classList.add(\"disabled\");\n      return;\n    }\n\n    fetch(\"/api/droppr/requests/\" + encodeURIComponent(requestHash))\n      .then((res: Response) => {\n        return res.text().then((text: string) => {\n          let data: RequestMetaResponse | null = null;\n          if (text) {\n            try {\n              data = JSON.parse(text);\n            } catch {\n              data = null;\n            }\n          }\n          if (!res.ok) {\n            const msg = data?.error || \"Request unavailable\";\n            throw new Error(msg);\n          }\n          return data || {};\n        });\n      })\n      .then((data: RequestMetaResponse) => {\n        requiresPassword = !!data.requires_password;\n        setCaptchaState(\n          !!data.captcha_required,\n          !!data.captcha_enabled,\n          data.captcha_site_key || \"\"\n        );\n        allowedExtensions = normalizeExtensions(data.allowed_extensions || []);\n        maxFileSize = data.max_file_size || 0;\n        updateDropzoneHint();\n        updateFileInputAccept();\n        const folder = data.folder || \"Uploads\";\n        subtitleEl.textContent = \"Uploads go directly to the folder: \" + folder + \".\";\n        if (requiresPassword) {\n          passwordBlock.classList.add(\"show\");\n          setStatus(\"Password required to upload.\", \"\");\n        } else {\n          setStatus(\"Ready to upload files.\", \"\");\n        }\n        if (data.expires_in) {\n          expiresEl.textContent = formatExpires(data.expires_in);\n        } else {\n          expiresEl.textContent = \"No expiration set.\";\n        }\n        updateButtonState();\n      })\n      .catch((err: Error) => {\n        setStatus(err.message || String(err), \"error\");\n        subtitleEl.textContent = \"This request link is not available.\";\n        uploadBtn.disabled = true;\n      });\n  }\n\n  uploadBtn.addEventListener(\"click\", uploadAll);\n  passwordInput.addEventListener(\"input\", updateButtonState);\n\n  initDropzone();\n  loadRequest();\n})();\n"],"names":["hashMatch","requestHash","subtitleEl","statusEl","expiresEl","passwordBlock","passwordInput","dropzone","fileInput","uploadBtn","fileList","captchaBlock","captchaWidget","dropzoneHint","requiresPassword","captchaEnabled","captchaRequired","captchaSiteKey","captchaToken","captchaRendered","allowedExtensions","maxFileSize","uploading","queue","counter","CHUNK_SIZE","CHUNK_THRESHOLD","setStatus","text","tone","formatBytes","bytes","sizes","i","value","formatExpires","seconds","hours","days","normalizeExtensions","list","ext","getFileExtension","name","idx","isExtensionAllowed","sanitizeRelPath","cleaned","parts","part","updateDropzoneHint","base","extras","updateFileInputAccept","accept","createRow","entry","li","updateRow","status","statusLabel","min","sec","updateButtonState","setCaptchaState","required","enabled","siteKey","ensureCaptcha","renderCaptcha","script","token","parseJson","addRejectedFile","file","reason","addFiles","files","rel","uploadEntry","attempt","resolve","xhr","event","now","duration","handleRetry","delay","data","form","uploadEntryChunked","total","offset","uploadId","mismatchRetries","networkRetries","sendChunk","end","blob","currentLoaded","pct","handleChunkRetry","nextOffset","uploadAll","chain","initDropzone","target","_a","loadRequest","res","msg","folder","err"],"mappings":"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"}