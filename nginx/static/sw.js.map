{"version":3,"file":"sw.js","sources":["../src/sw.ts"],"sourcesContent":["/// <reference lib=\"webworker\" />\n\ndeclare const self: ServiceWorkerGlobalScope;\n\nconst CACHE_VERSION = 'v6';\nconst STATIC_CACHE = `droppr-static-${CACHE_VERSION}`;\nconst CORE_ASSETS: string[] = [\n  '/static/gallery.min.css?v=2',\n  '/static/gallery.min.js?v=3',\n  '/static/video-player.min.css?v=1',\n  '/static/hls.min.js?v=1',\n  '/static/video-player.min.js?v=1',\n  '/static/request.js?v=2',\n  '/static/analytics.js?v=1',\n  '/static/media-viewer.js?v=1',\n  '/static/stream-gallery.js?v=3',\n  '/static/test-media.js?v=1',\n  '/static/sw-register.js?v=1',\n  '/droppr-theme.css?v=10',\n  '/droppr-panel.js?v=32'\n];\n\nself.addEventListener('install', (event: ExtendableEvent) => {\n  event.waitUntil(\n    caches\n      .open(STATIC_CACHE)\n      .then((cache: Cache) => cache.addAll(CORE_ASSETS))\n      .then(() => self.skipWaiting())\n  );\n});\n\nself.addEventListener('activate', (event: ExtendableEvent) => {\n  event.waitUntil(\n    caches\n      .keys()\n      .then((keys: string[]) => Promise.all(keys.filter((key: string) => key !== STATIC_CACHE).map((key: string) => caches.delete(key))))\n      .then(() => self.clients.claim())\n  );\n});\n\nself.addEventListener('fetch', (event: FetchEvent) => {\n  const req = event.request;\n  if (req.method !== 'GET') return;\n\n  const url = new URL(req.url);\n  if (url.origin !== self.location.origin) return;\n\n  const isStatic =\n    url.pathname.startsWith('/static/') ||\n    url.pathname === '/droppr-theme.css' ||\n    url.pathname === '/droppr-panel.js';\n\n  if (!isStatic) return;\n\n  event.respondWith(\n    caches.match(req).then((cached: Response | undefined) => {\n      if (cached) return cached;\n      return fetch(req)\n        .then((res: Response) => {\n          const copy = res.clone();\n          caches.open(STATIC_CACHE).then((cache: Cache) => cache.put(req, copy));\n          return res;\n        })\n        .catch(() => cached ?? new Response('Not found', { status: 404 }));\n    })\n  );\n});\n\nexport {};\n"],"names":["CACHE_VERSION","STATIC_CACHE","CORE_ASSETS","event","cache","keys","key","req","url","cached","res","copy"],"mappings":"AAIA,MAAMA,EAAgB,KAChBC,EAAe,iBAAiBD,CAAa,GAC7CE,EAAwB,CAC5B,8BACA,6BACA,mCACA,yBACA,kCACA,yBACA,2BACA,8BACA,gCACA,4BACA,6BACA,yBACA,uBACF,EAEA,KAAK,iBAAiB,UAAYC,GAA2B,CAC3DA,EAAM,UACJ,OACG,KAAKF,CAAY,EACjB,KAAMG,GAAiBA,EAAM,OAAOF,CAAW,CAAC,EAChD,KAAK,IAAM,KAAK,aAAa,CAAA,CAEpC,CAAC,EAED,KAAK,iBAAiB,WAAaC,GAA2B,CAC5DA,EAAM,UACJ,OACG,KAAA,EACA,KAAME,GAAmB,QAAQ,IAAIA,EAAK,OAAQC,GAAgBA,IAAQL,CAAY,EAAE,IAAKK,GAAgB,OAAO,OAAOA,CAAG,CAAC,CAAC,CAAC,EACjI,KAAK,IAAM,KAAK,QAAQ,OAAO,CAAA,CAEtC,CAAC,EAED,KAAK,iBAAiB,QAAUH,GAAsB,CACpD,MAAMI,EAAMJ,EAAM,QAClB,GAAII,EAAI,SAAW,MAAO,OAE1B,MAAMC,EAAM,IAAI,IAAID,EAAI,GAAG,EACvBC,EAAI,SAAW,KAAK,SAAS,QAO7B,EAJFA,EAAI,SAAS,WAAW,UAAU,GAClCA,EAAI,WAAa,qBACjBA,EAAI,WAAa,qBAInBL,EAAM,YACJ,OAAO,MAAMI,CAAG,EAAE,KAAME,GAClBA,GACG,MAAMF,CAAG,EACb,KAAMG,GAAkB,CACvB,MAAMC,EAAOD,EAAI,MAAA,EACjB,cAAO,KAAKT,CAAY,EAAE,KAAMG,GAAiBA,EAAM,IAAIG,EAAKI,CAAI,CAAC,EAC9DD,CACT,CAAC,EACA,MAAM,IAAMD,GAAU,IAAI,SAAS,YAAa,CAAE,OAAQ,GAAA,CAAK,CAAC,CACpE,CAAA,CAEL,CAAC"}