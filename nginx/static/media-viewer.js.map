{"version":3,"file":"media-viewer.js","sources":["../src/media-viewer.ts"],"sourcesContent":["interface MediaFile {\n  name: string;\n  type: 'image' | 'video' | 'file';\n  path?: string;\n  inline_url?: string;\n  download_url?: string;\n  altUrl?: string;\n}\n\n// Get share hash from URL parameters\nconst urlParams = new URLSearchParams(window.location.search);\nconst shareHash = urlParams.get('share') || window.location.pathname.split('/').pop() || '';\n\n// Modal elements\nconst modal = document.getElementById('modal') as HTMLElement;\nconst modalContent = document.getElementById('modal-content') as HTMLElement;\nconst closeBtn = document.querySelector('.close') as HTMLElement;\n\n// Load media files from the share\nasync function loadMediaFiles(): Promise<void> {\n  try {\n    // Use the FileBrowser share interface directly\n    // Since we can't easily parse the ZIP, we'll use known files\n    // and test their accessibility\n\n    // Use dynamic share detection instead of hardcoded files\n    const currentShareHash = urlParams.get('share') || window.location.pathname.split('/').pop() || '';\n    if (!currentShareHash) {\n      throw new Error('No share hash found');\n    }\n\n    // Try to fetch file list from the share API\n    try {\n      const response = await fetch(`/api/share/${currentShareHash}/files`);\n      if (response.ok) {\n        const files = await response.json() as MediaFile[];\n        displayMediaFiles(files.slice(0, 10)); // Show first 10 files\n        return;\n      }\n    } catch {\n      console.log('Could not fetch file list from API, falling back to known files');\n    }\n\n    const knownFiles: MediaFile[] = [\n      { name: 'IMG_4481.jpeg', type: 'image' },\n      { name: 'IMG_4482.mov', type: 'video' },\n      { name: 'IMG_4491.jpeg', type: 'image' }\n    ];\n\n    // Test which files are actually accessible\n    const accessibleFiles: MediaFile[] = [];\n\n    for (const file of knownFiles) {\n      try {\n        const fileUrl = `/api/share/${currentShareHash}/file/${file.name}`;\n        const response = await fetch(fileUrl, { method: 'HEAD' });\n        if (response.ok) {\n          accessibleFiles.push(file);\n        }\n      } catch {\n        console.log(`File ${file.name} not accessible via primary URL`);\n        // Try direct download URL\n        try {\n          const altUrl = `/api/public/dl/${currentShareHash}/${file.name}`;\n          const response2 = await fetch(altUrl, { method: 'HEAD' });\n          if (response2.ok) {\n            accessibleFiles.push({ ...file, altUrl: altUrl });\n          }\n        } catch {\n          console.log(`File ${file.name} not accessible via alternative URL either`);\n        }\n      }\n    }\n\n    if (accessibleFiles.length > 0) {\n      displayMediaFiles(accessibleFiles);\n    } else {\n      // Show all files anyway and let them try to load\n      displayMediaFiles(knownFiles);\n    }\n\n  } catch (error) {\n    console.error('Error loading media files:', error);\n    showError(`Failed to load media files: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\nfunction displayMediaFiles(files: MediaFile[]): void {\n  const container = document.getElementById('media-container') as HTMLElement;\n  const loading = document.getElementById('loading') as HTMLElement;\n\n  loading.style.display = 'none';\n  container.style.display = 'grid';\n\n  files.forEach((file: MediaFile) => {\n    const card = createMediaCard(file);\n    container.appendChild(card);\n  });\n}\n\nfunction createMediaCard(file: MediaFile): HTMLElement {\n  const card = document.createElement('div');\n  card.className = 'media-card';\n\n  const isVideo = file.type === 'video';\n  const currentShareHash = new URLSearchParams(window.location.search).get('share') || window.location.pathname.split('/').pop() || '';\n  // Use consistent API URLs\n  const fileUrl = file.inline_url || `/api/public/dl/${currentShareHash}/${file.name}?inline=true`;\n  const downloadUrl = file.download_url || `/api/share/${currentShareHash}/file/${file.name}?download=1`;\n  const previewUrl = `/api/share/${currentShareHash}/preview/${file.name}`;\n\n  card.innerHTML = `\n    ${isVideo\n      ? `<div style=\"position: relative;\">\n           <img class=\"media-preview\" src=\"${previewUrl}\" alt=\"${file.name}\"\n                style=\"object-fit: cover; height: 200px; width: 100%;\"\n                onerror=\"this.style.display='none'; this.nextElementSibling.style.display='flex'\">\n           <div style=\"display:none; padding: 20px; text-align: center; color: #888; height: 200px; background: #333; align-items: center; justify-content: center; flex-direction: column;\">\n              üé¨ ${file.name}<br>\n              <small>Video preview unavailable</small>\n           </div>\n           <div style=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: rgba(0,0,0,0.6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; pointer-events: none;\">‚ñ∂</div>\n         </div>`\n      : `<img class=\"media-preview\" src=\"${fileUrl}\" alt=\"${file.name}\"\n             onerror=\"this.style.display='none'; this.nextElementSibling.style.display='block';\">\n         <div style=\"display:none; padding: 20px; text-align: center; color: #888;\">\n            üñºÔ∏è ${file.name}<br>\n            <small>Image preview failed</small>\n         </div>`\n    }\n    <div class=\"media-info\">\n        <div class=\"media-title\">${file.name}</div>\n        <div class=\"media-size\">${file.type}</div>\n        <a href=\"${downloadUrl}\" class=\"download-btn\" download>üì• Download</a>\n        <a href=\"/gallery/${currentShareHash}\" class=\"download-btn\" style=\"background: #2196F3;\">üîó Gallery</a>\n    </div>\n  `;\n\n  // Add click handler for full-size viewing\n  const mediaElement = card.querySelector('.media-preview') as HTMLElement | null;\n  if (mediaElement) {\n    mediaElement.addEventListener('click', () => {\n      openMediaModal(file, fileUrl);\n    });\n  }\n\n  return card;\n}\n\nfunction openMediaModal(file: MediaFile, url: string): void {\n  const isVideo = file.type === 'video';\n\n  if (isVideo) {\n    modalContent.innerHTML = `\n      <div style=\"position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;\">\n          <video controls autoplay playsinline style=\"max-width: 100%; max-height: 100%;\">\n              <source src=\"${url}\" type=\"video/mp4\">\n              <source src=\"${url}\" type=\"video/quicktime\">\n          </video>\n          <div class=\"video-loader\">\n              <div class=\"spinner\"></div>\n              <div>Loading...</div>\n          </div>\n      </div>\n    `;\n    const v = modalContent.querySelector('video') as HTMLVideoElement | null;\n    const l = modalContent.querySelector('.video-loader') as HTMLElement | null;\n    if (v && l) {\n      v.onloadstart = (): void => { l.style.display = 'block'; };\n      v.onwaiting = (): void => { l.style.display = 'block'; };\n      v.oncanplaythrough = (): void => { l.style.display = 'none'; };\n      v.onplaying = (): void => { l.style.display = 'none'; };\n    }\n  } else {\n    modalContent.innerHTML = `<img src=\"${url}\" alt=\"${file.name}\" style=\"max-width: 100%; max-height: 100%;\">`;\n  }\n\n  modal.style.display = 'block';\n}\n\nfunction showError(message = 'Please check your share link and try again.'): void {\n  const loading = document.getElementById('loading') as HTMLElement;\n  const error = document.getElementById('error') as HTMLElement;\n  const errorText = error.querySelector('p') as HTMLElement | null;\n\n  loading.style.display = 'none';\n  error.style.display = 'block';\n  if (errorText) {\n    errorText.textContent = message;\n  }\n}\n\n// Modal event handlers\ncloseBtn.addEventListener('click', () => {\n  modal.style.display = 'none';\n});\n\nmodal.addEventListener('click', (e: MouseEvent) => {\n  if (e.target === modal) {\n    modal.style.display = 'none';\n  }\n});\n\n// Keyboard shortcuts\ndocument.addEventListener('keydown', (e: KeyboardEvent) => {\n  if (e.key === 'Escape') {\n    modal.style.display = 'none';\n  }\n});\n\n// Initialize\nif (shareHash && shareHash !== 'media-viewer.html') {\n  loadMediaFiles();\n} else {\n  showError('No valid share hash found in URL. Please use a proper share link.');\n}\n"],"names":["urlParams","shareHash","modal","modalContent","closeBtn","loadMediaFiles","currentShareHash","response","files","displayMediaFiles","knownFiles","accessibleFiles","file","fileUrl","altUrl","error","showError","container","loading","card","createMediaCard","isVideo","downloadUrl","previewUrl","mediaElement","openMediaModal","url","v","l","message","errorText"],"mappings":"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"}