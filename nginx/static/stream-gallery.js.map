{"version":3,"file":"stream-gallery.js","sources":["../src/stream-gallery.ts"],"sourcesContent":["interface StreamConfig {\n  RESUME_THRESHOLD: number;\n  RESUME_MIN_DURATION: number;\n  CONTROLS_HIDE_DELAY: number;\n  STORAGE_KEY: string;\n}\n\ninterface StreamFile {\n  name: string;\n  path?: string;\n  type?: string;\n  extension?: string;\n  size?: number;\n  inline_url?: string;\n  download_url?: string;\n}\n\ninterface ShareMeta {\n  hash?: string;\n  numDirs?: number;\n  numFiles?: number;\n  [key: string]: unknown;\n}\n\ninterface VideoProgress {\n  time: number;\n  duration?: number;\n  updated: number;\n}\n\ninterface StreamState {\n  shareHash: string | null;\n  recursive: boolean;\n  shareMeta: ShareMeta | null;\n  files: StreamFile[];\n  videoFiles: StreamFile[];\n  currentIndex: number;\n  isPlaying: boolean;\n  isSeeking: boolean;\n  isBuffering: boolean;\n  controlsTimer: ReturnType<typeof setTimeout> | null;\n  progressStorage: Record<string, VideoProgress>;\n  lastMouseMove: number;\n}\n\ninterface StreamElements {\n  video: HTMLVideoElement | null;\n  playerWrapper: HTMLElement | null;\n  controls: HTMLElement | null;\n  sidebar: HTMLElement | null;\n  fileList: HTMLElement | null;\n  fileCount: HTMLElement | null;\n  shareInfo: HTMLElement | null;\n  recursiveToggle: HTMLElement | null;\n  videoTitle: HTMLElement | null;\n  downloadBtn: HTMLAnchorElement | null;\n  galleryBtn: HTMLAnchorElement | null;\n  playBtn: HTMLElement | null;\n  playIcon: HTMLElement | null;\n  prevBtn: HTMLElement | null;\n  nextBtn: HTMLElement | null;\n  skipBackBtn: HTMLElement | null;\n  skipForwardBtn: HTMLElement | null;\n  muteBtn: HTMLElement | null;\n  volumeIcon: HTMLElement | null;\n  volumeSlider: HTMLInputElement | null;\n  speedBtn: HTMLElement | null;\n  speedMenu: HTMLElement | null;\n  fullscreenBtn: HTMLElement | null;\n  progressContainer: HTMLElement | null;\n  progressFill: HTMLElement | null;\n  progressBuffer: HTMLElement | null;\n  progressHandle: HTMLElement | null;\n  progressTooltip: HTMLElement | null;\n  bufferSegments: HTMLElement | null;\n  timeDisplay: HTMLElement | null;\n  statusIndicator: HTMLElement | null;\n  statusText: HTMLElement | null;\n  errorOverlay: HTMLElement | null;\n  errorTitle: HTMLElement | null;\n  errorMessage: HTMLElement | null;\n  emptyState: HTMLElement | null;\n  emptyTitle: HTMLElement | null;\n  emptyMessage: HTMLElement | null;\n  emptyEnableSubfolders: HTMLElement | null;\n  sidebarToggle: HTMLElement | null;\n  sidebarBackdrop: HTMLElement | null;\n}\n\n(function(): void {\n  'use strict';\n\n  const CONFIG: StreamConfig = {\n    RESUME_THRESHOLD: 10,\n    RESUME_MIN_DURATION: 30,\n    CONTROLS_HIDE_DELAY: 3000,\n    STORAGE_KEY: 'stream_gallery_progress'\n  };\n\n  const DROPPR_CONFIG = window.DROPPR_CONFIG || {};\n  const PREVIEW_FORMAT = String(DROPPR_CONFIG.previewFormat || 'auto').trim().toLowerCase();\n  const ASSET_BASE_URL = (typeof DROPPR_CONFIG.assetBaseUrl === 'string')\n    ? DROPPR_CONFIG.assetBaseUrl.replace(/\\/+$/, '')\n    : '';\n  const THUMB_DEFAULT_WIDTHS = [48, 96];\n  const THUMB_WIDTHS = normalizeWidths(DROPPR_CONFIG.previewThumbWidths || THUMB_DEFAULT_WIDTHS);\n\n  const VIDEO_EXTS: Record<string, boolean> = {\n    '3g2': true,\n    '3gp': true,\n    asf: true,\n    avi: true,\n    flv: true,\n    m2ts: true,\n    m2v: true,\n    m4v: true,\n    mkv: true,\n    mov: true,\n    mp4: true,\n    mpe: true,\n    mpeg: true,\n    mpg: true,\n    mts: true,\n    mxf: true,\n    ogv: true,\n    ts: true,\n    vob: true,\n    webm: true,\n    wmv: true\n  };\n\n  const state: StreamState = {\n    shareHash: null,\n    recursive: false,\n    shareMeta: null,\n    files: [],\n    videoFiles: [],\n    currentIndex: -1,\n    isPlaying: false,\n    isSeeking: false,\n    isBuffering: false,\n    controlsTimer: null,\n    progressStorage: {},\n    lastMouseMove: 0\n  };\n\n  const els: StreamElements = {\n    video: document.getElementById('video') as HTMLVideoElement | null,\n    playerWrapper: document.getElementById('playerWrapper'),\n    controls: document.getElementById('controls'),\n    sidebar: document.getElementById('sidebar'),\n    fileList: document.getElementById('fileList'),\n    fileCount: document.getElementById('fileCount'),\n    shareInfo: document.getElementById('shareInfo'),\n    recursiveToggle: document.getElementById('recursiveToggle'),\n    videoTitle: document.getElementById('videoTitle'),\n    downloadBtn: document.getElementById('downloadBtn') as HTMLAnchorElement | null,\n    galleryBtn: document.getElementById('galleryBtn') as HTMLAnchorElement | null,\n    playBtn: document.getElementById('playBtn'),\n    playIcon: document.getElementById('playIcon'),\n    prevBtn: document.getElementById('prevBtn'),\n    nextBtn: document.getElementById('nextBtn'),\n    skipBackBtn: document.getElementById('skipBackBtn'),\n    skipForwardBtn: document.getElementById('skipForwardBtn'),\n    muteBtn: document.getElementById('muteBtn'),\n    volumeIcon: document.getElementById('volumeIcon'),\n    volumeSlider: document.getElementById('volumeSlider') as HTMLInputElement | null,\n    speedBtn: document.getElementById('speedBtn'),\n    speedMenu: document.getElementById('speedMenu'),\n    fullscreenBtn: document.getElementById('fullscreenBtn'),\n    progressContainer: document.getElementById('progressContainer'),\n    progressFill: document.getElementById('progressFill'),\n    progressBuffer: document.getElementById('progressBuffer'),\n    progressHandle: document.getElementById('progressHandle'),\n    progressTooltip: document.getElementById('progressTooltip'),\n    bufferSegments: document.getElementById('bufferSegments'),\n    timeDisplay: document.getElementById('timeDisplay'),\n    statusIndicator: document.getElementById('statusIndicator'),\n    statusText: document.getElementById('statusText'),\n    errorOverlay: document.getElementById('errorOverlay'),\n    errorTitle: document.getElementById('errorTitle'),\n    errorMessage: document.getElementById('errorMessage'),\n    emptyState: document.getElementById('emptyState'),\n    emptyTitle: document.getElementById('emptyTitle'),\n    emptyMessage: document.getElementById('emptyMessage'),\n    emptyEnableSubfolders: document.getElementById('emptyEnableSubfolders'),\n    sidebarToggle: document.getElementById('sidebarToggle'),\n    sidebarBackdrop: document.getElementById('sidebarBackdrop')\n  };\n\n  function encodePath(p: string): string {\n    return String(p || '').split('/').map(s => encodeURIComponent(s)).join('/');\n  }\n\n  function normalizeWidths(list: number[] | undefined): number[] {\n    const values = Array.isArray(list) ? list : [];\n    const normalized = values\n      .map(value => Number(value))\n      .filter(value => Number.isFinite(value) && value > 0);\n    if (normalized.length === 0) return THUMB_DEFAULT_WIDTHS.slice();\n    normalized.sort((a, b) => a - b);\n    const unique: number[] = [];\n    normalized.forEach(value => {\n      if (unique[unique.length - 1] !== value) unique.push(value);\n    });\n    return unique;\n  }\n\n  function addResourceHint(href: string): void {\n    if (!href || typeof href !== 'string') return;\n    const trimmed = href.replace(/\\/+$/, '');\n    if (!trimmed || trimmed === window.location.origin) return;\n    if (document.querySelector(`link[rel=\"preconnect\"][href=\"${trimmed}\"]`)) return;\n    const preconnect = document.createElement('link');\n    preconnect.rel = 'preconnect';\n    preconnect.href = trimmed;\n    preconnect.crossOrigin = 'anonymous';\n    document.head.appendChild(preconnect);\n    const dnsPrefetch = document.createElement('link');\n    dnsPrefetch.rel = 'dns-prefetch';\n    dnsPrefetch.href = trimmed;\n    document.head.appendChild(dnsPrefetch);\n  }\n\n  function setupResourceHints(): void {\n    addResourceHint(ASSET_BASE_URL);\n  }\n\n  function parseBoolParam(value: string | null): boolean | null {\n    if (value == null) return null;\n    const v = String(value).trim().toLowerCase();\n    if (!v) return null;\n    return v === '1' || v === 'true' || v === 'yes' || v === 'on';\n  }\n\n  function formatTime(seconds: number): string {\n    if (!Number.isFinite(seconds) || seconds < 0) return '0:00';\n    const s = Math.floor(seconds);\n    const h = Math.floor(s / 3600);\n    const m = Math.floor((s % 3600) / 60);\n    const sec = s % 60;\n    if (h > 0) return h + ':' + String(m).padStart(2, '0') + ':' + String(sec).padStart(2, '0');\n    return m + ':' + String(sec).padStart(2, '0');\n  }\n\n  function formatBytes(bytes: number): string {\n    if (!Number.isFinite(bytes) || bytes < 0) return '';\n    const units = ['B', 'KB', 'MB', 'GB', 'TB'];\n    let v = bytes, i = 0;\n    while (v >= 1000 && i < units.length - 1) { v /= 1000; i++; }\n    return v.toFixed(i === 0 ? 0 : 1) + ' ' + units[i];\n  }\n\n  function normalizeExt(value: string): string {\n    let ext = String(value || '').trim();\n    if (!ext) return '';\n    if (ext.charAt(0) === '.') ext = ext.slice(1);\n    return ext.toLowerCase();\n  }\n\n  function getFileExt(file: StreamFile): string {\n    if (!file) return '';\n    const metaExt = normalizeExt(file.extension || '');\n    if (metaExt) return metaExt;\n    let name = String(file.path || file.name || '');\n    name = name.split('?')[0].split('#')[0];\n    const idx = name.lastIndexOf('.');\n    if (idx < 0) return '';\n    return normalizeExt(name.slice(idx + 1));\n  }\n\n  function isVideoEntry(file: StreamFile): boolean {\n    if (!file) return false;\n    const t = String(file.type || '').toLowerCase();\n    if (t === 'video') return true;\n    const ext = getFileExt(file);\n    return !!(ext && VIDEO_EXTS[ext]);\n  }\n\n  function loadProgressStorage(): void {\n    try {\n      const data = localStorage.getItem(CONFIG.STORAGE_KEY);\n      state.progressStorage = data ? JSON.parse(data) : {};\n    } catch { state.progressStorage = {}; }\n  }\n\n  function saveProgressStorage(): void {\n    try { localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(state.progressStorage)); } catch { /* ignore */ }\n  }\n\n  function getFilePath(file: StreamFile): string {\n    if (!file) return '';\n    return String(file.path || file.name || '');\n  }\n\n  function getFileName(file: StreamFile): string {\n    if (!file) return '';\n    return String(file.name || file.path || '');\n  }\n\n  function getVideoProgress(shareHash: string, fileKey: string): VideoProgress | null {\n    return state.progressStorage[shareHash + ':' + fileKey] || null;\n  }\n\n  function setVideoProgress(shareHash: string, fileKey: string, currentTime: number, duration: number): void {\n    const key = shareHash + ':' + fileKey;\n    if (duration && currentTime >= duration - CONFIG.RESUME_THRESHOLD) {\n      delete state.progressStorage[key];\n    } else if (currentTime > 5) {\n      state.progressStorage[key] = { time: currentTime, duration: duration, updated: Date.now() };\n    }\n    saveProgressStorage();\n  }\n\n  function clearVideoProgress(shareHash: string, fileKey: string): void {\n    delete state.progressStorage[shareHash + ':' + fileKey];\n    saveProgressStorage();\n  }\n\n  async function fetchFiles(shareHash: string, recursive: boolean): Promise<StreamFile[] | null> {\n    try {\n      const flag = recursive ? '1' : '0';\n      const resp = await fetch('/api/share/' + shareHash + '/files?recursive=' + flag);\n      if (!resp.ok) throw new Error('HTTP ' + resp.status);\n      return await resp.json() as StreamFile[];\n    } catch (err) {\n      console.error('Failed to fetch files:', err);\n      return null;\n    }\n  }\n\n  interface FilesResponse {\n    files?: StreamFile[];\n    items?: StreamFile[];\n  }\n\n  function extractFilesFromResponse(data: StreamFile[] | FilesResponse | null): StreamFile[] | null {\n    if (Array.isArray(data)) return data;\n    if (data && Array.isArray((data as FilesResponse).files)) return (data as FilesResponse).files!;\n    if (data && Array.isArray((data as FilesResponse).items)) return (data as FilesResponse).items!;\n    return null;\n  }\n\n  async function fetchShareMeta(shareHash: string): Promise<ShareMeta | null> {\n    try {\n      const resp = await fetch('/api/public/share/' + shareHash);\n      if (!resp.ok) throw new Error('HTTP ' + resp.status);\n      const data = await resp.json();\n      return data && typeof data === 'object' ? data as ShareMeta : null;\n    } catch (err) {\n      console.warn('Failed to fetch share meta:', err);\n      return null;\n    }\n  }\n\n  async function updateEmptyStateHint(): Promise<void> {\n    if (!els.emptyTitle || !els.emptyMessage) return;\n    if (state.files && state.files.length > 0) {\n      els.emptyTitle.textContent = 'No Videos Found';\n      els.emptyMessage.textContent = 'This share has files, but none look like videos. Use Gallery for images.';\n      if (els.emptyEnableSubfolders) els.emptyEnableSubfolders.style.display = 'none';\n      return;\n    }\n\n    const meta = state.shareMeta || (await fetchShareMeta(state.shareHash!));\n    if (meta && !state.shareMeta) state.shareMeta = meta;\n\n    const numDirs = meta && Number.isFinite(Number(meta.numDirs)) ? Number(meta.numDirs) : 0;\n    const hasDirs = numDirs > 0;\n\n    if (hasDirs && !state.recursive) {\n      els.emptyTitle.textContent = 'No Videos Found';\n      els.emptyMessage.textContent = 'This folder only has subfolders. Enable Subfolders to include them.';\n      if (els.emptyEnableSubfolders) els.emptyEnableSubfolders.style.display = '';\n    } else {\n      els.emptyTitle.textContent = 'No Videos Found';\n      els.emptyMessage.textContent = 'This share does not contain any video files.';\n      if (els.emptyEnableSubfolders) els.emptyEnableSubfolders.style.display = 'none';\n    }\n  }\n\n  function getVideoUrl(shareHash: string, filePath: string): string {\n    return '/api/share/' + shareHash + '/file/' + encodePath(filePath) + '?inline=true';\n  }\n\n  function getDownloadUrl(shareHash: string, filePath: string): string {\n    return '/api/share/' + shareHash + '/file/' + encodePath(filePath) + '?download=1';\n  }\n\n  function getThumbnailUrl(shareHash: string, filePath: string, width?: number): string {\n    let url = '/api/share/' + shareHash + '/preview/' + encodePath(filePath);\n    const params: string[] = [];\n    if (width) params.push('w=' + width);\n    if (PREVIEW_FORMAT) params.push('format=' + encodeURIComponent(PREVIEW_FORMAT));\n    if (params.length) url += '?' + params.join('&');\n    return url;\n  }\n\n  function showStatus(text: string, isLoading?: boolean): void {\n    if (els.statusText) els.statusText.textContent = text;\n    els.statusIndicator?.classList.add('show');\n    if (!isLoading) {\n      setTimeout(function() { els.statusIndicator?.classList.remove('show'); }, 1500);\n    }\n  }\n\n  function hideStatus(): void { els.statusIndicator?.classList.remove('show'); }\n\n  function showError(title: string, message: string): void {\n    if (els.errorTitle) els.errorTitle.textContent = title;\n    if (els.errorMessage) els.errorMessage.textContent = message;\n    els.errorOverlay?.classList.add('show');\n  }\n\n  function hideError(): void { els.errorOverlay?.classList.remove('show'); }\n\n  function updatePlayButton(): void {\n    if (els.playIcon) els.playIcon.innerHTML = state.isPlaying ? '&#10074;&#10074;' : '&#9658;';\n  }\n\n  function updateVolumeIcon(): void {\n    if (!els.video || !els.volumeIcon) return;\n    const vol = els.video.volume;\n    const muted = els.video.muted;\n    if (muted || vol === 0) els.volumeIcon.innerHTML = '&#128263;';\n    else if (vol < 0.5) els.volumeIcon.innerHTML = '&#128265;';\n    else els.volumeIcon.innerHTML = '&#128266;';\n  }\n\n  function updateTimeDisplay(): void {\n    if (!els.video || !els.timeDisplay) return;\n    const current = els.video.currentTime || 0;\n    const duration = els.video.duration || 0;\n    els.timeDisplay.textContent = formatTime(current) + ' / ' + formatTime(duration);\n  }\n\n  function updateProgress(): void {\n    if (!els.video || !els.progressFill || !els.progressHandle) return;\n    const current = els.video.currentTime || 0;\n    const duration = els.video.duration || 0;\n    const percent = duration > 0 ? (current / duration) * 100 : 0;\n    els.progressFill.style.width = percent + '%';\n    els.progressHandle.style.left = percent + '%';\n  }\n\n  function updateBufferSegments(): void {\n    if (!els.video || !els.bufferSegments || !els.progressBuffer) return;\n    const duration = els.video.duration;\n    if (!duration || !Number.isFinite(duration)) {\n      els.bufferSegments.innerHTML = '';\n      els.progressBuffer.style.width = '0%';\n      return;\n    }\n    const buffered = els.video.buffered;\n    const segments: string[] = [];\n    let maxEnd = 0;\n    for (let i = 0; i < buffered.length; i++) {\n      const start = buffered.start(i);\n      const end = buffered.end(i);\n      const startPercent = (start / duration) * 100;\n      const widthPercent = ((end - start) / duration) * 100;\n      segments.push('<div class=\"buffer-segment\" style=\"left:' + startPercent + '%;width:' + widthPercent + '%\"></div>');\n      if (end > maxEnd) maxEnd = end;\n    }\n    els.bufferSegments.innerHTML = segments.join('');\n    els.progressBuffer.style.width = (maxEnd / duration) * 100 + '%';\n  }\n\n  function showControls(): void {\n    els.playerWrapper?.classList.remove('hide-controls');\n    if (state.controlsTimer) clearTimeout(state.controlsTimer);\n    if (state.isPlaying) {\n      state.controlsTimer = setTimeout(function() {\n        els.playerWrapper?.classList.add('hide-controls');\n      }, CONFIG.CONTROLS_HIDE_DELAY);\n    }\n  }\n\n  function renderFileList(): void {\n    if (!els.fileList) return;\n    els.fileList.innerHTML = '';\n    state.videoFiles.forEach(function(file: StreamFile, index: number) {\n      const item = document.createElement('div');\n      item.className = 'file-item';\n      if (index === state.currentIndex) item.classList.add('active');\n      const filePath = getFilePath(file);\n      const fileName = getFileName(file);\n      const progress = getVideoProgress(state.shareHash!, filePath);\n      const thumbWidths = THUMB_WIDTHS.length ? THUMB_WIDTHS : THUMB_DEFAULT_WIDTHS;\n      const thumbSrc = getThumbnailUrl(state.shareHash!, filePath, thumbWidths[0]);\n      const thumbSrcSet = thumbWidths.map(function(width: number) {\n        return getThumbnailUrl(state.shareHash!, filePath, width) + ' ' + width + 'w';\n      }).join(', ');\n      const thumbSrcSetAttr = thumbSrcSet ? ' srcset=\"' + thumbSrcSet + '\" sizes=\"48px\"' : '';\n      item.innerHTML = '<div class=\"file-thumb\"><img src=\"' + thumbSrc + '\"' + thumbSrcSetAttr + ' alt=\"\" loading=\"lazy\" onerror=\"this.parentElement.innerHTML=\\'&#128249;\\'\"></div>' +\n        '<div class=\"file-info\"><div class=\"file-name\">' + fileName + '</div>' +\n        '<div class=\"file-meta\"><span>' + formatBytes(file.size || 0) + '</span>' +\n        (progress ? '<span class=\"resume-badge\">' + formatTime(progress.time) + '</span>' : '') +\n        '</div></div>';\n      item.onclick = function() { loadVideo(index); };\n      els.fileList!.appendChild(item);\n    });\n    if (els.fileCount) els.fileCount.textContent = state.videoFiles.length + ' video' + (state.videoFiles.length !== 1 ? 's' : '');\n  }\n\n  function updateRecursiveToggle(): void {\n    if (!els.recursiveToggle) return;\n    const label = state.recursive ? 'Subfolders: On' : 'Subfolders: Off';\n    els.recursiveToggle.textContent = label;\n    els.recursiveToggle.setAttribute('aria-pressed', state.recursive ? 'true' : 'false');\n    els.recursiveToggle.classList.toggle('active', state.recursive);\n    if (els.galleryBtn && state.shareHash) {\n      let galleryUrl = '/gallery/' + state.shareHash;\n      if (state.recursive) galleryUrl += '?recursive=1';\n      els.galleryBtn.href = galleryUrl;\n    }\n  }\n\n  function updateActiveFileItem(): void {\n    const items = els.fileList?.querySelectorAll('.file-item');\n    items?.forEach(function(item: Element, i: number) {\n      item.classList.toggle('active', i === state.currentIndex);\n    });\n    const activeItem = els.fileList?.querySelector('.file-item.active');\n    if (activeItem) (activeItem as HTMLElement).scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n  }\n\n  function loadVideo(index: number): void {\n    if (!els.video) return;\n    if (index < 0 || index >= state.videoFiles.length) return;\n    if (state.currentIndex >= 0 && state.currentIndex < state.videoFiles.length) {\n      const currentFile = state.videoFiles[state.currentIndex];\n      setVideoProgress(state.shareHash!, getFilePath(currentFile), els.video.currentTime, els.video.duration);\n    }\n    state.currentIndex = index;\n    const file = state.videoFiles[index];\n    const filePath = getFilePath(file);\n    const fileName = getFileName(file);\n    hideError();\n    showStatus('Loading video...', true);\n    if (els.videoTitle) els.videoTitle.textContent = fileName;\n    if (els.downloadBtn) els.downloadBtn.href = file.download_url || getDownloadUrl(state.shareHash!, filePath);\n    updateActiveFileItem();\n    els.sidebar?.classList.remove('show');\n    els.sidebarBackdrop?.classList.remove('show');\n    const videoUrl = file.inline_url || getVideoUrl(state.shareHash!, filePath);\n    els.video.src = videoUrl;\n    els.video.load();\n    const progress = getVideoProgress(state.shareHash!, filePath);\n    if (progress && progress.time > 5) {\n      els.video.addEventListener('loadedmetadata', function onMeta() {\n        els.video!.removeEventListener('loadedmetadata', onMeta);\n        if (progress.time < els.video!.duration - CONFIG.RESUME_THRESHOLD) {\n          els.video!.currentTime = progress.time;\n          showStatus('Resuming from ' + formatTime(progress.time), false);\n        }\n      }, { once: true });\n    }\n  }\n\n  interface ReloadOptions {\n    keepCurrent?: boolean;\n    fileParam?: string;\n  }\n\n  async function reloadFiles(options?: ReloadOptions): Promise<boolean> {\n    if (!els.video) return false;\n    const keepCurrent = options?.keepCurrent;\n    const fileParam = options?.fileParam;\n    let currentPath: string | null = null;\n\n    if (state.currentIndex >= 0 && state.currentIndex < state.videoFiles.length) {\n      const currentFile = state.videoFiles[state.currentIndex];\n      setVideoProgress(state.shareHash!, getFilePath(currentFile), els.video.currentTime, els.video.duration);\n      if (keepCurrent) currentPath = getFilePath(currentFile);\n    }\n\n    showStatus('Loading files...', true);\n    const data = await fetchFiles(state.shareHash!, state.recursive);\n    const files = extractFilesFromResponse(data);\n    if (!files) {\n      hideStatus();\n      showError('Failed to load files', 'Could not retrieve the file list from the server.');\n      return false;\n    }\n\n    state.files = files || [];\n    state.videoFiles = state.files.filter(function(f: StreamFile) { return isVideoEntry(f); });\n\n    if (state.videoFiles.length === 0) {\n      hideStatus();\n      if (els.emptyState) els.emptyState.style.display = 'flex';\n      if (els.video) els.video.style.display = 'none';\n      if (els.controls) els.controls.style.display = 'none';\n      if (els.fileList) els.fileList.innerHTML = '';\n      if (els.fileCount) els.fileCount.textContent = '0 videos';\n      if (els.videoTitle) els.videoTitle.textContent = 'Select a video';\n      if (els.downloadBtn) els.downloadBtn.removeAttribute('href');\n      state.currentIndex = -1;\n      state.isPlaying = false;\n      try { els.video.pause(); } catch { /* ignore */ }\n      els.video.removeAttribute('src');\n      els.video.load();\n      await updateEmptyStateHint();\n      return false;\n    }\n\n    if (els.emptyState) els.emptyState.style.display = 'none';\n    if (els.video) els.video.style.display = '';\n    if (els.controls) els.controls.style.display = '';\n    hideError();\n\n    let idx = -1;\n    if (fileParam) {\n      idx = state.videoFiles.findIndex(function(f: StreamFile) { return f.name === fileParam || f.path === fileParam; });\n    }\n    if (idx < 0 && currentPath) {\n      idx = state.videoFiles.findIndex(function(f: StreamFile) { return getFilePath(f) === currentPath; });\n    }\n    if (idx < 0) idx = 0;\n\n    state.currentIndex = -1;\n    renderFileList();\n    loadVideo(idx);\n    return true;\n  }\n\n  function playNext(): void {\n    if (state.currentIndex < state.videoFiles.length - 1) loadVideo(state.currentIndex + 1);\n  }\n\n  function playPrev(): void {\n    if (state.currentIndex > 0) loadVideo(state.currentIndex - 1);\n  }\n\n  function setupVideoEvents(): void {\n    const video = els.video;\n    if (!video) return;\n\n    video.addEventListener('loadedmetadata', function() {\n      updateTimeDisplay();\n      updateProgress();\n      hideStatus();\n    });\n    video.addEventListener('canplay', function() {\n      hideStatus();\n      state.isBuffering = false;\n    });\n    video.addEventListener('play', function() {\n      state.isPlaying = true;\n      updatePlayButton();\n      showControls();\n    });\n    video.addEventListener('pause', function() {\n      state.isPlaying = false;\n      updatePlayButton();\n      showControls();\n      if (state.currentIndex >= 0) {\n        const file = state.videoFiles[state.currentIndex];\n        setVideoProgress(state.shareHash!, getFilePath(file), video.currentTime, video.duration);\n      }\n    });\n    video.addEventListener('timeupdate', function() {\n      updateTimeDisplay();\n      updateProgress();\n      if (Math.floor(video.currentTime) % 10 === 0 && state.currentIndex >= 0) {\n        const file = state.videoFiles[state.currentIndex];\n        setVideoProgress(state.shareHash!, getFilePath(file), video.currentTime, video.duration);\n      }\n    });\n    video.addEventListener('progress', updateBufferSegments);\n    video.addEventListener('waiting', function() {\n      state.isBuffering = true;\n      showStatus('Buffering...', true);\n    });\n    video.addEventListener('seeking', function() {\n      state.isSeeking = true;\n      showStatus('Seeking...', true);\n    });\n    video.addEventListener('seeked', function() {\n      state.isSeeking = false;\n      hideStatus();\n    });\n    video.addEventListener('ended', function() {\n      state.isPlaying = false;\n      updatePlayButton();\n      if (state.currentIndex >= 0) {\n        const file = state.videoFiles[state.currentIndex];\n        clearVideoProgress(state.shareHash!, getFilePath(file));\n      }\n      playNext();\n    });\n    video.addEventListener('volumechange', function() {\n      if (els.volumeSlider) els.volumeSlider.value = video.muted ? '0' : String(video.volume);\n      updateVolumeIcon();\n    });\n    video.addEventListener('error', function() {\n      hideStatus();\n      showError('Could not load video', 'The video file may be corrupted or in an unsupported format.');\n    });\n  }\n\n  function setupControlEvents(): void {\n    const video = els.video;\n    if (!video) return;\n\n    if (els.playBtn) {\n      els.playBtn.onclick = function() {\n        if (video.paused) video.play();\n        else video.pause();\n      };\n    }\n    video.onclick = function() {\n      if (video.paused) video.play();\n      else video.pause();\n    };\n    if (els.prevBtn) els.prevBtn.onclick = playPrev;\n    if (els.nextBtn) els.nextBtn.onclick = playNext;\n    if (els.skipBackBtn) {\n      els.skipBackBtn.onclick = function() {\n        video.currentTime = Math.max(0, video.currentTime - 10);\n      };\n    }\n    if (els.skipForwardBtn) {\n      els.skipForwardBtn.onclick = function() {\n        video.currentTime = Math.min(video.duration, video.currentTime + 10);\n      };\n    }\n    if (els.muteBtn) els.muteBtn.onclick = function() { video.muted = !video.muted; };\n    if (els.volumeSlider) {\n      els.volumeSlider.oninput = function() {\n        video.volume = parseFloat(els.volumeSlider!.value);\n        video.muted = false;\n      };\n    }\n    if (els.speedBtn) els.speedBtn.onclick = function() { els.speedMenu?.classList.toggle('show'); };\n    document.querySelectorAll('.speed-option').forEach(function(btn: Element) {\n      (btn as HTMLElement).onclick = function() {\n        const speed = parseFloat((btn as HTMLElement).dataset.speed || '1');\n        video.playbackRate = speed;\n        if (els.speedBtn) els.speedBtn.textContent = speed + 'x';\n        document.querySelectorAll('.speed-option').forEach(function(b: Element) { b.classList.remove('active'); });\n        btn.classList.add('active');\n        els.speedMenu?.classList.remove('show');\n      };\n    });\n    document.addEventListener('click', function(e: MouseEvent) {\n      const target = e.target as HTMLElement;\n      if (!els.speedBtn?.contains(target) && !els.speedMenu?.contains(target)) {\n        els.speedMenu?.classList.remove('show');\n      }\n    });\n    if (els.fullscreenBtn) {\n      els.fullscreenBtn.onclick = function() {\n        if (document.fullscreenElement) document.exitFullscreen();\n        else els.playerWrapper?.requestFullscreen();\n      };\n    }\n\n    let isDragging = false;\n    function seekToPosition(e: MouseEvent): number {\n      if (!els.progressContainer) return 0;\n      const rect = els.progressContainer.getBoundingClientRect();\n      return Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));\n    }\n    function updateTooltip(e: MouseEvent): void {\n      if (!video) return;\n      const percent = seekToPosition(e);\n      const time = percent * (video.duration || 0);\n      if (els.progressTooltip) {\n        els.progressTooltip.textContent = formatTime(time);\n        els.progressTooltip.style.left = (percent * 100) + '%';\n      }\n    }\n    if (els.progressContainer) {\n      els.progressContainer.addEventListener('mousemove', updateTooltip);\n      els.progressContainer.addEventListener('mousedown', function(e: MouseEvent) {\n        isDragging = true;\n        const percent = seekToPosition(e);\n        video.currentTime = percent * video.duration;\n      });\n    }\n    document.addEventListener('mousemove', function(e: MouseEvent) {\n      if (isDragging) {\n        const percent = seekToPosition(e);\n        video.currentTime = percent * video.duration;\n      }\n    });\n    document.addEventListener('mouseup', function() { isDragging = false; });\n    if (els.progressContainer) {\n      els.progressContainer.addEventListener('touchstart', function(e: TouchEvent) {\n        isDragging = true;\n        const touch = e.touches[0];\n        const rect = els.progressContainer!.getBoundingClientRect();\n        const percent = Math.max(0, Math.min(1, (touch.clientX - rect.left) / rect.width));\n        video.currentTime = percent * video.duration;\n      });\n      els.progressContainer.addEventListener('touchmove', function(e: TouchEvent) {\n        if (isDragging) {\n          const touch = e.touches[0];\n          const rect = els.progressContainer!.getBoundingClientRect();\n          const percent = Math.max(0, Math.min(1, (touch.clientX - rect.left) / rect.width));\n          video.currentTime = percent * video.duration;\n        }\n      });\n      els.progressContainer.addEventListener('touchend', function() { isDragging = false; });\n    }\n    els.playerWrapper?.addEventListener('mousemove', showControls);\n    els.playerWrapper?.addEventListener('mouseleave', function() {\n      if (state.isPlaying) {\n        state.controlsTimer = setTimeout(function() {\n          els.playerWrapper?.classList.add('hide-controls');\n        }, CONFIG.CONTROLS_HIDE_DELAY);\n      }\n    });\n    if (els.sidebarToggle) {\n      els.sidebarToggle.onclick = function() {\n        els.sidebar?.classList.toggle('show');\n        els.sidebarBackdrop?.classList.toggle('show');\n      };\n    }\n    if (els.sidebarBackdrop) {\n      els.sidebarBackdrop.onclick = function() {\n        els.sidebar?.classList.remove('show');\n        els.sidebarBackdrop?.classList.remove('show');\n      };\n    }\n  }\n\n  function setupKeyboardShortcuts(): void {\n    const video = els.video;\n    if (!video) return;\n\n    document.addEventListener('keydown', function(e: KeyboardEvent) {\n      const target = e.target as HTMLElement;\n      if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') return;\n      switch (e.key) {\n        case ' ':\n        case 'k':\n          e.preventDefault();\n          if (video.paused) video.play();\n          else video.pause();\n          break;\n        case 'ArrowLeft':\n          e.preventDefault();\n          video.currentTime -= e.shiftKey ? 30 : 10;\n          break;\n        case 'ArrowRight':\n          e.preventDefault();\n          video.currentTime += e.shiftKey ? 30 : 10;\n          break;\n        case 'ArrowUp':\n          e.preventDefault();\n          video.volume = Math.min(1, video.volume + 0.1);\n          break;\n        case 'ArrowDown':\n          e.preventDefault();\n          video.volume = Math.max(0, video.volume - 0.1);\n          break;\n        case 'm': video.muted = !video.muted; break;\n        case 'f':\n          if (document.fullscreenElement) document.exitFullscreen();\n          else els.playerWrapper?.requestFullscreen();\n          break;\n        case 'n':\n        case 'N': playNext(); break;\n        case 'p':\n        case 'P': playPrev(); break;\n        case 'Home':\n          e.preventDefault();\n          video.currentTime = 0;\n          break;\n        case 'End':\n          e.preventDefault();\n          video.currentTime = video.duration;\n          break;\n        case '0': case '1': case '2': case '3': case '4':\n        case '5': case '6': case '7': case '8': case '9':\n          e.preventDefault();\n          video.currentTime = (parseInt(e.key) / 10) * video.duration;\n          break;\n      }\n    });\n  }\n\n  function getShareHashFromLocation(): string {\n    const params = new URLSearchParams(window.location.search);\n    const share = params.get('share') || '';\n    if (share && /^[A-Za-z0-9_-]{1,64}$/.test(share)) return share;\n\n    const path = String(window.location.pathname || '');\n    const m = path.match(/^\\/stream\\/([A-Za-z0-9_-]{1,64})\\/?$/);\n    if (m && m[1]) return m[1];\n    return '';\n  }\n\n  async function init(): Promise<void> {\n    const params = new URLSearchParams(window.location.search);\n    state.shareHash = getShareHashFromLocation();\n    if (!state.shareHash || !/^[A-Za-z0-9_-]{1,64}$/.test(state.shareHash)) {\n      showError('Invalid share link', 'The share hash is missing or invalid.');\n      return;\n    }\n    setupResourceHints();\n    loadProgressStorage();\n    if (els.galleryBtn) els.galleryBtn.href = '/gallery/' + state.shareHash;\n    if (els.shareInfo) els.shareInfo.textContent = state.shareHash;\n\n    const recursiveParam = parseBoolParam(params.get('recursive'));\n    state.recursive = recursiveParam === null ? false : recursiveParam;\n    updateRecursiveToggle();\n    if (els.recursiveToggle) {\n      els.recursiveToggle.onclick = function() {\n        state.recursive = !state.recursive;\n        updateRecursiveToggle();\n        reloadFiles({ keepCurrent: true });\n      };\n    }\n    if (els.emptyEnableSubfolders) {\n      els.emptyEnableSubfolders.onclick = function() {\n        state.recursive = true;\n        updateRecursiveToggle();\n        reloadFiles({ keepCurrent: false });\n      };\n    }\n\n    setupVideoEvents();\n    setupControlEvents();\n    setupKeyboardShortcuts();\n\n    await reloadFiles({ fileParam: params.get('file') || undefined });\n  }\n\n  init();\n})();\n"],"names":["CONFIG","DROPPR_CONFIG","PREVIEW_FORMAT","ASSET_BASE_URL","THUMB_DEFAULT_WIDTHS","THUMB_WIDTHS","normalizeWidths","VIDEO_EXTS","state","els","encodePath","p","s","list","normalized","value","a","b","unique","addResourceHint","href","trimmed","preconnect","dnsPrefetch","setupResourceHints","parseBoolParam","v","formatTime","seconds","h","m","sec","formatBytes","bytes","units","i","normalizeExt","ext","getFileExt","file","metaExt","name","idx","isVideoEntry","loadProgressStorage","data","saveProgressStorage","getFilePath","getFileName","getVideoProgress","shareHash","fileKey","setVideoProgress","currentTime","duration","key","clearVideoProgress","fetchFiles","recursive","flag","resp","err","extractFilesFromResponse","fetchShareMeta","updateEmptyStateHint","meta","getVideoUrl","filePath","getDownloadUrl","getThumbnailUrl","width","url","params","showStatus","text","isLoading","_a","hideStatus","showError","title","message","hideError","updatePlayButton","updateVolumeIcon","vol","updateTimeDisplay","current","updateProgress","percent","updateBufferSegments","buffered","segments","maxEnd","start","end","startPercent","widthPercent","showControls","renderFileList","index","item","fileName","progress","thumbWidths","thumbSrc","thumbSrcSet","thumbSrcSetAttr","loadVideo","updateRecursiveToggle","label","galleryUrl","updateActiveFileItem","items","activeItem","_b","currentFile","videoUrl","onMeta","reloadFiles","options","keepCurrent","fileParam","currentPath","files","f","playNext","playPrev","setupVideoEvents","video","setupControlEvents","btn","speed","e","target","_c","isDragging","seekToPosition","rect","updateTooltip","time","touch","setupKeyboardShortcuts","getShareHashFromLocation","share","init","recursiveParam"],"mappings":"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"}